---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# controlcharts

<!-- badges: start -->
[![R-CMD-check](https://github.com/AUS-DOH-Safety-and-Quality/controlcharts/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/AUS-DOH-Safety-and-Quality/controlcharts/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/controlcharts)](https://CRAN.R-project.org/package=controlcharts)
[![controlcharts status badge](https://AUS-DOH-Safety-and-Quality.r-universe.dev/badges/controlcharts)](https://AUS-DOH-Safety-and-Quality.r-universe.dev/controlcharts)
<!-- badges: end -->

The `controlcharts` package aims to provide a comprehensive set of tools for both calculating and visualising statistical process control (SPC) charts and funnel plots in R.

The package is implemented as a wrapper around the existing code for the Power BI custom visuals for [SPC Charts](https://github.com/AUS-DOH-Safety-and-Quality/PowerBI-SPC) and [Funnel Plots](https://github.com/AUS-DOH-Safety-and-Quality/PowerBI-Funnels). As the data pre-processing, calculation of control limits, and plotting functions are all implemented in Javascript, this provides powerful flexibility for use in interactive contexts.

## Installation

You can install the development version of controlcharts from [GitHub](https://github.com/) with:

```{r, eval=FALSE}
# install.packages("remotes")
remotes::install_github("AUS-DOH-Safety-and-Quality/controlcharts")
```

Or you can install pre-built binaries from R-Universe:

```{r, eval=FALSE}
install.packages("controlcharts", repos = c("https://AUS-DOH-Safety-and-Quality.r-universe.dev",
                                            "https://cran.r-project.org"))
```


## Getting Started
```{r setup, include=FALSE}
set.seed(12324)
```


### Constructing SPC Charts

Consider a basic time-series, comprised of two-years of monthly data:

```{r spc}
# Simulate 2 years of monthly data
dat <- data.frame(
  month = seq(as.Date('2024-01-01'), length.out = 24, by = "month"),
  y = rnorm(24)
)

knitr::kable(head(dat))
```

By default, the `spc()` function will construct an `i`-chart (individuals chart; also referred to as an XmR-chart):

```{r spc_plot}
spc_chart <- controlcharts::spc(data = dat,
                                numerators = y,
                                keys = month)
```

The result of the `spc()` function is a list containing three elements:

  - `static_plot`: a static SVG plot of the SPC chart
  - `html_plot`: an HTML widget containing the interactive SPC chart (for use in Shiny/interactive contexts)
  - `limits`: a data frame containing the calculated control limits

```{r spc_plot_static}
spc_chart$static_plot
```

```{r spc_plot_html, eval=FALSE}
# If you are using an interactive environment, you can display the HTML widget:
# spc_chart$html_plot
```

```{r spc_limits}
# Display the control limits
knitr::kable(head(spc_chart$limits), digits = 2)
```

### Funnel Plot

The same interface is provided for funnel charts. For this example, consider proportion data recorded by 10 organisations:

```{r funnel}
# Simulate proportion data for 10 organisations
denoms <- sample(100:200, 10)
funnel_data <- data.frame(
  organisation = letters[1:10],
  numerators = rbinom(10, size = denoms, prob = 0.2),
  denominators = denoms
)

knitr::kable(funnel_data)
```

For funnel plots, the default is a proportions (`PR`) chart:

```{r funnel_plot}
funnel_chart <- controlcharts::funnel(data = funnel_data,
                                       numerators = numerators,
                                       denominators = denominators,
                                       keys = organisation)
```

```{r funnel_plot_static}
funnel_chart$static_plot
```

```{r funnel_plot_limits}
knitr::kable(funnel_chart$limits, digits = 2)
```

## Interactive Charts

The package is also uniquely suited to creating interactive SPC charts and funnel plots. See the [vignette on interactive charts](https://aus-doh-safety-and-quality.github.io/controlcharts/articles/interactive_charts.html) for more details and examples.
