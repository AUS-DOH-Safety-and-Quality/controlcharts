var funnel=function(e){"use strict";var t="http://www.w3.org/1999/xhtml",i={svg:"http://www.w3.org/2000/svg",xhtml:t,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function n(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),i.hasOwnProperty(t)?{space:i[t],local:e}:e}function r(e){return function(){var i=this.ownerDocument,n=this.namespaceURI;return n===t&&i.documentElement.namespaceURI===t?i.createElement(e):i.createElementNS(n,e)}}function o(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function a(e){var t=n(e);return(t.local?o:r)(t)}function s(){}function l(e){return null==e?s:function(){return this.querySelector(e)}}function u(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function p(){return[]}function c(e){return function(t){return t.matches(e)}}var d=Array.prototype.find;function h(){return this.firstElementChild}var f=Array.prototype.filter;function m(){return Array.from(this.children)}function g(e){return new Array(e.length)}function y(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function v(e,t,i,n,r,o){for(var a,s=0,l=t.length,u=o.length;s<u;++s)(a=t[s])?(a.__data__=o[s],n[s]=a):i[s]=new y(e,o[s]);for(;s<l;++s)(a=t[s])&&(r[s]=a)}function b(e,t,i,n,r,o,a){var s,l,u,p=new Map,c=t.length,d=o.length,h=new Array(c);for(s=0;s<c;++s)(l=t[s])&&(h[s]=u=a.call(l,l.__data__,s,t)+"",p.has(u)?r[s]=l:p.set(u,l));for(s=0;s<d;++s)u=a.call(e,o[s],s,o)+"",(l=p.get(u))?(n[s]=l,l.__data__=o[s],p.delete(u)):i[s]=new y(e,o[s]);for(s=0;s<c;++s)(l=t[s])&&p.get(h[s])===l&&(r[s]=l)}function _(e){return e.__data__}function N(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function w(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function x(e){return function(){this.removeAttribute(e)}}function E(e){return function(){this.removeAttributeNS(e.space,e.local)}}function M(e,t){return function(){this.setAttribute(e,t)}}function S(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function I(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttribute(e):this.setAttribute(e,i)}}function T(e,t){return function(){var i=t.apply(this,arguments);null==i?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,i)}}function A(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function $(e){return function(){this.style.removeProperty(e)}}function P(e,t,i){return function(){this.style.setProperty(e,t,i)}}function k(e,t,i){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,i)}}function L(e){return function(){delete this[e]}}function D(e,t){return function(){this[e]=t}}function R(e,t){return function(){var i=t.apply(this,arguments);null==i?delete this[e]:this[e]=i}}function V(e){return e.trim().split(/^|\s+/)}function O(e){return e.classList||new F(e)}function F(e){this._node=e,this._names=V(e.getAttribute("class")||"")}function C(e,t){for(var i=O(e),n=-1,r=t.length;++n<r;)i.add(t[n])}function j(e,t){for(var i=O(e),n=-1,r=t.length;++n<r;)i.remove(t[n])}function U(e){return function(){C(this,e)}}function z(e){return function(){j(this,e)}}function q(e,t){return function(){(t.apply(this,arguments)?C:j)(this,e)}}function G(){this.textContent=""}function Y(e){return function(){this.textContent=e}}function H(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function B(){this.innerHTML=""}function X(e){return function(){this.innerHTML=e}}function W(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function K(){this.nextSibling&&this.parentNode.appendChild(this)}function J(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var e=this.parentNode;e&&e.removeChild(this)}function ee(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function te(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ie(e){return function(){var t=this.__on;if(t){for(var i,n=0,r=-1,o=t.length;n<o;++n)i=t[n],e.type&&i.type!==e.type||i.name!==e.name?t[++r]=i:this.removeEventListener(i.type,i.listener,i.options);++r?t.length=r:delete this.__on}}}function ne(e,t,i){return function(){var n,r=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var a=0,s=r.length;a<s;++a)if((n=r[a]).type===e.type&&n.name===e.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=o,n.options=i),void(n.value=t);this.addEventListener(e.type,o,i),n={type:e.type,name:e.name,value:t,listener:o,options:i},r?r.push(n):this.__on=[n]}}function re(e,t,i){var n=A(e),r=n.CustomEvent;"function"==typeof r?r=new r(t,i):(r=n.document.createEvent("Event"),i?(r.initEvent(t,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function oe(e,t){return function(){return re(this,e,t)}}function ae(e,t){return function(){return re(this,e,t.apply(this,arguments))}}y.prototype={constructor:y,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},F.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var se=[null];function le(e,t){this._groups=e,this._parents=t}function ue(e){return"string"==typeof e?new le([[document.querySelector(e)]],[document.documentElement]):new le([[e]],se)}function pe(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var i=t.ownerSVGElement||t;if(i.createSVGPoint){var n=i.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}function ce(e){return function(){return e}}le.prototype={constructor:le,select:function(e){"function"!=typeof e&&(e=l(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var o,a,s=t[r],u=s.length,p=n[r]=new Array(u),c=0;c<u;++c)(o=s[c])&&(a=e.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),p[c]=a);return new le(n,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return u(e.apply(this,arguments))}}(e):function(e){return null==e?p:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,i=t.length,n=[],r=[],o=0;o<i;++o)for(var a,s=t[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(n.push(e.call(a,a.__data__,c,s)),r.push(a));return new le(n,r)},selectChild:function(e){return this.select(null==e?h:function(e){return function(){return d.call(this.children,e)}}("function"==typeof e?e:c(e)))},selectChildren:function(e){return this.selectAll(null==e?m:function(e){return function(){return f.call(this.children,e)}}("function"==typeof e?e:c(e)))},filter:function(e){"function"!=typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,i=t.length,n=new Array(i),r=0;r<i;++r)for(var o,a=t[r],s=a.length,l=n[r]=[],u=0;u<s;++u)(o=a[u])&&e.call(o,o.__data__,u,a)&&l.push(o);return new le(n,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,_);var i=t?b:v,n=this._parents,r=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),u=0;u<o;++u){var p=n[u],c=r[u],d=c.length,h=N(e.call(p,p&&p.__data__,u,n)),f=h.length,m=s[u]=new Array(f),g=a[u]=new Array(f);i(p,c,m,g,l[u]=new Array(d),h,t);for(var y,w,x=0,E=0;x<f;++x)if(y=m[x]){for(x>=E&&(E=x+1);!(w=g[E])&&++E<f;);y._next=w||null}}return(a=new le(a,n))._enter=s,a._exit=l,a},enter:function(){return new le(this._enter||this._groups.map(g),this._parents)},exit:function(){return new le(this._exit||this._groups.map(g),this._parents)},join:function(e,t,i){var n=this.enter(),r=this,o=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==i?o.remove():i(o),n&&r?n.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,i=this._groups,n=t._groups,r=i.length,o=n.length,a=Math.min(r,o),s=new Array(r),l=0;l<a;++l)for(var u,p=i[l],c=n[l],d=p.length,h=s[l]=new Array(d),f=0;f<d;++f)(u=p[f]||c[f])&&(h[f]=u);for(;l<r;++l)s[l]=i[l];return new le(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,i=e.length;++t<i;)for(var n,r=e[t],o=r.length-1,a=r[o];--o>=0;)(n=r[o])&&(a&&4^n.compareDocumentPosition(a)&&a.parentNode.insertBefore(n,a),a=n);return this},sort:function(e){function t(t,i){return t&&i?e(t.__data__,i.__data__):!t-!i}e||(e=w);for(var i=this._groups,n=i.length,r=new Array(n),o=0;o<n;++o){for(var a,s=i[o],l=s.length,u=r[o]=new Array(l),p=0;p<l;++p)(a=s[p])&&(u[p]=a);u.sort(t)}return new le(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n=e[t],r=0,o=n.length;r<o;++r){var a=n[r];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,i=0,n=t.length;i<n;++i)for(var r,o=t[i],a=0,s=o.length;a<s;++a)(r=o[a])&&e.call(r,r.__data__,a,o);return this},attr:function(e,t){var i=n(e);if(arguments.length<2){var r=this.node();return i.local?r.getAttributeNS(i.space,i.local):r.getAttribute(i)}return this.each((null==t?i.local?E:x:"function"==typeof t?i.local?T:I:i.local?S:M)(i,t))},style:function(e,t,i){return arguments.length>1?this.each((null==t?$:"function"==typeof t?k:P)(e,t,null==i?"":i)):function(e,t){return e.style.getPropertyValue(t)||A(e).getComputedStyle(e,null).getPropertyValue(t)}(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?L:"function"==typeof t?R:D)(e,t)):this.node()[e]},classed:function(e,t){var i=V(e+"");if(arguments.length<2){for(var n=O(this.node()),r=-1,o=i.length;++r<o;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof t?q:t?U:z)(i,t))},text:function(e){return arguments.length?this.each(null==e?G:("function"==typeof e?H:Y)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?B:("function"==typeof e?W:X)(e)):this.node().innerHTML},raise:function(){return this.each(K)},lower:function(){return this.each(J)},append:function(e){var t="function"==typeof e?e:a(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var i="function"==typeof e?e:a(e),n=null==t?Z:"function"==typeof t?t:l(t);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(Q)},clone:function(e){return this.select(e?te:ee)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,i){var n,r,o=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}(e+""),a=o.length;if(!(arguments.length<2)){for(s=t?ne:ie,n=0;n<a;++n)this.each(s(o[n],t,i));return this}var s=this.node().__on;if(s)for(var l,u=0,p=s.length;u<p;++u)for(n=0,l=s[u];n<a;++n)if((r=o[n]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?ae:oe)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var n,r=e[t],o=0,a=r.length;o<a;++o)(n=r[o])&&(yield n)}};const de=Math.cos,he=Math.min,fe=Math.sin,me=Math.sqrt,ge=Math.PI,ye=2*ge,ve=Math.PI,be=2*ve,_e=1e-6,Ne=be-_e;function we(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=arguments[t]+e[t]}class xe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?we:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return we;const i=10**t;return function(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=Math.round(arguments[t]*i)/i+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,n){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+n}`}bezierCurveTo(e,t,i,n,r,o){this._append`C${+e},${+t},${+i},${+n},${this._x1=+r},${this._y1=+o}`}arcTo(e,t,i,n,r){if(e=+e,t=+t,i=+i,n=+n,(r=+r)<0)throw new Error(`negative radius: ${r}`);let o=this._x1,a=this._y1,s=i-e,l=n-t,u=o-e,p=a-t,c=u*u+p*p;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(c>_e)if(Math.abs(p*s-l*u)>_e&&r){let d=i-o,h=n-a,f=s*s+l*l,m=d*d+h*h,g=Math.sqrt(f),y=Math.sqrt(c),v=r*Math.tan((ve-Math.acos((f+c-m)/(2*g*y)))/2),b=v/y,_=v/g;Math.abs(b-1)>_e&&this._append`L${e+b*u},${t+b*p}`,this._append`A${r},${r},0,0,${+(p*d>u*h)},${this._x1=e+_*s},${this._y1=t+_*l}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,i,n,r,o){if(e=+e,t=+t,o=!!o,(i=+i)<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(n),s=i*Math.sin(n),l=e+a,u=t+s,p=1^o,c=o?n-r:r-n;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>_e||Math.abs(this._y1-u)>_e)&&this._append`L${l},${u}`,i&&(c<0&&(c=c%be+be),c>Ne?this._append`A${i},${i},0,1,${p},${e-a},${t-s}A${i},${i},0,1,${p},${this._x1=l},${this._y1=u}`:c>_e&&this._append`A${i},${i},0,${+(c>=ve)},${p},${this._x1=e+i*Math.cos(r)},${this._y1=t+i*Math.sin(r)}`)}rect(e,t,i,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i=+i}v${+n}h${-i}Z`}toString(){return this._}}function Ee(e){let t=3;return e.digits=function(i){if(!arguments.length)return t;if(null==i)t=null;else{const e=Math.floor(i);if(!(e>=0))throw new RangeError(`invalid digits: ${i}`);t=e}return e},()=>new xe(t)}function Me(e){this._context=e}function Se(e){return new Me(e)}function Ie(e){return e[0]}function Te(e){return e[1]}function Ae(e,t){var i=ce(!0),n=null,r=Se,o=null,a=Ee(s);function s(s){var l,u,p,c=(s=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(s)).length,d=!1;for(null==n&&(o=r(p=a())),l=0;l<=c;++l)!(l<c&&i(u=s[l],l,s))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+e(u,l,s),+t(u,l,s));if(p)return o=null,p+""||null}return e="function"==typeof e?e:void 0===e?Ie:ce(e),t="function"==typeof t?t:void 0===t?Te:ce(t),s.x=function(t){return arguments.length?(e="function"==typeof t?t:ce(+t),s):e},s.y=function(e){return arguments.length?(t="function"==typeof e?e:ce(+e),s):t},s.defined=function(e){return arguments.length?(i="function"==typeof e?e:ce(!!e),s):i},s.curve=function(e){return arguments.length?(r=e,null!=n&&(o=r(n)),s):r},s.context=function(e){return arguments.length?(null==e?n=o=null:o=r(n=e),s):n},s}Me.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};const $e=me(3);var Pe={draw(e,t){const i=.59436*me(t+he(t/28,.75)),n=i/2,r=n*$e;e.moveTo(0,i),e.lineTo(0,-i),e.moveTo(-r,-n),e.lineTo(r,n),e.moveTo(-r,n),e.lineTo(r,-n)}},ke={draw(e,t){const i=me(t/ge);e.moveTo(i,0),e.arc(0,0,i,0,ye)}},Le={draw(e,t){const i=me(t/5)/2;e.moveTo(-3*i,-i),e.lineTo(-i,-i),e.lineTo(-i,-3*i),e.lineTo(i,-3*i),e.lineTo(i,-i),e.lineTo(3*i,-i),e.lineTo(3*i,i),e.lineTo(i,i),e.lineTo(i,3*i),e.lineTo(-i,3*i),e.lineTo(-i,i),e.lineTo(-3*i,i),e.closePath()}};const De=me(1/3),Re=2*De;var Ve={draw(e,t){const i=me(t/Re),n=i*De;e.moveTo(0,-i),e.lineTo(n,0),e.lineTo(0,i),e.lineTo(-n,0),e.closePath()}},Oe={draw(e,t){const i=me(t),n=-i/2;e.rect(n,n,i,i)}};const Fe=fe(ge/10)/fe(7*ge/10),Ce=fe(ye/10)*Fe,je=-de(ye/10)*Fe;var Ue={draw(e,t){const i=me(.8908130915292852*t),n=Ce*i,r=je*i;e.moveTo(0,-i),e.lineTo(n,r);for(let t=1;t<5;++t){const o=ye*t/5,a=de(o),s=fe(o);e.lineTo(s*i,-a*i),e.lineTo(a*n-s*r,s*n+a*r)}e.closePath()}};const ze=me(3);var qe={draw(e,t){const i=-me(t/(3*ze));e.moveTo(0,2*i),e.lineTo(-ze*i,-i),e.lineTo(ze*i,-i),e.closePath()}};const Ge=-.5,Ye=me(3)/2,He=1/me(12),Be=3*(He/2+1);var Xe={draw(e,t){const i=me(t/Be),n=i/2,r=i*He,o=n,a=i*He+i,s=-o,l=a;e.moveTo(n,r),e.lineTo(o,a),e.lineTo(s,l),e.lineTo(Ge*n-Ye*r,Ye*n+Ge*r),e.lineTo(Ge*o-Ye*a,Ye*o+Ge*a),e.lineTo(Ge*s-Ye*l,Ye*s+Ge*l),e.lineTo(Ge*n+Ye*r,Ge*r-Ye*n),e.lineTo(Ge*o+Ye*a,Ge*a-Ye*o),e.lineTo(Ge*s+Ye*l,Ge*l-Ye*s),e.closePath()}};function We(e,t){let i=null,n=Ee(r);function r(){let r;if(i||(i=r=n()),e.apply(this,arguments).draw(i,+t.apply(this,arguments)),r)return i=null,r+""||null}return e="function"==typeof e?e:ce(e||ke),t="function"==typeof t?t:ce(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:ce(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:ce(+e),r):t},r.context=function(e){return arguments.length?(i=null==e?null:e,r):i},r}function Ke(e){return e}var Je=1e-6;function Ze(e){return"translate("+e+",0)"}function Qe(e){return"translate(0,"+e+")"}function et(e){return t=>+e(t)}function tt(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),i=>+e(i)+t}function it(){return!this.__axis}function nt(e,t){var i=[],n=null,r=null,o=6,a=6,s=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,u=1===e||4===e?-1:1,p=4===e||2===e?"x":"y",c=1===e||3===e?Ze:Qe;function d(d){var h=null==n?t.ticks?t.ticks.apply(t,i):t.domain():n,f=null==r?t.tickFormat?t.tickFormat.apply(t,i):Ke:r,m=Math.max(o,0)+s,g=t.range(),y=+g[0]+l,v=+g[g.length-1]+l,b=(t.bandwidth?tt:et)(t.copy(),l),_=d.selection?d.selection():d,N=_.selectAll(".domain").data([null]),w=_.selectAll(".tick").data(h,t).order(),x=w.exit(),E=w.enter().append("g").attr("class","tick"),M=w.select("line"),S=w.select("text");N=N.merge(N.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(E),M=M.merge(E.append("line").attr("stroke","currentColor").attr(p+"2",u*o)),S=S.merge(E.append("text").attr("fill","currentColor").attr(p,u*m).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),d!==_&&(N=N.transition(d),w=w.transition(d),M=M.transition(d),S=S.transition(d),x=x.transition(d).attr("opacity",Je).attr("transform",function(e){return isFinite(e=b(e))?c(e+l):this.getAttribute("transform")}),E.attr("opacity",Je).attr("transform",function(e){var t=this.parentNode.__axis;return c((t&&isFinite(t=t(e))?t:b(e))+l)})),x.remove(),N.attr("d",4===e||2===e?a?"M"+u*a+","+y+"H"+l+"V"+v+"H"+u*a:"M"+l+","+y+"V"+v:a?"M"+y+","+u*a+"V"+l+"H"+v+"V"+u*a:"M"+y+","+l+"H"+v),w.attr("opacity",1).attr("transform",function(e){return c(b(e)+l)}),M.attr(p+"2",u*o),S.attr(p,u*m).text(f),_.filter(it).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),_.each(function(){this.__axis=b})}return d.scale=function(e){return arguments.length?(t=e,d):t},d.ticks=function(){return i=Array.from(arguments),d},d.tickArguments=function(e){return arguments.length?(i=null==e?[]:Array.from(e),d):i.slice()},d.tickValues=function(e){return arguments.length?(n=null==e?null:Array.from(e),d):n&&n.slice()},d.tickFormat=function(e){return arguments.length?(r=e,d):r},d.tickSize=function(e){return arguments.length?(o=a=+e,d):o},d.tickSizeInner=function(e){return arguments.length?(o=+e,d):o},d.tickSizeOuter=function(e){return arguments.length?(a=+e,d):a},d.tickPadding=function(e){return arguments.length?(s=+e,d):s},d.offset=function(e){return arguments.length?(l=+e,d):l},d}function rt(e){return nt(3,e)}function ot(e){return nt(4,e)}function at(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function st(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function lt(e){let t,i,n;function r(e,n,r=0,o=e.length){if(r<o){if(0!==t(n,n))return o;do{const t=r+o>>>1;i(e[t],n)<0?r=t+1:o=t}while(r<o)}return r}return 2!==e.length?(t=at,i=(t,i)=>at(e(t),i),n=(t,i)=>e(t)-i):(t=e===at||e===st?e:ut,i=e,n=e),{left:r,center:function(e,t,i=0,o=e.length){const a=r(e,t,i,o-1);return a>i&&n(e[a-1],t)>-n(e[a],t)?a-1:a},right:function(e,n,r=0,o=e.length){if(r<o){if(0!==t(n,n))return o;do{const t=r+o>>>1;i(e[t],n)<=0?r=t+1:o=t}while(r<o)}return r}}}function ut(){return 0}const pt=lt(at).right;function ct(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}lt(function(e){return null===e?NaN:+e}).center;const dt=Math.sqrt(50),ht=Math.sqrt(10),ft=Math.sqrt(2);function mt(e,t,i){const n=(t-e)/Math.max(0,i),r=Math.floor(Math.log10(n)),o=n/Math.pow(10,r),a=o>=dt?10:o>=ht?5:o>=ft?2:1;let s,l,u;return r<0?(u=Math.pow(10,-r)/a,s=Math.round(e*u),l=Math.round(t*u),s/u<e&&++s,l/u>t&&--l,u=-u):(u=Math.pow(10,r)*a,s=Math.round(e/u),l=Math.round(t/u),s*u<e&&++s,l*u>t&&--l),l<s&&.5<=i&&i<2?mt(e,t,2*i):[s,l,u]}function gt(e,t,i){return mt(e=+e,t=+t,i=+i)[2]}function yt(e,t){let i;for(const t of e)null!=t&&(i<t||void 0===i&&t>=t)&&(i=t);return i}function vt(e,t){let i;for(const t of e)null!=t&&(i>t||void 0===i&&t>=t)&&(i=t);return i}function bt(e,t,i=0,n=1/0,r){if(t=Math.floor(t),i=Math.floor(Math.max(0,i)),n=Math.floor(Math.min(e.length-1,n)),!(i<=t&&t<=n))return e;for(r=void 0===r?ct:function(e=at){if(e===at)return ct;if("function"!=typeof e)throw new TypeError("compare is not a function");return(t,i)=>{const n=e(t,i);return n||0===n?n:(0===e(i,i))-(0===e(t,t))}}(r);n>i;){if(n-i>600){const o=n-i+1,a=t-i+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);bt(e,t,Math.max(i,Math.floor(t-a*l/o+u)),Math.min(n,Math.floor(t+(o-a)*l/o+u)),r)}const o=e[t];let a=i,s=n;for(_t(e,i,t),r(e[n],o)>0&&_t(e,i,n);a<s;){for(_t(e,a,s),++a,--s;r(e[a],o)<0;)++a;for(;r(e[s],o)>0;)--s}0===r(e[i],o)?_t(e,i,s):(++s,_t(e,s,n)),s<=t&&(i=s+1),t<=s&&(n=s-1)}return e}function _t(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function Nt(e,t,i){if((n=(e=Float64Array.from(function*(e){for(let t of e)null!=t&&(t=+t)>=t&&(yield t)}(e))).length)&&!isNaN(t=+t)){if(t<=0||n<2)return vt(e);if(t>=1)return yt(e);var n,r=(n-1)*t,o=Math.floor(r),a=yt(bt(e,o).subarray(0,o+1));return a+(vt(e.subarray(o+1))-a)*(r-o)}}function wt(e,t){let i=0;for(let t of e)(t=+t)&&(i+=t);return i}function xt(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Et(e,t,i){e.prototype=t.prototype=i,i.constructor=e}function Mt(e,t){var i=Object.create(e.prototype);for(var n in t)i[n]=t[n];return i}function St(){}var It=.7,Tt=1/It,At="\\s*([+-]?\\d+)\\s*",$t="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kt=/^#([0-9a-f]{3,8})$/,Lt=new RegExp(`^rgb\\(${At},${At},${At}\\)$`),Dt=new RegExp(`^rgb\\(${Pt},${Pt},${Pt}\\)$`),Rt=new RegExp(`^rgba\\(${At},${At},${At},${$t}\\)$`),Vt=new RegExp(`^rgba\\(${Pt},${Pt},${Pt},${$t}\\)$`),Ot=new RegExp(`^hsl\\(${$t},${Pt},${Pt}\\)$`),Ft=new RegExp(`^hsla\\(${$t},${Pt},${Pt},${$t}\\)$`),Ct={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function jt(){return this.rgb().formatHex()}function Ut(){return this.rgb().formatRgb()}function zt(e){var t,i;return e=(e+"").trim().toLowerCase(),(t=kt.exec(e))?(i=t[1].length,t=parseInt(t[1],16),6===i?qt(t):3===i?new Ht(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===i?Gt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===i?Gt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Lt.exec(e))?new Ht(t[1],t[2],t[3],1):(t=Dt.exec(e))?new Ht(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Rt.exec(e))?Gt(t[1],t[2],t[3],t[4]):(t=Vt.exec(e))?Gt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Ot.exec(e))?Zt(t[1],t[2]/100,t[3]/100,1):(t=Ft.exec(e))?Zt(t[1],t[2]/100,t[3]/100,t[4]):Ct.hasOwnProperty(e)?qt(Ct[e]):"transparent"===e?new Ht(NaN,NaN,NaN,0):null}function qt(e){return new Ht(e>>16&255,e>>8&255,255&e,1)}function Gt(e,t,i,n){return n<=0&&(e=t=i=NaN),new Ht(e,t,i,n)}function Yt(e,t,i,n){return 1===arguments.length?((r=e)instanceof St||(r=zt(r)),r?new Ht((r=r.rgb()).r,r.g,r.b,r.opacity):new Ht):new Ht(e,t,i,null==n?1:n);var r}function Ht(e,t,i,n){this.r=+e,this.g=+t,this.b=+i,this.opacity=+n}function Bt(){return`#${Jt(this.r)}${Jt(this.g)}${Jt(this.b)}`}function Xt(){const e=Wt(this.opacity);return`${1===e?"rgb(":"rgba("}${Kt(this.r)}, ${Kt(this.g)}, ${Kt(this.b)}${1===e?")":`, ${e})`}`}function Wt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Kt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Jt(e){return((e=Kt(e))<16?"0":"")+e.toString(16)}function Zt(e,t,i,n){return n<=0?e=t=i=NaN:i<=0||i>=1?e=t=NaN:t<=0&&(e=NaN),new ei(e,t,i,n)}function Qt(e){if(e instanceof ei)return new ei(e.h,e.s,e.l,e.opacity);if(e instanceof St||(e=zt(e)),!e)return new ei;if(e instanceof ei)return e;var t=(e=e.rgb()).r/255,i=e.g/255,n=e.b/255,r=Math.min(t,i,n),o=Math.max(t,i,n),a=NaN,s=o-r,l=(o+r)/2;return s?(a=t===o?(i-n)/s+6*(i<n):i===o?(n-t)/s+2:(t-i)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new ei(a,s,l,e.opacity)}function ei(e,t,i,n){this.h=+e,this.s=+t,this.l=+i,this.opacity=+n}function ti(e){return(e=(e||0)%360)<0?e+360:e}function ii(e){return Math.max(0,Math.min(1,e||0))}function ni(e,t,i){return 255*(e<60?t+(i-t)*e/60:e<180?i:e<240?t+(i-t)*(240-e)/60:t)}Et(St,zt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:jt,formatHex:jt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Qt(this).formatHsl()},formatRgb:Ut,toString:Ut}),Et(Ht,Yt,Mt(St,{brighter(e){return e=null==e?Tt:Math.pow(Tt,e),new Ht(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?It:Math.pow(It,e),new Ht(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ht(Kt(this.r),Kt(this.g),Kt(this.b),Wt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bt,formatHex:Bt,formatHex8:function(){return`#${Jt(this.r)}${Jt(this.g)}${Jt(this.b)}${Jt(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Xt,toString:Xt})),Et(ei,function(e,t,i,n){return 1===arguments.length?Qt(e):new ei(e,t,i,null==n?1:n)},Mt(St,{brighter(e){return e=null==e?Tt:Math.pow(Tt,e),new ei(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?It:Math.pow(It,e),new ei(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*t,r=2*i-n;return new Ht(ni(e>=240?e-240:e+120,r,n),ni(e,r,n),ni(e<120?e+240:e-120,r,n),this.opacity)},clamp(){return new ei(ti(this.h),ii(this.s),ii(this.l),Wt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Wt(this.opacity);return`${1===e?"hsl(":"hsla("}${ti(this.h)}, ${100*ii(this.s)}%, ${100*ii(this.l)}%${1===e?")":`, ${e})`}`}}));var ri=e=>()=>e;function oi(e,t){var i=t-e;return i?function(e,t){return function(i){return e+i*t}}(e,i):ri(isNaN(e)?t:e)}var ai=function e(t){var i=function(e){return 1===(e=+e)?oi:function(t,i){return i-t?function(e,t,i){return e=Math.pow(e,i),t=Math.pow(t,i)-e,i=1/i,function(n){return Math.pow(e+n*t,i)}}(t,i,e):ri(isNaN(t)?i:t)}}(t);function n(e,t){var n=i((e=Yt(e)).r,(t=Yt(t)).r),r=i(e.g,t.g),o=i(e.b,t.b),a=oi(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=r(t),e.b=o(t),e.opacity=a(t),e+""}}return n.gamma=e,n}(1);function si(e,t){t||(t=[]);var i,n=e?Math.min(t.length,e.length):0,r=t.slice();return function(o){for(i=0;i<n;++i)r[i]=e[i]*(1-o)+t[i]*o;return r}}function li(e,t){var i,n=t?t.length:0,r=e?Math.min(n,e.length):0,o=new Array(r),a=new Array(n);for(i=0;i<r;++i)o[i]=mi(e[i],t[i]);for(;i<n;++i)a[i]=t[i];return function(e){for(i=0;i<r;++i)a[i]=o[i](e);return a}}function ui(e,t){var i=new Date;return e=+e,t=+t,function(n){return i.setTime(e*(1-n)+t*n),i}}function pi(e,t){return e=+e,t=+t,function(i){return e*(1-i)+t*i}}function ci(e,t){var i,n={},r={};for(i in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)i in e?n[i]=mi(e[i],t[i]):r[i]=t[i];return function(e){for(i in n)r[i]=n[i](e);return r}}var di=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hi=new RegExp(di.source,"g");function fi(e,t){var i,n,r,o=di.lastIndex=hi.lastIndex=0,a=-1,s=[],l=[];for(e+="",t+="";(i=di.exec(e))&&(n=hi.exec(t));)(r=n.index)>o&&(r=t.slice(o,r),s[a]?s[a]+=r:s[++a]=r),(i=i[0])===(n=n[0])?s[a]?s[a]+=n:s[++a]=n:(s[++a]=null,l.push({i:a,x:pi(i,n)})),o=hi.lastIndex;return o<t.length&&(r=t.slice(o),s[a]?s[a]+=r:s[++a]=r),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var i,n=0;n<t;++n)s[(i=l[n]).i]=i.x(e);return s.join("")})}function mi(e,t){var i,n=typeof t;return null==t||"boolean"===n?ri(t):("number"===n?pi:"string"===n?(i=zt(t))?(t=i,ai):fi:t instanceof zt?ai:t instanceof Date?ui:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?si:Array.isArray(t)?li:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?ci:pi)(e,t)}function gi(e,t){return e=+e,t=+t,function(i){return Math.round(e*(1-i)+t*i)}}function yi(e){return+e}var vi=[0,1];function bi(e){return e}function _i(e,t){return(t-=e=+e)?function(i){return(i-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Ni(e,t,i){var n=e[0],r=e[1],o=t[0],a=t[1];return r<n?(n=_i(r,n),o=i(a,o)):(n=_i(n,r),o=i(o,a)),function(e){return o(n(e))}}function wi(e,t,i){var n=Math.min(e.length,t.length)-1,r=new Array(n),o=new Array(n),a=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<n;)r[a]=_i(e[a],e[a+1]),o[a]=i(t[a],t[a+1]);return function(t){var i=pt(e,t,1,n)-1;return o[i](r[i](t))}}function xi(e,t){if((i=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var i,n=e.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+e.slice(i+1)]}function Ei(e){return(e=xi(Math.abs(e)))?e[1]:NaN}var Mi,Si=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ii(e){if(!(t=Si.exec(e)))throw new Error("invalid format: "+e);var t;return new Ti({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Ti(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Ai(e,t){var i=xi(e,t);if(!i)return e+"";var n=i[0],r=i[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}Ii.prototype=Ti.prototype,Ti.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var $i={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ai(100*e,t),r:Ai,s:function(e,t){var i=xi(e,t);if(!i)return e+"";var n=i[0],r=i[1],o=r-(Mi=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+xi(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Pi(e){return e}var ki,Li,Di,Ri=Array.prototype.map,Vi=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Oi(e){var t=e.domain;return e.ticks=function(e){var i=t();return function(e,t,i){if(!((i=+i)>0))return[];if((e=+e)===(t=+t))return[e];const n=t<e,[r,o,a]=n?mt(t,e,i):mt(e,t,i);if(!(o>=r))return[];const s=o-r+1,l=new Array(s);if(n)if(a<0)for(let e=0;e<s;++e)l[e]=(o-e)/-a;else for(let e=0;e<s;++e)l[e]=(o-e)*a;else if(a<0)for(let e=0;e<s;++e)l[e]=(r+e)/-a;else for(let e=0;e<s;++e)l[e]=(r+e)*a;return l}(i[0],i[i.length-1],null==e?10:e)},e.tickFormat=function(e,i){var n=t();return function(e,t,i,n){var r,o=function(e,t,i){i=+i;const n=(t=+t)<(e=+e),r=n?gt(t,e,i):gt(e,t,i);return(n?-1:1)*(r<0?1/-r:r)}(e,t,i);switch((n=Ii(null==n?",f":n)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=n.precision||isNaN(r=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ei(t)/3)))-Ei(Math.abs(e)))}(o,a))||(n.precision=r),Di(n,a);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(r=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ei(t)-Ei(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(n.precision=r-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(r=function(e){return Math.max(0,-Ei(Math.abs(e)))}(o))||(n.precision=r-2*("%"===n.type))}return Li(n)}(n[0],n[n.length-1],null==e?10:e,i)},e.nice=function(i){null==i&&(i=10);var n,r,o=t(),a=0,s=o.length-1,l=o[a],u=o[s],p=10;for(u<l&&(r=l,l=u,u=r,r=a,a=s,s=r);p-- >0;){if((r=gt(l,u,i))===n)return o[a]=l,o[s]=u,t(o);if(r>0)l=Math.floor(l/r)*r,u=Math.ceil(u/r)*r;else{if(!(r<0))break;l=Math.ceil(l*r)/r,u=Math.floor(u*r)/r}n=r}return e},e}function Fi(){var e=function(){var e,t,i,n,r,o,a=vi,s=vi,l=mi,u=bi;function p(){var e=Math.min(a.length,s.length);return u!==bi&&(u=function(e,t){var i;return e>t&&(i=e,e=t,t=i),function(i){return Math.max(e,Math.min(t,i))}}(a[0],a[e-1])),n=e>2?wi:Ni,r=o=null,c}function c(t){return null==t||isNaN(t=+t)?i:(r||(r=n(a.map(e),s,l)))(e(u(t)))}return c.invert=function(i){return u(t((o||(o=n(s,a.map(e),pi)))(i)))},c.domain=function(e){return arguments.length?(a=Array.from(e,yi),p()):a.slice()},c.range=function(e){return arguments.length?(s=Array.from(e),p()):s.slice()},c.rangeRound=function(e){return s=Array.from(e),l=gi,p()},c.clamp=function(e){return arguments.length?(u=!!e||bi,p()):u!==bi},c.interpolate=function(e){return arguments.length?(l=e,p()):l},c.unknown=function(e){return arguments.length?(i=e,c):i},function(i,n){return e=i,t=n,p()}}()(bi,bi);return e.copy=function(){return t=e,Fi().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());var t},xt.apply(e,arguments),Oi(e)}ki=function(e){var t,i,n=void 0===e.grouping||void 0===e.thousands?Pi:(t=Ri.call(e.grouping,Number),i=e.thousands+"",function(e,n){for(var r=e.length,o=[],a=0,s=t[0],l=0;r>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),o.push(e.substring(r-=s,r+s)),!((l+=s+1)>n));)s=t[a=(a+1)%t.length];return o.reverse().join(i)}),r=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Pi:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(Ri.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",p=void 0===e.nan?"NaN":e.nan+"";function c(e){var t=(e=Ii(e)).fill,i=e.align,c=e.sign,d=e.symbol,h=e.zero,f=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):$i[v]||(void 0===g&&(g=12),y=!0,v="g"),(h||"0"===t&&"="===i)&&(h=!0,t="0",i="=");var b="$"===d?r:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",_="$"===d?o:/[%p]/.test(v)?l:"",N=$i[v],w=/[defgprs%]/.test(v);function x(e){var r,o,l,d=b,x=_;if("c"===v)x=N(e)+x,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?p:N(Math.abs(e),g),y&&(e=function(e){e:for(var t,i=e.length,n=1,r=-1;n<i;++n)switch(e[n]){case".":r=t=n;break;case"0":0===r&&(r=n),t=n;break;default:if(!+e[n])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(t+1):e}(e)),E&&0===+e&&"+"!==c&&(E=!1),d=(E?"("===c?c:u:"-"===c||"("===c?"":c)+d,x=("s"===v?Vi[8+Mi/3]:"")+x+(E&&"("===c?")":""),w)for(r=-1,o=e.length;++r<o;)if(48>(l=e.charCodeAt(r))||l>57){x=(46===l?a+e.slice(r+1):e.slice(r))+x,e=e.slice(0,r);break}}m&&!h&&(e=n(e,1/0));var M=d.length+e.length+x.length,S=M<f?new Array(f-M+1).join(t):"";switch(m&&h&&(e=n(S+e,S.length?f-x.length:1/0),S=""),i){case"<":e=d+e+x+S;break;case"=":e=d+S+e+x;break;case"^":e=S.slice(0,M=S.length>>1)+d+e+x+S.slice(M);break;default:e=S+d+e+x}return s(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),x.toString=function(){return e+""},x}return{format:c,formatPrefix:function(e,t){var i=c(((e=Ii(e)).type="f",e)),n=3*Math.max(-8,Math.min(8,Math.floor(Ei(t)/3))),r=Math.pow(10,-n),o=Vi[8+n/3];return function(e){return i(r*e)+o}}}}({thousands:",",grouping:[3],currency:["$",""]}),Li=ki.format,Di=ki.formatPrefix;var Ci={value:()=>{}};function ji(){for(var e,t=0,i=arguments.length,n={};t<i;++t){if(!(e=arguments[t]+"")||e in n||/[\s.]/.test(e))throw new Error("illegal type: "+e);n[e]=[]}return new Ui(n)}function Ui(e){this._=e}function zi(e,t){for(var i,n=0,r=e.length;n<r;++n)if((i=e[n]).name===t)return i.value}function qi(e,t,i){for(var n=0,r=e.length;n<r;++n)if(e[n].name===t){e[n]=Ci,e=e.slice(0,n).concat(e.slice(n+1));break}return null!=i&&e.push({name:t,value:i}),e}Ui.prototype=ji.prototype={constructor:Ui,on:function(e,t){var i,n,r=this._,o=(n=r,(e+"").trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");if(i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<s;)if(i=(e=o[a]).type)r[i]=qi(r[i],e.name,t);else if(null==t)for(i in r)r[i]=qi(r[i],e.name,null);return this}for(;++a<s;)if((i=(e=o[a]).type)&&(i=zi(r[i],e.name)))return i},copy:function(){var e={},t=this._;for(var i in t)e[i]=t[i].slice();return new Ui(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),o=0;o<i;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,i=(n=this._[e]).length;o<i;++o)n[o].value.apply(t,r)},apply:function(e,t,i){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],r=0,o=n.length;r<o;++r)n[r].value.apply(t,i)}};const Gi={passive:!1},Yi={capture:!0,passive:!1};function Hi(e){e.stopImmediatePropagation()}function Bi(e){e.preventDefault(),e.stopImmediatePropagation()}var Xi=e=>()=>e;function Wi(e,{sourceEvent:t,subject:i,target:n,identifier:r,active:o,x:a,y:s,dx:l,dy:u,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:p}})}function Ki(e){return!e.ctrlKey&&!e.button}function Ji(){return this.parentNode}function Zi(e,t){return null==t?{x:e.x,y:e.y}:t}function Qi(){return navigator.maxTouchPoints||"ontouchstart"in this}function en(){var e,t,i,n,r=Ki,o=Ji,a=Zi,s=Qi,l={},u=ji("start","drag","end"),p=0,c=0;function d(e){e.on("mousedown.drag",h).filter(s).on("touchstart.drag",g).on("touchmove.drag",y,Gi).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(a,s){if(!n&&r.call(this,a,s)){var l=b(this,o.call(this,a,s),a,s,"mouse");l&&(ue(a.view).on("mousemove.drag",f,Yi).on("mouseup.drag",m,Yi),function(e){var t=e.document.documentElement,i=ue(e).on("dragstart.drag",Bi,Yi);"onselectstart"in t?i.on("selectstart.drag",Bi,Yi):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}(a.view),Hi(a),i=!1,e=a.clientX,t=a.clientY,l("start",a))}}function f(n){if(Bi(n),!i){var r=n.clientX-e,o=n.clientY-t;i=r*r+o*o>c}l.mouse("drag",n)}function m(e){ue(e.view).on("mousemove.drag mouseup.drag",null),function(e,t){var i=e.document.documentElement,n=ue(e).on("dragstart.drag",null);t&&(n.on("click.drag",Bi,Yi),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(e.view,i),Bi(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var i,n,a=e.changedTouches,s=o.call(this,e,t),l=a.length;for(i=0;i<l;++i)(n=b(this,s,e,t,a[i].identifier,a[i]))&&(Hi(e),n("start",e,a[i]))}}function y(e){var t,i,n=e.changedTouches,r=n.length;for(t=0;t<r;++t)(i=l[n[t].identifier])&&(Bi(e),i("drag",e,n[t]))}function v(e){var t,i,r=e.changedTouches,o=r.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),t=0;t<o;++t)(i=l[r[t].identifier])&&(Hi(e),i("end",e,r[t]))}function b(e,t,i,n,r,o){var s,c,h,f=u.copy(),m=pe(o||i,t);if(null!=(h=a.call(e,new Wi("beforestart",{sourceEvent:i,target:d,identifier:r,active:p,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),n)))return s=h.x-m[0]||0,c=h.y-m[1]||0,function i(o,a,u){var g,y=m;switch(o){case"start":l[r]=i,g=p++;break;case"end":delete l[r],--p;case"drag":m=pe(u||a,t),g=p}f.call(o,e,new Wi(o,{sourceEvent:a,subject:h,target:d,identifier:r,active:g,x:m[0]+s,y:m[1]+c,dx:m[0]-y[0],dy:m[1]-y[1],dispatch:f}),n)}}return d.filter=function(e){return arguments.length?(r="function"==typeof e?e:Xi(!!e),d):r},d.container=function(e){return arguments.length?(o="function"==typeof e?e:Xi(e),d):o},d.subject=function(e){return arguments.length?(a="function"==typeof e?e:Xi(e),d):a},d.touchable=function(e){return arguments.length?(s="function"==typeof e?e:Xi(!!e),d):s},d.on=function(){var e=u.on.apply(u,arguments);return e===u?d:e},d.clickDistance=function(e){return arguments.length?(c=(e=+e)*e,d):Math.sqrt(c)},d}Wi.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var tn=Object.freeze({__proto__:null,axisBottom:rt,axisLeft:ot,drag:en,line:Ae,scaleLinear:Fi,select:ue,selectAll:function(e){return"string"==typeof e?new le([document.querySelectorAll(e)],[document.documentElement]):new le([u(e)],se)},symbol:We,symbolAsterisk:Pe,symbolCircle:ke,symbolCross:Le,symbolDiamond:Ve,symbolSquare:Oe,symbolStar:Ue,symbolTriangle:qe,symbolWye:Xe});const nn="#00B0F0",rn="#E46C0A",on="#490092",an="#490092",sn="#A6A6A6",ln="#6495ED",un="#000000",pn={font:{default:"'Arial', sans-serif",valid:["'Arial', sans-serif","Arial","'Arial Black'","'Arial Unicode MS'","Calibri","Cambria","'Cambria Math'","Candara","'Comic Sans MS'","Consolas","Constantia","Corbel","'Courier New'","wf_standard-font, helvetica, arial, sans-serif","wf_standard-font_light, helvetica, arial, sans-serif","Georgia","'Lucida Sans Unicode'","'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif","'Segoe UI Light', wf_segoe-ui_light, helvetica, arial, sans-serif","'Segoe UI Semibold', wf_segoe-ui_semibold, helvetica, arial, sans-serif","'Segoe UI Bold', wf_segoe-ui_bold, helvetica, arial, sans-serif","Symbol","Tahoma","'Times New Roman'","'Trebuchet MS'","Verdana","Wingdings"]},size:{default:10,options:{minValue:{value:0},maxValue:{value:100}}}},cn={canvas:{description:"Canvas Settings",displayName:"Canvas Settings",settingsGroups:{all:{show_errors:{displayName:"Show Errors on Canvas",type:"ToggleSwitch",default:!0},lower_padding:{displayName:"Padding Below Plot (pixels):",type:"NumUpDown",default:10},upper_padding:{displayName:"Padding Above Plot (pixels):",type:"NumUpDown",default:10},left_padding:{displayName:"Padding Left of Plot (pixels):",type:"NumUpDown",default:10},right_padding:{displayName:"Padding Right of Plot (pixels):",type:"NumUpDown",default:10}}}},funnel:{description:"Funnel Settings",displayName:"Data Settings",settingsGroups:{all:{chart_type:{displayName:"Chart Type",type:"Dropdown",default:"PR",valid:["SR","PR","RC"],items:[{displayName:"Indirectly Standardised (HSMR)",value:"SR"},{displayName:"Proportion",value:"PR"},{displayName:"Rate",value:"RC"}]},od_adjust:{displayName:"OD Adjustment",type:"Dropdown",default:"no",valid:["auto","yes","no"],items:[{displayName:"Automatic",value:"auto"},{displayName:"Yes",value:"yes"},{displayName:"No",value:"no"}]},multiplier:{displayName:"Multiplier",type:"NumUpDown",default:1,options:{minValue:{value:0}}},sig_figs:{displayName:"Decimals to Report:",type:"NumUpDown",default:2,options:{minValue:{value:0},maxValue:{value:20}}},perc_labels:{displayName:"Report as percentage",type:"Dropdown",default:"Automatic",valid:["Automatic","Yes","No"],items:[{displayName:"Automatic",value:"Automatic"},{displayName:"Yes",value:"Yes"},{displayName:"No",value:"No"}]},transformation:{displayName:"Transformation",type:"Dropdown",default:"none",valid:["none","ln","log10","sqrt"],items:[{displayName:"None",value:"none"},{displayName:"Natural Log (y+1)",value:"ln"},{displayName:"Log10 (y+1)",value:"log10"},{displayName:"Square-Root",value:"sqrt"}]},ttip_show_group:{displayName:"Show Group in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_group:{displayName:"Group Tooltip Label",type:"TextInput",default:"Group"},ttip_show_numerator:{displayName:"Show Numerator in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_numerator:{displayName:"Numerator Tooltip Label",type:"TextInput",default:"Numerator"},ttip_show_denominator:{displayName:"Show Denominator in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_denominator:{displayName:"Denominator Tooltip Label",type:"TextInput",default:"Denominator"},ttip_show_value:{displayName:"Show Value in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_value:{displayName:"Value Tooltip Label",type:"TextInput",default:"Automatic"},ll_truncate:{displayName:"Truncate Lower Limits at:",type:"NumUpDown",default:null},ul_truncate:{displayName:"Truncate Upper Limits at:",type:"NumUpDown",default:null}}}},outliers:{description:"Outlier Settings",displayName:"Outlier Settings",settingsGroups:{General:{process_flag_type:{displayName:"Type of Change to Flag",type:"Dropdown",default:"both",valid:["both","improvement","deterioration"],items:[{displayName:"Both",value:"both"},{displayName:"Improvement (Imp.)",value:"improvement"},{displayName:"Deterioration (Det.)",value:"deterioration"}]},improvement_direction:{displayName:"Improvement Direction",type:"Dropdown",default:"increase",valid:["increase","neutral","decrease"],items:[{displayName:"Increase",value:"increase"},{displayName:"Neutral",value:"neutral"},{displayName:"Decrease",value:"decrease"}]}},"Three Sigma Outliers":{three_sigma:{displayName:"Three Sigma Outliers",type:"ToggleSwitch",default:!1},three_sigma_colour_improvement:{displayName:"Imp. Three Sigma Colour",type:"ColorPicker",default:nn},three_sigma_colour_deterioration:{displayName:"Det. Three Sigma Colour",type:"ColorPicker",default:rn},three_sigma_colour_neutral_low:{displayName:"Neutral (Low) Three Sigma Colour",type:"ColorPicker",default:on},three_sigma_colour_neutral_high:{displayName:"Neutral (High) Three Sigma Colour",type:"ColorPicker",default:an}},"Two Sigma Outliers":{two_sigma:{displayName:"Two Sigma Outliers",type:"ToggleSwitch",default:!1},two_sigma_colour_improvement:{displayName:"Imp. Two Sigma Colour",type:"ColorPicker",default:nn},two_sigma_colour_deterioration:{displayName:"Det. Two Sigma Colour",type:"ColorPicker",default:rn},two_sigma_colour_neutral_low:{displayName:"Neutral (Low) Two Sigma Colour",type:"ColorPicker",default:on},two_sigma_colour_neutral_high:{displayName:"Neutral (High) Two Sigma Colour",type:"ColorPicker",default:an}}}},scatter:{description:"Scatter Settings",displayName:"Scatter Settings",settingsGroups:{Dots:{shape:{displayName:"Shape",type:"Dropdown",default:"Circle",valid:["Circle","Cross","Diamond","Square","Star","Triangle","Wye"],items:[{displayName:"Circle",value:"Circle"},{displayName:"Cross",value:"Cross"},{displayName:"Diamond",value:"Diamond"},{displayName:"Square",value:"Square"},{displayName:"Star",value:"Star"},{displayName:"Triangle",value:"Triangle"},{displayName:"Wye",value:"Wye"}]},size:{displayName:"Size",type:"NumUpDown",default:2.5,options:{minValue:{value:0},maxValue:{value:100}}},colour:{displayName:"Colour",type:"ColorPicker",default:sn},colour_outline:{displayName:"Outline Colour",type:"ColorPicker",default:sn},width_outline:{displayName:"Outline Width",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:100}}},opacity:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_selected:{displayName:"Opacity if Selected",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected:{displayName:"Opacity if Unselected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}}},"Group Text":{use_group_text:{displayName:"Show Group Text",type:"ToggleSwitch",default:!1},scatter_text_font:{displayName:"Group Text Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},scatter_text_size:{displayName:"Group Text Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},scatter_text_colour:{displayName:"Group Text Colour",type:"ColorPicker",default:un},scatter_text_opacity:{displayName:"Group Text Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},scatter_text_opacity_selected:{displayName:"Group Text Opacity if Selected",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},scatter_text_opacity_unselected:{displayName:"Group Text Opacity if Unselected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}}}}},lines:{description:"Line Settings",displayName:"Line Settings",settingsGroups:{Target:{show_target:{displayName:"Show Target",type:"ToggleSwitch",default:!0},width_target:{displayName:"Line Width",type:"NumUpDown",default:1.5,options:{minValue:{value:0},maxValue:{value:100}}},type_target:{displayName:"Line Type",type:"Dropdown",default:"10 0",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},colour_target:{displayName:"Line Colour",type:"ColorPicker",default:un},opacity_target:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected_target:{displayName:"Opacity if Any Selected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}},ttip_show_target:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},ttip_label_target:{displayName:"Tooltip Label",type:"TextInput",default:"Centerline"},plot_label_show_target:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},plot_label_position_target:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:["above","below","beside"],items:[{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}]},plot_label_vpad_target:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},plot_label_hpad_target:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},plot_label_font_target:{displayName:"Value Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},plot_label_size_target:{displayName:"Value Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},plot_label_colour_target:{displayName:"Value Colour",type:"ColorPicker",default:un},plot_label_prefix_target:{displayName:"Value Prefix",type:"TextInput",default:""}},"Alt. Target":{show_alt_target:{displayName:"Show Alt. Target Line",type:"ToggleSwitch",default:!1},alt_target:{displayName:"Additional Target Value:",type:"NumUpDown",default:null},width_alt_target:{displayName:"Line Width",type:"NumUpDown",default:1.5,options:{minValue:{value:0},maxValue:{value:100}}},type_alt_target:{displayName:"Line Type",type:"Dropdown",default:"10 0",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},colour_alt_target:{displayName:"Line Colour",type:"ColorPicker",default:un},opacity_alt_target:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected_alt_target:{displayName:"Opacity if Any Selected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}},join_rebaselines_alt_target:{displayName:"Connect Rebaselined Limits",type:"ToggleSwitch",default:!1},ttip_show_alt_target:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},ttip_label_alt_target:{displayName:"Tooltip Label",type:"TextInput",default:"Alt. Target"},plot_label_show_alt_target:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},plot_label_position_alt_target:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:["above","below","beside"],items:[{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}]},plot_label_vpad_alt_target:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},plot_label_hpad_alt_target:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},plot_label_font_alt_target:{displayName:"Value Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},plot_label_size_alt_target:{displayName:"Value Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},plot_label_colour_alt_target:{displayName:"Value Colour",type:"ColorPicker",default:un},plot_label_prefix_alt_target:{displayName:"Value Prefix",type:"TextInput",default:""}},"68% Limits":{show_68:{displayName:"Show 68% Lines",type:"ToggleSwitch",default:!1},width_68:{displayName:"Line Width",type:"NumUpDown",default:2,options:{minValue:{value:0},maxValue:{value:100}}},type_68:{displayName:"Line Type",type:"Dropdown",default:"2 5",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},colour_68:{displayName:"Line Colour",type:"ColorPicker",default:ln},opacity_68:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected_68:{displayName:"Opacity if Any Selected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}},ttip_show_68:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},ttip_label_68:{displayName:"Tooltip Label",type:"TextInput",default:"68% Limit"},plot_label_show_68:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},plot_label_position_68:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:["outside","inside","above","below","beside"],items:[{displayName:"Outside",value:"outside"},{displayName:"Inside",value:"inside"},{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}]},plot_label_vpad_68:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},plot_label_hpad_68:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},plot_label_font_68:{displayName:"Value Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},plot_label_size_68:{displayName:"Value Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},plot_label_colour_68:{displayName:"Value Colour",type:"ColorPicker",default:un},plot_label_prefix_68:{displayName:"Value Prefix",type:"TextInput",default:""}},"95% Limits":{show_95:{displayName:"Show 95% Lines",type:"ToggleSwitch",default:!0},width_95:{displayName:"Line Width",type:"NumUpDown",default:2,options:{minValue:{value:0},maxValue:{value:100}}},type_95:{displayName:"Line Type",type:"Dropdown",default:"2 5",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},colour_95:{displayName:"Line Colour",type:"ColorPicker",default:ln},opacity_95:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected_95:{displayName:"Opacity if Any Selected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}},ttip_show_95:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},ttip_label_95:{displayName:"Tooltip Label",type:"TextInput",default:"95% Limit"},plot_label_show_95:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},plot_label_position_95:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:["outside","inside","above","below","beside"],items:[{displayName:"Outside",value:"outside"},{displayName:"Inside",value:"inside"},{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}]},plot_label_vpad_95:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},plot_label_hpad_95:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},plot_label_font_95:{displayName:"Value Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},plot_label_size_95:{displayName:"Value Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},plot_label_colour_95:{displayName:"Value Colour",type:"ColorPicker",default:un},plot_label_prefix_95:{displayName:"Value Prefix",type:"TextInput",default:""}},"99% Limits":{show_99:{displayName:"Show 99% Lines",type:"ToggleSwitch",default:!0},width_99:{displayName:"Line Width",type:"NumUpDown",default:2,options:{minValue:{value:0},maxValue:{value:100}}},type_99:{displayName:"Line Type",type:"Dropdown",default:"10 10",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},colour_99:{displayName:"Line Colour",type:"ColorPicker",default:ln},opacity_99:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected_99:{displayName:"Opacity if Any Selected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}},ttip_show_99:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},ttip_label_99:{displayName:"Tooltip Label",type:"TextInput",default:"99% Limit"},plot_label_show_99:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},plot_label_position_99:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:["outside","inside","above","below","beside"],items:[{displayName:"Outside",value:"outside"},{displayName:"Inside",value:"inside"},{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}]},plot_label_vpad_99:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},plot_label_hpad_99:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},plot_label_font_99:{displayName:"Value Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},plot_label_size_99:{displayName:"Value Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},plot_label_colour_99:{displayName:"Value Colour",type:"ColorPicker",default:un},plot_label_prefix_99:{displayName:"Value Prefix",type:"TextInput",default:""}}}},x_axis:{description:"X Axis Settings",displayName:"X Axis Settings",settingsGroups:{Axis:{xlimit_colour:{displayName:"Axis Colour",type:"ColorPicker",default:un},xlimit_l:{displayName:"Lower Limit",type:"NumUpDown",default:null},xlimit_u:{displayName:"Upper Limit",type:"NumUpDown",default:null}},Ticks:{xlimit_ticks:{displayName:"Draw Ticks",type:"ToggleSwitch",default:!0},xlimit_tick_count:{displayName:"Maximum Ticks",type:"NumUpDown",default:10,options:{minValue:{value:0},maxValue:{value:100}}},xlimit_tick_font:{displayName:"Tick Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},xlimit_tick_size:{displayName:"Tick Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},xlimit_tick_colour:{displayName:"Tick Font Colour",type:"ColorPicker",default:un},xlimit_tick_rotation:{displayName:"Tick Rotation (Degrees)",type:"NumUpDown",default:0,options:{minValue:{value:-360},maxValue:{value:360}}}},Label:{xlimit_label:{displayName:"Label",type:"TextInput",default:null},xlimit_label_font:{displayName:"Label Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},xlimit_label_size:{displayName:"Label Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},xlimit_label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:un}}}},y_axis:{description:"Y Axis Settings",displayName:"Y Axis Settings",settingsGroups:{Axis:{ylimit_colour:{displayName:"Axis Colour",type:"ColorPicker",default:un},ylimit_sig_figs:{displayName:"Tick Decimal Places",type:"NumUpDown",default:null,options:{minValue:{value:0},maxValue:{value:100}}},ylimit_l:{displayName:"Lower Limit",type:"NumUpDown",default:null},ylimit_u:{displayName:"Upper Limit",type:"NumUpDown",default:null}},Ticks:{ylimit_ticks:{displayName:"Draw Ticks",type:"ToggleSwitch",default:!0},ylimit_tick_count:{displayName:"Maximum Ticks",type:"NumUpDown",default:10,options:{minValue:{value:0},maxValue:{value:100}}},ylimit_tick_font:{displayName:"Tick Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},ylimit_tick_size:{displayName:"Tick Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},ylimit_tick_colour:{displayName:"Tick Font Colour",type:"ColorPicker",default:un},ylimit_tick_rotation:{displayName:"Tick Rotation (Degrees)",type:"NumUpDown",default:0,options:{minValue:{value:-360},maxValue:{value:360}}}},Label:{ylimit_label:{displayName:"Label",type:"TextInput",default:null},ylimit_label_font:{displayName:"Label Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},ylimit_label_size:{displayName:"Label Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},ylimit_label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:un}}}},labels:{description:"Labels Settings",displayName:"Labels Settings",settingsGroups:{all:{show_labels:{displayName:"Show Value Labels",type:"ToggleSwitch",default:!0},label_position:{displayName:"Label Position",type:"Dropdown",default:"top",valid:["top","bottom"],items:[{displayName:"Top",value:"top"},{displayName:"Bottom",value:"bottom"}]},label_y_offset:{displayName:"Label Offset from Top/Bottom (px)",type:"NumUpDown",default:20},label_line_offset:{displayName:"Label Offset from Connecting Line (px)",type:"NumUpDown",default:5},label_angle_offset:{displayName:"Label Angle Offset (degrees)",type:"NumUpDown",default:0,options:{minValue:{value:-90},maxValue:{value:90}}},label_font:{displayName:"Label Font",type:"FontPicker",default:pn.font.default,valid:pn.font.valid},label_size:{displayName:"Label Font Size",type:"NumUpDown",default:pn.size.default,options:pn.size.options},label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:un},label_line_colour:{displayName:"Connecting Line Colour",type:"ColorPicker",default:un},label_line_width:{displayName:"Connecting Line Width",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:100}}},label_line_type:{displayName:"Connecting Line Type",type:"Dropdown",default:"10 0",valid:["10 0","10 10","2 5"],items:[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}]},label_line_max_length:{displayName:"Max Connecting Line Length (px)",type:"NumUpDown",default:1e3,options:{minValue:{value:0},maxValue:{value:1e4}}},label_marker_show:{displayName:"Show Line Markers",type:"ToggleSwitch",default:!0},label_marker_offset:{displayName:"Marker Offset from Value (px)",type:"NumUpDown",default:5},label_marker_size:{displayName:"Marker Size",type:"NumUpDown",default:3,options:{minValue:{value:0},maxValue:{value:100}}},label_marker_colour:{displayName:"Marker Fill Colour",type:"ColorPicker",default:un},label_marker_outline_colour:{displayName:"Marker Outline Colour",type:"ColorPicker",default:un}}}}},dn=[];for(const e in cn){const t=[];for(const i in cn[e].settingsGroups)for(const n in cn[e].settingsGroups[i])t.push([n,cn[e].settingsGroups[i][n]]);dn.push([e,Object.fromEntries(t)])}const hn=Object.fromEntries(dn);function fn(e,t){t.plotProperties.displayPlot?e.on("contextmenu",e=>{const i=ue(e.target).datum();t.selectionManager.showContextMenu(i?i.identity:{},{x:e.clientX,y:e.clientY}),e.preventDefault()}):e.on("contextmenu",()=>{})}function mn(e){return null==e}function gn(e,t,i){let n=!0;return mn(t)||(n=n&&e>=t),mn(i)||(n=n&&e<=i),n}function yn(e){return function(t,i){return Array.isArray(t)&&Array.isArray(i)?t.map((t,n)=>e(t,i[n])):Array.isArray(t)&&!Array.isArray(i)?t.map(t=>e(t,i)):!Array.isArray(t)&&Array.isArray(i)?i.map(i=>e(t,i)):e(t,i)}}const vn=yn((e,t)=>e+t),bn=yn((e,t)=>e-t),_n=yn((e,t)=>e/t),Nn=yn((e,t)=>e*t);function wn(e){return"none"==e?function(e){return e}:"ln"==e?function(e){return Math.log(e+1)}:"log10"==e?function(e){return Math.log10(e+1)}:"sqrt"==e?Math.sqrt:function(e){return e}}function xn(e,t,i,n,r,o){const a=r.funnel.chart_type,s=o.multiplier,l=r.funnel.transformation,u=wn(l),p=n.keys[e].label,c=n.numerators[e],d=n.denominators[e],h=t.filter(e=>e.denominators===d&&null!==e.ll99&&null!==e.ul99)[0],f=u(c/d*s),m=o.percentLabels?"%":"",g=o.percentLabels,y=r.funnel.sig_figs,v={PR:"Proportion",SR:"Standardised Ratio",RC:"Rate"},b=new Array;if(r.funnel.ttip_show_group&&b.push({displayName:r.funnel.ttip_label_group,value:p}),r.funnel.ttip_show_value){const e=r.funnel.ttip_label_value;b.push({displayName:"Automatic"===e?v[a]:e,value:f.toFixed(y)+m})}if(r.funnel.ttip_show_numerator&&null!=c&&b.push({displayName:r.funnel.ttip_label_numerator,value:c.toFixed(g?0:y)}),r.funnel.ttip_show_denominator&&null!=d&&b.push({displayName:r.funnel.ttip_label_denominator,value:d.toFixed(g?0:y)}),["68","95","99"].forEach(e=>{r.lines[`ttip_show_${e}`]&&r.lines[`show_${e}`]&&b.push({displayName:`Upper ${r.lines[`ttip_label_${e}`]}`,value:h[`ul${e}`].toFixed(y)+m})}),r.lines.show_target&&r.lines.ttip_show_target&&b.push({displayName:r.lines.ttip_label_target,value:h.target.toFixed(y)+m}),r.lines.show_alt_target&&r.lines.ttip_show_alt_target&&null!==h.alt_target&&void 0!==h.alt_target&&b.push({displayName:r.lines.ttip_label_alt_target,value:h.alt_target.toFixed(y)+m}),["68","95","99"].forEach(e=>{r.lines[`ttip_show_${e}`]&&r.lines[`show_${e}`]&&b.push({displayName:`Lower ${r.lines[`ttip_label_${e}`]}`,value:h[`ll${e}`].toFixed(y)+m})}),"none"!==l&&b.push({displayName:"Plot Scaling",value:l}),i.two_sigma||i.three_sigma){const e=new Array;i.three_sigma&&e.push("Three Sigma Outlier"),i.two_sigma&&e.push("Two Sigma Outlier"),b.push({displayName:"Pattern(s)",value:e.join("\n")})}return n.tooltips.length>0&&n.tooltips[e].forEach(e=>b.push(e)),b}function En(e,t){let i=new Array(t);for(let n=0;n<t;n++)i[n]=e;return i}function Mn(e,t,i){if(mn(e))return{values:null,validation:{status:0,messages:En(new Array,1)}};if(mn(null==e?void 0:e.categories))return{values:null,validation:{status:0,messages:En(new Array,1)}};const n=e.categories[0],r=Object.keys(i[t]),o=JSON.parse(JSON.stringify({status:0,messages:En([],n.values.length)})),a=n.values.map((e,i)=>{const a=n.objects?n.objects[i]:null;return Object.fromEntries(r.map(e=>{var n,r,s,l,u,p,c;const d=hn[t][e].default;let h=function(e,t,i,n){var r;const o=null===(r=null==e?void 0:e[t])||void 0===r?void 0:r[i];return mn(o)?n:(null==o?void 0:o.solid)?o.solid.color:o}(a,t,e,d);h=""===h?d:h;const f=null!==(r=null===(n=hn[t][e])||void 0===n?void 0:n.valid)&&void 0!==r?r:null===(s=hn[t][e])||void 0===s?void 0:s.options,m=!mn(null==f?void 0:f.minValue)||!mn(null==f?void 0:f.maxValue);if(f){let n="";f instanceof Array&&!f.includes(h)?n=`${h} is not a valid value for ${e}. Valid values are: ${f.join(", ")}`:m&&!gn(h,null===(l=null==f?void 0:f.minValue)||void 0===l?void 0:l.value,null===(u=null==f?void 0:f.maxValue)||void 0===u?void 0:u.value)&&(n=`${h} is not a valid value for ${e}. Valid values are between ${null===(p=null==f?void 0:f.minValue)||void 0===p?void 0:p.value} and ${null===(c=null==f?void 0:f.maxValue)||void 0===c?void 0:c.value}`),""!==n&&(h=hn[t][e].default,o.messages[i].push(n))}return[e,h]}))}),s=o.messages.filter(e=>e.length>0);return o.messages.some(e=>0===e.length)||(o.status=1,o.error=`${s[0][0]}`),{values:a,validation:o}}const Sn=yn((e,t)=>null==e?null:t.numeric?e.toString():e);function In(e,t){var i,n,r,o;const a=e.values.filter(e=>{var i,n;return null===(n=null===(i=null==e?void 0:e.source)||void 0===i?void 0:i.roles)||void 0===n?void 0:n[t]});return"key"===t?function(e){var t,i,n;const r=e.categories.filter(e=>{var t,i;return null===(i=null===(t=e.source)||void 0===t?void 0:t.roles)||void 0===i?void 0:i.key}),o=null===(t=null==r?void 0:r[0])||void 0===t?void 0:t.values,a=null===(n=null===(i=null==r?void 0:r[0])||void 0===i?void 0:i.source)||void 0===n?void 0:n.type;return Sn(o,a)}(e):"tooltips"===t?function(e){var t,i;const n=e.values.filter(e=>e.source.roles.tooltips);return null===(i=null===(t=null==n?void 0:n[0])||void 0===t?void 0:t.values)||void 0===i?void 0:i.map((e,t)=>n.map(e=>{var i;const n=Sn(null===(i=null==e?void 0:e.values)||void 0===i?void 0:i[t],e.source.type);return{displayName:e.source.displayName,value:n}}))}(e):"labels"===t?null===(n=null===(i=null==a?void 0:a[0])||void 0===i?void 0:i.values)||void 0===n?void 0:n.map(e=>mn(e)?null:String(e)):null===(o=null===(r=null==a?void 0:a[0])||void 0===r?void 0:r.values)||void 0===o?void 0:o.map(e=>mn(e)?null:Number(e))}function Tn(e,t){if(e){const i=t.length;let n=new Array(i);for(let r=0;r<i;r++)n[r]=e[t[r]];return n}return[]}const An={ll99:"99",ll95:"95",ll68:"68",ul68:"68",ul95:"95",ul99:"99",target:"target",alt_target:"alt_target"};function $n(e,t,i,n){const r=i+"_"+(t.includes("line")?An[e]:e);return n[t][r]}function Pn(e){return function(t){return Array.isArray(t)?t.map(t=>e(t)):e(t)}}const kn=Pn(Math.sqrt),Ln=Pn(Math.exp),Dn=Pn(Math.log),Rn=Pn(Math.asin),Vn=Pn(e=>Math.pow(e,2)),On=Pn(e=>1/e);function Fn(e,t){let i=e;return t.lower&&(Array.isArray(i)?i=i.map(e=>e<t.lower?t.lower:e):"number"==typeof i&&(i=i<t.lower?t.lower:i)),t.upper&&(Array.isArray(i)?i=i.map(e=>e>t.upper?t.upper:e):"number"==typeof i&&(i=i>t.upper?t.upper:i)),i}function Cn(e,t){if("none"===e)return e;const i={increase:{upper:"improvement",lower:"deterioration"}[e],decrease:{lower:"improvement",upper:"deterioration"}[e],neutral:{lower:"neutral_low",upper:"neutral_high"}[e]}[t.improvement_direction];return"both"!==t.process_flag_type?i===t.process_flag_type?i:"none":i}const jn=yn((e,t)=>{let i=e;return(t.lower||0==t.lower)&&(i=i<t.lower?t.lower:i),t.upper&&(i=i>t.upper?t.upper:i),i});function Un(e){return!mn(e)&&!Number.isNaN(e)&&Number.isFinite(e)}function zn(e,t){const i=t.viewModel.inputSettings.settings.scatter.use_group_text;e.selectAll(".dotsgroup").selectAll(".dotsgroup-child").data(t.viewModel.plotPoints).join(e=>{const n=e.append("g").classed("dotsgroup-child",!0);return i?n.append("text").call(Yn,t):n.append("path").call(Gn,t),n.call(qn,t),n},e=>{let n=e.select("text"),r=e.select("path");return i?(r.remove(),n.node()||(n=e.append("text")),n.call(Yn,t)):(n.remove(),r.node()||(r=e.append("path")),r.call(Gn,t)),e}),e.on("click",()=>{t.selectionManager.clear(),t.updateHighlighting()})}function qn(e,t){e.on("click",(e,i)=>{t.selectionManager.select(i.identity,e.ctrlKey||e.metaKey).then(()=>t.updateHighlighting()),e.stopPropagation()}).on("mouseover",(e,i)=>{const n=e.pageX,r=e.pageY;t.host.tooltipService.show({dataItems:i.tooltip,identities:[i.identity],coordinates:[n,r],isTouchEvent:!1})}).on("mouseout",()=>{t.host.tooltipService.hide({immediately:!0,isTouchEvent:!1})})}function Gn(e,t){const i=t.plotProperties.yAxis.lower,n=t.plotProperties.yAxis.upper,r=t.plotProperties.xAxis.lower,o=t.plotProperties.xAxis.upper;e.attr("d",e=>{const t=e.aesthetics.shape,i=e.aesthetics.size;return We().type(tn[`symbol${t}`]).size(i*i*Math.PI)()}).attr("transform",e=>gn(e.value,i,n)&&gn(e.x,r,o)?`translate(${t.plotProperties.xScale(e.x)}, ${t.plotProperties.yScale(e.value)})`:"translate(0, 0) scale(0, 0)").style("fill",e=>e.aesthetics.colour).style("stroke",e=>e.aesthetics.colour_outline).style("stroke-width",e=>e.aesthetics.width_outline)}function Yn(e,t){const i=t.plotProperties.yAxis.lower,n=t.plotProperties.yAxis.upper,r=t.plotProperties.xAxis.lower,o=t.plotProperties.xAxis.upper;e.attr("transform",e=>gn(e.value,i,n)&&gn(e.x,r,o)?`translate(${t.plotProperties.xScale(e.x)}, ${t.plotProperties.yScale(e.value)})`:"translate(0, 0) scale(0, 0)").attr("dy","0.35em").text(e=>e.group_text).style("text-anchor","middle").style("font-size",e=>`${e.aesthetics.scatter_text_size}px`).style("font-family",e=>e.aesthetics.scatter_text_font).style("fill",e=>e.aesthetics.scatter_text_colour)}function Hn(e,t){e.select(".linesgroup").selectAll("path").data(t.viewModel.groupedLines).join("path").attr("d",e=>{const i=t.plotProperties.yAxis.lower,n=t.plotProperties.yAxis.upper,r=t.plotProperties.xAxis.lower,o=t.plotProperties.xAxis.upper;return Ae().x(e=>t.plotProperties.xScale(e.x)).y(e=>t.plotProperties.yScale(e.line_value)).defined(e=>null!==e.line_value&&gn(e.line_value,i,n)&&gn(e.x,r,o))(e[1])}).attr("fill","none").attr("stroke",e=>t.viewModel.colourPalette.isHighContrast?t.viewModel.colourPalette.foregroundColour:$n(e[0],"lines","colour",t.viewModel.inputSettings.settings)).attr("stroke-width",e=>$n(e[0],"lines","width",t.viewModel.inputSettings.settings)).attr("stroke-dasharray",e=>$n(e[0],"lines","type",t.viewModel.inputSettings.settings))}function Bn(e,t){const i=t.plotProperties,n=t.viewModel.colourPalette.isHighContrast?t.viewModel.colourPalette.foregroundColour:"black",r=e.select(".ttip-line-x").attr("x1",0).attr("x2",0).attr("y1",i.yAxis.end_padding).attr("y2",i.height-i.yAxis.start_padding).attr("stroke-width","1px").attr("stroke",n).style("stroke-opacity",0),o=e.select(".ttip-line-y").attr("x1",i.xAxis.start_padding).attr("x2",i.width-i.xAxis.end_padding).attr("y1",0).attr("y2",0).attr("stroke-width","1px").attr("stroke",n).style("stroke-opacity",0);e.on("mousemove",e=>{if(!i.displayPlot)return;const n=t.viewModel.plotPoints,a=t.svg.node().getBoundingClientRect(),s=e.pageX-a.left,l=e.pageY-a.top;let u,p,c,d=1/0;for(let e=0;e<n.length;e++){const t=i.xScale(n[e].x),r=i.yScale(n[e].value),o=Math.abs(t-s)+Math.abs(r-l);o<d&&(d=o,u=e,p=t,c=r)}t.host.tooltipService.show({dataItems:n[u].tooltip,identities:[n[u].identity],coordinates:[p,c],isTouchEvent:!1}),r.style("stroke-opacity",.4).attr("x1",p).attr("x2",p),o.style("stroke-opacity",.4).attr("y1",c).attr("y2",c)}).on("mouseleave",()=>{i.displayPlot&&(t.host.tooltipService.hide({immediately:!0,isTouchEvent:!1}),r.style("stroke-opacity",0),o.style("stroke-opacity",0))})}function Xn(e,t,i){const n=t.plotProperties.xAxis,r=rt(t.plotProperties.xScale);n.ticks?n.tick_count&&r.ticks(n.tick_count):r.tickValues([]);const o=t.viewModel.svgHeight-t.plotProperties.yAxis.start_padding,a=t.plotProperties.displayPlot,s=e.select(".xaxisgroup");s.call(r).attr("color",a?n.colour:"#FFFFFF").attr("transform",`translate(0, ${o})`);const l=s.selectAll(".tick text").attr("transform","rotate("+n.tick_rotation+")").attr("text-anchor","middle").attr("dx",null).style("font-size",n.tick_size).style("font-family",n.tick_font).style("fill",a?n.tick_colour:"#FFFFFF");if(0!=n.tick_rotation){const e=n.tick_rotation<0?"end":"start",t=n.tick_rotation<0?"-.8em":".8em";l.attr("text-anchor",e).attr("dx",t)}if(!e.selectAll(".xaxisgroup").node())return void e.select(".xaxislabel").style("fill",a?n.label_colour:"#FFFFFF");const u=t.viewModel.svgWidth/2,p=t.plotProperties.yAxis.start_padding-.5*t.viewModel.inputSettings.settings.x_axis.xlimit_label_size;s.select(".xaxislabel").selectAll("text").data([n.label]).join("text").attr("x",0).attr("y",0).attr("transform",`translate(${u}, ${p})`).style("text-anchor","middle").text(e=>e).style("font-size",n.label_size).style("font-family",n.label_font).style("fill",a?n.label_colour:"#FFFFFF")}function Wn(e,t,i){const n=t.plotProperties.yAxis,r=ot(t.plotProperties.yScale),o=t.viewModel.inputSettings.settings.y_axis.ylimit_sig_figs,a=null===o?t.viewModel.inputSettings.settings.funnel.sig_figs:o,s=t.plotProperties.displayPlot;n.ticks?(n.tick_count&&r.ticks(n.tick_count),t.viewModel.inputData&&r.tickFormat(e=>t.viewModel.inputSettings.derivedSettings.percentLabels?e.toFixed(a)+"%":e.toFixed(a))):r.tickValues([]);const l=e.select(".yaxisgroup");l.call(r).attr("color",s?n.colour:"#FFFFFF").attr("transform",`translate(${t.plotProperties.xAxis.start_padding}, 0)`).selectAll(".tick text").style("text-anchor","right").attr("transform",`rotate(${n.tick_rotation})`).style("font-size",n.tick_size).style("font-family",n.tick_font).style("fill",s?n.tick_colour:"#FFFFFF");const u=-(t.plotProperties.xAxis.start_padding-1.5*t.viewModel.inputSettings.settings.y_axis.ylimit_label_size),p=t.viewModel.svgHeight/2;l.select(".yaxislabel").selectAll("text").data([t.viewModel.inputSettings.settings.y_axis.ylimit_label]).join("text").attr("x",u).attr("y",p).attr("transform",`rotate(-90, ${u}, ${p})`).style("text-anchor","middle").text(e=>e).style("font-size",n.label_size).style("font-family",n.label_font).style("fill",n.label_colour)}function Kn(e,t=!1){t&&e.selectChildren().remove(),e.append("line").classed("ttip-line-x",!0),e.append("line").classed("ttip-line-y",!0),e.append("g").classed("xaxisgroup",!0).append("g").classed("xaxislabel",!0),e.append("g").classed("yaxisgroup",!0).append("g").classed("yaxislabel",!0),e.append("g").classed("linesgroup",!0),e.append("g").classed("dotsgroup",!0),e.append("g").classed("text-labels",!0)}function Jn(e,t,i,n=null){e.call(Kn,!0);const r=e.append("g").classed("errormessage",!0);if(n){const e={internal:"Internal Error! Please file a bug report with the following text:",settings:"Invalid settings provided for all observations! First error:"};r.append("text").attr("x",t.viewport.width/2).attr("y",t.viewport.height/3).style("text-anchor","middle").text(e[n]).style("font-size","10px")}r.append("text").attr("x",t.viewport.width/2).attr("y",t.viewport.height/2).style("text-anchor","middle").text(i).style("font-size","10px")}function Zn(e,t){if(!t.viewModel.inputSettings.settings.labels.show_labels||!t.viewModel.inputData.anyLabels)return void e.select(".text-labels").remove();e.select(".text-labels").empty()&&e.append("g").classed("text-labels",!0);const i=en().on("drag",function(e){const i=e.subject,n=t.plotProperties.xScale(i.x),r=t.plotProperties.yScale(i.value),o=180*Math.atan2(e.sourceEvent.y-r,e.sourceEvent.x-n)/Math.PI,a=Math.sqrt(Math.pow(e.sourceEvent.y-r,2)+Math.pow(e.sourceEvent.x-n,2)),s=10*Math.cos(o*Math.PI/180),l=10*Math.sin(o*Math.PI/180);e.subject.label.angle=o,e.subject.label.distance=a,ue(this).select("text").attr("x",e.sourceEvent.x).attr("y",e.sourceEvent.y);let u=i.label.aesthetics.label_line_offset;u="top"===i.label.aesthetics.label_position?u:-(u+i.label.aesthetics.label_size/2),ue(this).select("line").attr("x1",e.sourceEvent.x).attr("y1",e.sourceEvent.y+u).attr("x2",n+s).attr("y2",r+l),ue(this).select("path").attr("transform",`translate(${n+s}, ${r+l}) rotate(${o-90})`)});e.select(".text-labels").selectAll(".text-group-inner").data(t.viewModel.plotPoints).join("g").classed("text-group-inner",!0).each(function(e){var n;const r=ue(this);if(""===(null!==(n=e.label.text_value)&&void 0!==n?n:""))return void r.remove();r.selectAll("*").remove();const o=r.append("text"),a=r.append("line"),s=r.append("path"),{x:l,y:u,line_offset:p,marker_offset:c,theta:d}=function(e,t){var i,n;const r="top"===e.label.aesthetics.label_position?-1:1,o=t.viewModel.svgHeight-t.plotProperties.yAxis.start_padding,a=e.label.aesthetics.label_position;let s=e.label.aesthetics.label_y_offset;const l="top"===a?0+s:o-s,u=t.plotProperties.yScale(e.value);let p="top"===a?u-l:l-u;const c=t.plotProperties.xScale(e.x),d=t.plotProperties.yScale(e.value),h=null!==(i=e.label.angle)&&void 0!==i?i:e.label.aesthetics.label_angle_offset+90*r;p=null!==(n=e.label.distance)&&void 0!==n?n:Math.min(p,e.label.aesthetics.label_line_max_length);let f=e.label.aesthetics.label_line_offset;f="top"===a?f:-(f+e.label.aesthetics.label_size/2);let m=e.label.aesthetics.label_marker_offset+e.label.aesthetics.label_size/2;m="top"===a?-m:m;const g=c+p*Math.cos(h*Math.PI/180),y=d+p*Math.sin(h*Math.PI/180);return Un(g)&&Un(y)?{x:g,y:y,theta:h,line_offset:f,marker_offset:m}:{x:0,y:0,theta:0,line_offset:0,marker_offset:0}}(e,t);if(0===l&&0===u)return void r.remove();const h=d-("top"===e.label.aesthetics.label_position?180:0),f=h*Math.PI/180;o.attr("x",l).attr("y",u).text(e.label.text_value).style("text-anchor","middle").style("font-size",`${e.label.aesthetics.label_size}px`).style("font-family",e.label.aesthetics.label_font).style("fill",e.label.aesthetics.label_colour);const m=Math.pow(e.label.aesthetics.label_marker_size,2),g=t.plotProperties.xScale(e.x)+c*Math.cos(f),y=t.plotProperties.yScale(e.value)+c*Math.sin(f);a.attr("x1",l).attr("y1",u+p).attr("x2",g).attr("y2",y).style("stroke",t.viewModel.inputSettings.settings.labels.label_line_colour).style("stroke-width",t.viewModel.inputSettings.settings.labels.label_line_width).style("stroke-dasharray",t.viewModel.inputSettings.settings.labels.label_line_type);const v=h+("top"===e.label.aesthetics.label_position?90:270);s.attr("d",We().type(qe).size(m)()).attr("transform",`translate(${g}, ${y}) rotate(${v})`).style("fill",e.label.aesthetics.label_marker_colour).style("stroke",e.label.aesthetics.label_marker_outline_colour),t.viewModel.headless||r.call(i)})}const Qn={above:-1,below:1,beside:-1},er={ll99:"below",ll95:"below",ll68:"below",ul68:"above",ul95:"above",ul99:"above"},tr={ll99:"above",ll95:"above",ll68:"above",ul68:"below",ul95:"below",ul99:"below"};function ir(e,t){const i=t.viewModel.inputSettings.settings.lines,n=new Array;t.viewModel.groupedLines[0][1].forEach((e,i)=>{null===e.line_value&&n.push(i-1),i===t.viewModel.groupedLines[0][1].length-1&&n.push(i)});const r=t.viewModel.groupedLines.map(e=>e[0]),o=new Array;n.forEach((e,t)=>{r.forEach((r,a)=>{const s=n[n.length-1],l=n.length-Math.min(n.length,i[`plot_label_show_n_${An[r]}`]),u=i[`plot_label_show_all_${An[r]}`]||e==s;(t>=l||u)&&o.push({index:e,limit:a})})});const a=(s=t.viewModel.inputSettings.settings,l=t.viewModel.inputSettings.derivedSettings,function(e,t){return function(e,t,i,n){const r=n.percentLabels?"%":"",o=i.funnel.sig_figs;if(mn(e))return"";switch(t){case"date":return e;case"integer":return e.toFixed(0);default:return e.toFixed(o)+r}}(e,t,s,l)});var s,l;e.select(".linesgroup").selectAll("text").data(o).join("text").text(e=>{const n=t.viewModel.groupedLines[e.limit];return i[`plot_label_show_${An[n[0]]}`]?i[`plot_label_prefix_${An[n[0]]}`]+a(n[1][e.index].line_value,"value"):""}).attr("x",e=>{const i=t.viewModel.groupedLines[e.limit];return t.plotProperties.xScale(i[1][e.index].x)}).attr("y",e=>{const i=t.viewModel.groupedLines[e.limit];return t.plotProperties.yScale(i[1][e.index].line_value)}).attr("fill",e=>{const n=t.viewModel.groupedLines[e.limit];return i[`plot_label_colour_${An[n[0]]}`]}).attr("font-size",e=>{const n=t.viewModel.groupedLines[e.limit];return`${i[`plot_label_size_${An[n[0]]}`]}px`}).attr("font-family",e=>{const n=t.viewModel.groupedLines[e.limit];return i[`plot_label_font_${An[n[0]]}`]}).attr("text-anchor",e=>{const n=t.viewModel.groupedLines[e.limit];return"beside"===i[`plot_label_position_${An[n[0]]}`]?"start":"end"}).attr("dx",e=>{const n=t.viewModel.groupedLines[e.limit];return("beside"===i[`plot_label_position_${An[n[0]]}`]?1:-1)*i[`plot_label_hpad_${An[n[0]]}`]+"px"}).attr("dy",function(e){const n=t.viewModel.groupedLines[e.limit],r=ue(this).node().getBoundingClientRect();let o=i[`plot_label_position_${An[n[0]]}`],a=i[`plot_label_vpad_${An[n[0]]}`];["outside","inside"].includes(o)&&(o="outside"===o?er[n[0]]:tr[n[0]]);const s={above:-i[`width_${An[n[0]]}`],below:i[`plot_label_size_${An[n[0]]}`],beside:r.height/4};return`${Qn[o]*a+s[o]}px`})}class nr{getPlottingDenominators(){const e=yt(this.inputData.denominators);return function(e,t,i){const n=Math.floor((t-1)/i),r=new Array(n);r[0]=1;for(let e=1;e<n;e++)r[e]=r[e-1]+i;return r}(0,e+.1*e,.01*e).concat(this.inputData.denominators).filter((e,t,i)=>i.indexOf(e)===t).sort((e,t)=>e-t)}getTarget(e){return(e.transformed?this.targetFunctionTransformed:this.targetFunction)(this.inputData)}getSE(e){const t=e.odAdjust?this.seFunctionOD:this.seFunction;if(e.plottingDenominators){const i=JSON.parse(JSON.stringify(this.inputData));return i.numerators=null,i.denominators=e.plottingDenominators,t(i)}return t(this.inputData)}getY(){return this.yFunction(this.inputData)}getTau2(){const e=this.getTarget({transformed:!0}),t=this.getSE({odAdjust:!0}),i=function(e,t,i){return _n(bn(e,i),t)}(this.getY(),t,e),n=function(e){const t=e.sort(function(e,t){return e-t});return Fn(e,{lower:Nt(t,.1),upper:Nt(t,.9)})}(i);var r;return function(e,t){const i=t.length;if(i*e<i-1)return 0;const n=On(Vn(t)),r=Vn(n),o=wt(n);return(i*e-(i-1))/(o-wt(r)/o)}(wt(Vn(r=n))/r.length,t)}getTau2Bool(){return{yes:!0,no:!1,auto:!0}[this.inputSettings.settings.funnel.od_adjust]}getSingleLimit(e){return(e.odAdjust?this.limitFunctionOD:this.limitFunction)(e.inputArgs)}getIntervals(){const e=[.001,.025,.16,.84,.975,.999],t=["ll99","ll95","ll68","ul68","ul95","ul99"];return[-3.090232306167813,-1.9599639845400538,-.9944578832097528,.9944578832097528,1.9599639845400536,3.090232306167813].map((i,n)=>({prob:e[n],quantile:i,label:t[n]}))}getLimits(){let e,t;this.getTau2Bool()?(t=this.getTau2(),e=t>0):(t=0,e=!1);const i=this.getTarget({transformed:!1}),n=this.inputSettings.settings.lines.alt_target,r=this.getTarget({transformed:!0}),o=this.getIntervals(),a=this.getPlottingDenominators(),s=this.getSE({odAdjust:e,plottingDenominators:a}),l=a.map((a,l)=>{const u=new Array;return u.push(["denominators",a]),o.forEach(n=>{const o={p:n.prob,q:n.quantile,target:i,target_transformed:r,SE:s[l],tau2:t,denominators:a},p=this.getSingleLimit({odAdjust:e,inputArgs:o});u.push([n.label,p])}),u.push(["target",i]),u.push(["alt_target",n]),Object.fromEntries(u)});return l.map((e,t)=>{const i=e;return t<l.length-1&&["99","95","68"].forEach(e=>{const n=`ll${e}`,r=`ul${e}`;i[n]>l[t+1][n]&&(i[n]=void 0),i[r]<l[t+1][r]&&(i[r]=void 0),i[n]>=i[r]&&(i[n]=void 0,i[r]=void 0)}),i})}constructor(e){this.seFunction=e.seFunction,this.seFunctionOD=e.seFunctionOD,this.targetFunction=e.targetFunction,this.targetFunctionTransformed=e.targetFunctionTransformed,this.yFunction=e.yFunction,this.limitFunction=e.limitFunction,this.limitFunctionOD=e.limitFunctionOD,this.inputData=e.inputData,this.inputSettings=e.inputSettings}}class rr{initialiseScale(e,t){this.xScale=Fi().domain([this.xAxis.lower,this.xAxis.upper]).range([this.xAxis.start_padding,e-this.xAxis.end_padding]),this.yScale=Fi().domain([this.yAxis.lower,this.yAxis.upper]).range([t-this.yAxis.start_padding,this.yAxis.end_padding])}update(e,t){const i=t.plotPoints,n=t.inputData,r=t.inputSettings.settings,o=t.inputSettings.derivedSettings,a=t.colourPalette;this.width=e.viewport.width,this.height=e.viewport.height,this.displayPlot=i?i.length>1:null;const s=r.x_axis.xlimit_tick_size,l=r.y_axis.ylimit_tick_size,u=r.x_axis.xlimit_tick_count,p=r.y_axis.ylimit_tick_count,c=r.x_axis.xlimit_l;let d=r.x_axis.xlimit_u;mn(null==n?void 0:n.denominators)||(d=d||1.1*yt(n.denominators));const h=r.y_axis.ylimit_label?r.y_axis.ylimit_label_size:0,f=r.x_axis.xlimit_label?r.x_axis.xlimit_label_size+20:0;this.xAxis={lower:null!=c?c:0,upper:d,start_padding:r.canvas.left_padding+h,end_padding:r.canvas.right_padding,colour:a.isHighContrast?a.foregroundColour:r.x_axis.xlimit_colour,ticks:null!==u?u>0:r.x_axis.xlimit_ticks,tick_size:`${s}px`,tick_font:r.x_axis.xlimit_tick_font,tick_colour:a.isHighContrast?a.foregroundColour:r.x_axis.xlimit_tick_colour,tick_rotation:r.x_axis.xlimit_tick_rotation,tick_count:r.x_axis.xlimit_tick_count,label:r.x_axis.xlimit_label,label_size:`${r.x_axis.xlimit_label_size}px`,label_font:r.x_axis.xlimit_label_font,label_colour:a.isHighContrast?a.foregroundColour:r.x_axis.xlimit_label_colour};const m=r.y_axis.ylimit_l;let g=r.y_axis.ylimit_u;if(!mn(null==n?void 0:n.numerators)&&!mn(null==n?void 0:n.denominators)){const e=yt(_n(n.numerators,n.denominators));null!=g||(g=e*o.multiplier)}this.yAxis={lower:null!=m?m:0,upper:g,start_padding:r.canvas.lower_padding+f,end_padding:r.canvas.upper_padding,colour:a.isHighContrast?a.foregroundColour:r.y_axis.ylimit_colour,ticks:null!==p?p>0:r.y_axis.ylimit_ticks,tick_size:`${l}px`,tick_font:r.y_axis.ylimit_tick_font,tick_colour:a.isHighContrast?a.foregroundColour:r.y_axis.ylimit_tick_colour,tick_rotation:r.y_axis.ylimit_tick_rotation,tick_count:r.y_axis.ylimit_tick_count,label:r.y_axis.ylimit_label,label_size:`${r.y_axis.ylimit_label_size}px`,label_font:r.y_axis.ylimit_label_font,label_colour:a.isHighContrast?a.foregroundColour:r.y_axis.ylimit_label_colour},this.initialiseScale(e.viewport.width,e.viewport.height)}}function or(e,t,i){if(e<-1.1||e>1.1)throw new Error("chebyshevPolynomial: x must be in [-1,1]");if(i<1||i>1e3)throw new Error("chebyshevPolynomial: n must be in [1,1000]");const n=2*e;let r=0,o=0,a=0;for(let e=1;e<=i;e++)a=o,o=r,r=n*o-a+t[i-e];return.5*(r-a)}function ar(e){if(Number.isNaN(e)||!Number.isFinite(e))return Number.NaN;let t=e%2;return t<=-1?t+=2:t>1&&(t-=2),0===t||1===t?0:.5===t?1:-.5===t?-1:Math.sin(Math.PI*t)}function sr(e){const t=[.16663894804518634,-1384948176067564e-20,9.81082564692473e-9,-1809129475572494e-26,6221098041892606e-29,-3399615005417722e-31,2683181998482699e-33,-2.868042435334643e-20,39628370610464347e-38,-6831888753985767e-39,14292273559424982e-41,-35475981581010704e-43,1025680058010471e-43,-3.401102254316749e-30,1276642195630063e-46];if(e<10)throw new Error("lgammaCorrection: x must be >= 10");if(e<94906265.62425156){const i=10/e;return or(i*i*2-1,t,5)/e}return 1/(12*e)}function lr(e,t){return e*Math.pow(2,t)}function ur(e,t,i,n){let r=2*i,o=t+i,a=o+i,s=o,l=t*(o-t*e),u=i*i*e,p=a*o-u;const c=1157921e71;for(u=a*l-t*u;Math.abs(p*l-s*u)>Math.abs(n*l*u);){let t=o*o*e;o+=i,a+=i,s=a*p-t*s,l=a*u-t*l,t=r*r*e,r+=i,a+=i,p=a*s-t*p,u=a*l-t*u,Math.abs(u)>c?(s/=c,l/=c,p/=c,u/=c):Math.abs(u)<1/c&&(s*=c,l*=c,p*=c,u*=c)}return p/u}function pr(e){if(e>1||e<-.79149064)return Math.log1p(e)-e;{const t=e/(2+e),i=t*t;if(Math.abs(e)<.01){const n=[2/3,.4,2/7,2/9];let r=0;for(let e=0;e<n.length;e++)r=(r+n[e])*i;return t*(r-e)}return t*(2*i*ur(i,3,2,1e-14)-e)}}const cr=1.8378770664093456,dr=.9189385332046728,hr=.3989422804014327;function fr(e){if(Math.abs(e)>=.5)return gr(e+1);const t=[.3224670334241132,.0673523010531981,.020580808427784546,.007385551028673986,.0028905103307415234,.001192753911703261,.0005096695247430425,.00022315475845357939,9945751278180853e-20,4492623673813314e-20,2050721277567069e-20,9439488275268397e-21,4374866789907488e-21,2039215753801366e-21,9.55141213040742e-7,4.492469198764566e-7,2.1207184805554665e-7,1.0043224823968099e-7,4.7698101693639804e-8,2.2711094608943164e-8,1.0838659214896955e-8,5.183475041970047e-9,2.4836745438024785e-9,1.1921401405860912e-9,5.731367241678862e-10,2.7595228851242334e-10,1.330476437424449e-10,64229645638381e-24,31044247747322276e-27,15021384080754142e-27,7275974480239079e-27,3527742476575915e-27,1711991790559618e-27,8315385841420285e-28,404220052528944e-27,19664756310966165e-29,9573630387838556e-29,46640760264283744e-30,22737369600659724e-30,11091399470834522e-30],i=t.length;let n=22737368458246524e-29*ur(-e/2,i+2,1,1e-14);for(let r=i-1;r>=0;r--)n=t[r]-e*n;return(e*n-.5772156649015329)*e-pr(e)}function mr(e){const t=[.08333333333333333,.002777777777777778,.0007936507936507937,.0005952380952380953,.0008417508417508417,.0019175269175269176,.00641025641025641,.029550653594771242,.17964437236883057,1.3924322169059011,13.402864044168393,156.84828462600203,2193.1033333333335,36108.77125372499,691472.268851313,15238221.539407415,382900751.39141417];let i,n=e+e;if(e<=15&&n===Math.trunc(n))return[0,.15342640972002736,.08106146679532726,.05481412105191765,.0413406959554093,.03316287351993629,.02767792568499834,.023746163656297496,.020790672103765093,.018488450532673187,.016644691189821193,.015134973221917378,.013876128823070748,.012810465242920227,.01189670994589177,.011104559758206917,.010411265261972096,.009799416126158804,.009255462182712733,.008768700134139386,.00833056343336287,.00793411456431402,.007573675487951841,.007244554301320383,.00694284010720953,.006665247032707682,.006408994188004207,.006171712263039458,.0059513701127588475,.0057462165130101155,.005554733551962801][n];if(e<=5.25){if(e>=1){const t=Math.log(e);return gr(e)+e*(1-t)+lr(t-cr,-1)}return fr(e)-(e+.5)*Math.log(e)+e-dr}i=e>157e5?0:e>6180?1:e>205?2:e>86?3:e>27?4:e>23.5?5:e>12.8?6:e>12.3?7:e>8.9?8:e>7.3?10:e>6.6?12:e>6.1?14:16,n=e*e;let r=t[i];for(let e=i-1;e>=0;e--)r=t[e]-r/n;return r/e}function gr(e){if(Number.isNaN(e))return Number.NaN;if(e<=0&&e===Math.trunc(e))return Number.POSITIVE_INFINITY;const t=Math.abs(e);return t<1e-306?-Math.log(t):t<=10?Math.log(Math.abs(function(e){const t=[.00857119559098933,.004415381324841007,.05685043681599363,-.00421983539641856,.0013268081812124603,-.00018930245297988805,3606925327441245e-20,-6056761904460864e-21,10558295463022833e-22,-1.811967365542384e-7,3.117724964715322e-8,-5.354219639019687e-9,9.193275519859589e-10,-1.5779412802883398e-10,27079806229349544e-27,-464681865382573e-26,797335019200742e-27,-1368078209830916e-28,23473194865638007e-30,-4027432614949067e-30,6910051747372101e-31,-1185584500221993e-31,2034148542496374e-32,-3490054341717406e-33,5987993856485306e-34,-1027378057872228e-34,1.7627028160605298e-20,-3024320653735306e-36,5188914660218398e-37,-8902770842456576e-38,15274740684933426e-39,-2620731256187363e-39,4496464047830539e-40,-7714712731336878e-41,1323635453126044e-41,-22709994129429287e-43,38964189980039913e-44,-6685198115125953e-44,11469986631400244e-45,-1.9679385863451348e-30,3376448816585338e-46,-5793070335782136e-47];if(Number.isNaN(e))return Number.NaN;if(0==e||e<0&&e===Math.trunc(e))return Number.NaN;let i,n=Math.abs(e);if(n<=10){let r=Math.trunc(e);if(e<0&&r--,n=e-r,r--,i=or(2*n-1,t,22)+.9375,0==r)return i;if(r<0){if(e<-.5&&Math.abs(e-Math.trunc(e-.5)/e)<1.4901161193847656e-8)return Number.NaN;if(n<22474362225598545e-324)return e<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;r*=-1;for(let t=0;t<r;t++)i/=e+t;return i}for(let e=1;e<=r;e++)i*=n+e;return i}{if(e>171.61447887182297)return Number.POSITIVE_INFINITY;if(e<-170.5674972726612)return 0;if(n<=50&&n==Math.trunc(n)){i=1;for(let e=2;e<n;e++)i*=e}else{const e=2*n;i=Math.exp((n-.5)*Math.log(n)-n+dr+(e==Math.trunc(e)?mr(n):sr(n)))}if(e>0)return i;const t=ar(n);return 0===t?Number.POSITIVE_INFINITY:-Math.PI/(n*t*i)}}(e))):t>Number.MAX_VALUE?Number.POSITIVE_INFINITY:e>0?e>1e17?e*(Math.log(e)-1):dr+(e-.5)*Math.log(e)-e+(e>4934720?0:sr(e)):.22579135264472744+(e-.5)*Math.log(t)-e-Math.log(Math.abs(ar(t)))-sr(t)}const yr=[[.6931471824645996,-1.9046542121259336e-9,-878318373858934e-31,3061840738529369e-39],[.6853040456771851,-4.2578264469739224e-8,-11723105396588968e-31,620339263720161e-37],[.6773988008499146,2.274189014883632e-8,14411920431605914e-31,7046384546650164e-38],[.6699305772781372,-4.8293856025338755e-8,-8664795531738382e-31,7049557660755325e-39],[.6624060869216919,-4.791602492559832e-8,-2161508226230938e-30,7092968360825275e-38],[.6548244953155518,6.237715233226027e-9,11806699607549086e-32,6660323533535123e-40],[.6471850872039795,-4.220866856030625e-8,-13817589176253094e-31,-11159932395766606e-39],[.6400018930435181,-4.979170142860312e-8,4887013763907625e-31,16847465694533583e-39],[.6327667236328125,-5.406177194799966e-8,-27224545250006775e-31,-29070780223955397e-39],[.6249561309814453,3.285935434860221e-8,1201672936775467e-31,-8668233185091897e-39],[.6181373596191406,-6406189467789147e-26,3550580962335878e-33,-3623679406748965e-40],[.6107416152954102,4.229853800552519e-8,1548143293520366e-30,-5446353118719766e-38],[.6032907962799072,5.515817491641428e-8,21193636784238266e-31,1247109826410663e-37],[.5963221788406372,3.28135385530004e-9,-14033469816541837e-32,5544061982643074e-39],[.5893045663833618,4.307998580088679e-8,-32446651600595306e-31,-2569782398567476e-38],[.5822374820709229,-3.983067387025585e-8,29387905513776885e-31,16124430498687833e-38],[.5751199722290039,2.242384056216906e-9,-2204516403537114e-32,4078543753751354e-40],[.5685046911239624,4.422870603093543e-8,27879957109977287e-32,-9741708794029408e-39],[.5618454217910767,2.147161382026752e-8,13374919170106156e-31,-2326922260336506e-38],[.554580807685852,4.57783499996367e-9,2633145912141026e-31,2070995903387998e-38],[.5478278398513794,-7.667999568639061e-9,6199095327775322e-31,6341979011056023e-39],[.5410289764404297,-3.7302321231891256e-8,-33801781496424835e-31,14469198371142414e-38],[.5347557067871094,4.382891916066001e-8,-8601820749692393e-31,-8775950563978016e-39],[.5278670787811279,1.0839714903454478e-8,-4480281248130319e-31,38840996084516777e-39],[.5215104818344116,4.2031594205127476e-8,1211009992711288e-30,-23206744819671555e-39],[.5145297050476074,-1.2322940889930578e-8,2820084495413274e-31,1880026562185923e-38],[.5080875158309937,-1.2297126872340414e-8,-4295835588700959e-31,-18036626177499945e-39],[.5016034841537476,5.9145378372704727e-8,12728561033550608e-31,-5824094430019416e-38],[.4950772523880005,1.4409851090135817e-8,-6381910184083422e-32,-3500509376717118e-40],[.48910707235336304,2.745798610703787e-8,-14470418644525664e-31,4211866896949939e-38],[.4824984669685364,1.762245460668055e-8,4128675224747099e-31,26082691866392177e-39],[.4764525294303894,-1.2470243504481004e-8,-9162193924794196e-32,3765782542240376e-39],[.469759464263916,-5.450353945946063e-9,-4304846960468561e-31,2074710343707083e-40],[.46363574266433716,-1.7013046527125653e-9,7601622738878589e-33,-20415879231895994e-41],[.4574742913246155,6.943684516258486e-10,-25461310777374286e-33,55412533419976475e-41],[.4512746334075928,1.0731865174307131e-8,6374000219845047e-31,3901547318408994e-38],[.44503629207611084,2.8650656958006948e-8,-9155352545558342e-31,-47365878254772817e-39],[.43938833475112915,2.6186132373595683e-8,13619601577579505e-31,-52672794844240613e-39],[.4330751895904541,1.9065733880552216e-8,1014319201479946e-30,10145670737413337e-38],[.42735910415649414,-1.141359362577532e-8,13242044582274781e-32,-10240055893684678e-39],[.42096930742263794,-1.2778508917676845e-8,6143525731270704e-31,1419242178938019e-38],[.4151833653450012,-7.767916088141646e-9,5955443124124071e-31,2732668133771502e-38],[.4093637466430664,1.8807551072086426e-9,19153331349462894e-32,-56208063158075e-37],[.40351009368896484,-2.0416603518924603e-8,-293405013148838e-30,1894346911970581e-39],[.39762192964553833,1.0016001361634608e-9,22863242352463633e-33,9458133611770764e-40],[.3916988968849182,1.545909711353488e-8,10962823446210085e-31,3108302239821126e-38],[.3864043951034546,-2.076412375373593e-9,15073464810114547e-32,7412449454375094e-39],[.38041436672210693,-8.244395388601333e-9,14866224964678982e-32,-3927292740683968e-39],[.3743882179260254,9.158529934438775e-9,5656919067358501e-31,34213474905617904e-39],[.36900103092193604,-2.2253590969967263e-8,6231405399548338e-31,-21564751355837555e-39],[.36358463764190674,-2.6778728567933285e-8,-9943908455716573e-31,-4704929732945495e-39],[.35745590925216675,-2.033036139437172e-8,-15794492077344114e-31,6318678032068057e-38],[.3519763946533203,2.850385882879891e-8,-9566434575519799e-31,-6409595040255684e-39],[.3464667797088623,-1.236265312343221e-8,-6003368248279719e-31,-2860901497105794e-39],[.3409265875816345,-6.110413286464222e-10,17467136243918857e-33,19962587429804357e-41],[.3353555202484131,2.167272583619706e-8,-10918773497788125e-31,-3047574780704126e-38],[.33045530319213867,-1.608884048209802e-8,-3833435008838916e-31,-7683741875124221e-39],[.3248254060745239,2.801670362373443e-8,-20725720961098414e-32,13160777896524739e-39],[.3191636800765991,2.6222629401218e-8,-13995222573204161e-31,8599883909680833e-38],[.31418323516845703,2.6826626253750874e-8,-9792556373536439e-31,22954960929108544e-39],[.3084607720375061,1.368350943664609e-8,5591995050742643e-31,-11938701403427125e-39],[.3034266233444214,-8.629042369534545e-9,-5222554219259392e-31,3228770766379237e-38],[.2983669638633728,8.688424202318856e-9,2764116793423446e-31,-10171858868428321e-39],[.29255300760269165,-4.91631446664087e-9,2562284723960507e-31,-26341575505102177e-39],[.28743791580200195,-1.3782395669181824e-8,729039351877645e-30,-4431977943282236e-39],[.28229647874832153,2.3770866164340987e-8,6449228392264254e-31,3417536976845211e-38],[.27712851762771606,1.4733029018998423e-8,6793364114448283e-31,3593898034032222e-39],[.27193373441696167,-1.8933320689029642e-8,777939410955583e-30,2591972424742619e-38],[.2667117714881897,14300387263244119e-27,-7458876800955772e-34,4247418782257993e-41],[.2622140049934387,7.802219315067305e-9,5022431038767539e-31,-24063174816868367e-39],[.25694090127944946,2.9618050234603288e-8,7279528203645545e-31,2638556081145549e-38],[.2516399025917053,-6.44787778725231e-9,4122028133693521e-31,7427559296153698e-39],[.2470736801624298,-1.9981829524340355e-9,-10909757890855787e-32,6236552089808213e-39],[.24171993136405945,5.523085988556886e-9,-2686547633696265e-31,-2764495989170092e-39],[.23710808157920837,1.0085374313462125e-8,-4775626813761317e-31,2330620598032363e-38],[.231700599193573,-1.3946383603524737e-8,10970921279709183e-33,3229909378627549e-40],[.22704219818115234,-6.451284839670279e-9,-42529947798112047e-32,-10260254677162862e-39],[.2223619818687439,1.4110645096820917e-8,6025568981827254e-31,19385180739531644e-39],[.21765980124473572,-8.286782815503102e-9,5232363919579781e-31,5078443538654066e-38],[.21214580535888672,-8.254218641923217e-9,3255553133321774e-31,1571430013634162e-38],[.20739519596099854,-1.6149279691290985e-9,21131592679643073e-33,14275617427027514e-40],[.20262190699577332,8.597639933327628e-9,-33804619056798137e-32,25623235609364303e-40],[.19782572984695435,1.348296585490516e-8,-32024568730231384e-32,-25712252251631252e-39],[.1930064558982849,9.956859781112826e-10,9001674563844606e-32,-3754797654135173e-39],[.1889725625514984,4.2415360113068346e-9,38086815297465933e-32,-21147402916208568e-39],[.18411031365394592,6.931054841174955e-9,-34784858522920016e-32,24665943434547742e-39],[.17922431230545044,5.0739235035734964e-9,32221329189922637e-32,-10379009008973928e-39],[.17431432008743286,3.794385250444066e-9,3190066898587176e-31,20292714723890484e-39],[.17020416259765625,3.4223344158590407e-9,-18846416901959178e-32,11415315069779235e-39],[.16524958610534668,-1.3210039284672348e-8,-23213954359040806e-32,3043054213286757e-39],[.1602703034877777,6.007922159767531e-9,-7521047737154288e-32,-12649106048711768e-41],[.15610191226005554,-1.2301535790015805e-8,30175617567361414e-32,-8633806506327147e-39],[.15191605687141418,-1.4845571882915465e-8,-3265830289949929e-31,-15268151962784823e-39],[.14686977863311768,-4.6748995785605985e-9,-4294291341758996e-31,1328295982896899e-38],[.142645001411438,9.186472027522541e-9,-8049373155998929e-31,1437998766909278e-38],[.1384023129940033,9.86511672351753e-9,-8837306496940929e-31,7295324909194215e-39],[.1332872211933136,9.990350768873668e-10,3316946610734358e-32,27351440526086287e-40],[.129004567861557,-7.46120853989396e-9,-6212113165383437e-31,1855187264989731e-39],[.12470348179340363,-3.2924463155836747e-9,-7404120132741752e-32,13246955625609024e-40],[.12038381397724152,3.3791991427278845e-9,16214981996371606e-32,-600070673940474e-38],[.11604541540145874,3.5638392237302696e-10,-7354219635108878e-33,7794312440645008e-41],[.11168810725212097,3.136765958089427e-9,-8994406293238225e-34,-7920937558182207e-41],[.10731174051761627,-4.728527791542092e-9,-42976339455270984e-32,5351143287258107e-39],[.10291612148284912,2.8332007850906393e-9,4925742757234052e-32,2794436810397303e-39],[.09850110113620758,4.970725164810119e-9,4130512756847049e-31,6313449560595865e-40],[.09406651556491852,-6.525850970717784e-9,-13492816627243298e-32,-9079650179574527e-39],[.08961215615272522,2.5369617517867482e-9,16110664594961319e-32,-5189504504486964e-39],[.08603434264659882,-5.304795713811927e-9,5127575488441481e-32,1463615545692133e-39],[.08154398202896118,2.0112156384755053e-9,8065769331577608e-32,-30150319017810437e-40],[.07703337073326111,5.7495661565099e-9,-2503851097302985e-31,-1846143093040508e-38],[.07250232994556427,1.177662634077592e-9,-3525476857925506e-32,13164077898906505e-40],[.0688626617193222,-7.043545302565235e-9,249712406751501e-30,10686882487619963e-39],[.06429435312747955,-2.422082090447475e-9,-20555896149129847e-32,8602907613530545e-39],[.0606246218085289,7905943261166115e-27,-8270443345471096e-34,-23533820836754142e-42],[.056018441915512085,-5.139745296034448e-10,-3811651571366802e-32,19072195442219776e-40],[.052318163216114044,-3.5574325707443677e-9,9191155834145393e-32,-5321463973420977e-39],[.04767347127199173,-1.8026349302147082e-9,10329634289704177e-32,-22283569301283993e-40],[.04394212365150452,-1.795005699634089e-9,-53817402974104447e-33,-13996196977941442e-40],[.040196798741817474,3.8451930528538014e-10,-24485452721520977e-33,-7386769024377949e-41],[.0354953333735466,-3.5901653872016936e-10,-2073207767866976e-32,-2412097216555168e-41],[.0317181795835495,6.87235046648027e-10,-6430478093749473e-33,13508692031871337e-41],[.02792670577764511,7.568773385813188e-10,-422031585165944e-31,2534760563692782e-39],[.02412080392241478,-1.1255707477175747e-9,489700584100947e-31,14172214525647275e-40],[.01934296265244484,1.9068610579431322e-10,-10635946218849709e-33,-5300489542457734e-40],[.015504186972975731,-4.3701048335620385e-10,661106154763715e-32,25398086818405174e-41],[.01165061630308628,9.168890091615367e-10,-15848697818454755e-33,-1350491609984469e-39],[.007782140746712685,-3.046577434773212e-10,7793435996762285e-33,4660100148208369e-40],[.0038986406289041042,-2.1324678134426733e-10,12541658163801307e-35,8745035431740123e-42],[0,0,0,0]];function vr(e,t,i){const n=Math.floor(e+.5);return{yh:t+n,yl:i+(e-n)}}function br(e,t,i){const n=i?Number.NEGATIVE_INFINITY:0;if(0===t)return 0===e?i?0:1:n;if(!Number.isFinite(t)||e<0)return n;if(e<=t*Number.MIN_VALUE)return i?-t:Math.exp(-t);if(t<e*Number.MIN_VALUE){if(!Number.isFinite(e))return n;const r=-t+e*Math.log(t)-fr(e);return i?r:Math.exp(r)}let{yh:r,yl:o}=function(e,t){let i=0,n=0;if(e===t)return{yh:0,yl:0};if(0===e)return{yh:t,yl:0};if(0===t)return{yh:Number.POSITIVE_INFINITY,yl:0};if(t/e===Number.POSITIVE_INFINITY)return{yh:t,yl:0};let{mantissa:r,exponent:o}=function(e){if(0===e)return{mantissa:0,exponent:0};const t=new DataView(new ArrayBuffer(8));t.setFloat64(0,e);let i=t.getUint32(0)>>>20&2047;0===i&&(t.setFloat64(0,e*Math.pow(2,64)),i=(t.getUint32(0)>>>20&2047)-64);const n=i-1022;return{mantissa:e/Math.pow(2,n),exponent:n}}(t/e);if(Math.LN2*-o>1+Number.MAX_VALUE/e)return{yh:Number.POSITIVE_INFINITY,yl:0};const a=Math.floor(256*(r-.5)+.5),s=lr(Math.floor(1024/(.5+a/256)+.5),-(o+10));if(s===Number.POSITIVE_INFINITY)return{yh:Number.POSITIVE_INFINITY,yl:0};if(({yh:i,yl:n}=vr(-e*pr((t*s-e)/e),i,n)),1===s)return{yh:i,yl:n};for(let t=0;t<4;t++)if(({yh:i,yl:n}=vr(e*yr[a][t],i,n)),({yh:i,yl:n}=vr(-e*yr[0][t]*o,i,n)),!Number.isFinite(i))return{yh:Number.POSITIVE_INFINITY,yl:0};return({yh:i,yl:n}=vr(t,i,n)),({yh:i,yl:n}=vr(-t*s,i,n)),{yh:i,yl:n}}(e,t);o+=mr(e);let a=e>=Number.MAX_VALUE,s=a?2.5066282746310007*Math.sqrt(e):6.283185307179586*e;return i?-o-r-(a?Math.log(s):.5*Math.log(s)):Math.exp(-o)*Math.exp(-r)/(a?s:Math.sqrt(s))}function _r(e,t,i){if(!Number.isFinite(t))return i?Number.NEGATIVE_INFINITY:0;if(e>1)return br(e-1,t,i);let n;return n=t>0x2c5c85fdf473de00*Math.abs(e-1)?-t-gr(e):br(e,t,!0)+Math.log(e)-Math.log(t),i?n:Math.exp(n)}function Nr(e,t){if(0==e)return 0;let i,n=e/t;if(Math.abs(e-1)<Math.abs(t)*Number.EPSILON)return n;n>1&&(n=1);let r=e,o=t,a=0,s=1,l=e,u=t;const p=1157921e71;for(;u>p;)a/=p,s/=p,l/=p,u/=p;let c=0,d=-1,h=0;for(;c<2e5;)if(c++,r--,i=c*r,o+=2,a=o*l+i*a,s=o*u+i*s,c++,r--,i=c*r,o+=2,l=o*a+i*l,u=o*s+i*u,u>p&&(a/=p,s/=p,l/=p,u/=p),0!==u){if(h=l/u,Math.abs(h-d)<=Number.EPSILON*Math.max(n,Math.abs(h)))return h;d=h}return h}function wr(e,t,i,n=!1){if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(i))return e+t+i;const r=n?Number.NEGATIVE_INFINITY:0;if(!Number.isFinite(i))return r;if(!Number.isFinite(e)&&t==e)return Number.NaN;const o=(e-t)/i;if(!Number.isFinite(o))return r;const a=Math.abs(o);if(a>=2*Math.sqrt(Number.MAX_VALUE))return r;if(n)return-(dr+.5*a*a+Math.log(i));if(a<5)return hr*Math.exp(-.5*a*a)/i;if(a>38.56804181549334)return 0;let s=lr(Math.trunc(lr(a,16)),-16),l=a-s;return hr/i*(Math.exp(-.5*s*s)*Math.exp((-.5*l-s)*l))}function xr(e){return e>-Math.LN2?Math.log(-Math.expm1(e)):Math.log1p(-Math.exp(e))}function Er(e,t,i=!0,n=!1){let r;const o=n?Number.NEGATIVE_INFINITY:0,a=n?0:1;if(e<=0)return i?o:a;if(e>=Number.POSITIVE_INFINITY)return i?a:o;if(e<1){let o=0,a=t,s=0,l=1;for(;Math.abs(l)>Number.EPSILON*Math.abs(o);)s++,a*=-e/s,l=a/(t+s),o+=l;if(i){const i=n?Math.log1p(o):1+o;let a;t>1?(a=br(t,e,n),a=n?a+e:a*Math.exp(e)):a=n?t*Math.log(e)-fr(t):Math.pow(e,t)/Math.exp(fr(t)),r=n?i+a:i*a}else{const i=t*Math.log(e)-fr(t);if(n)r=xr(Math.log1p(o)+i);else{let e=o,t=Math.expm1(i);r=-(e+t+e*t)}}}else if(e<=t-1&&e<.8*(t+50)){let o=t,a=e/o,s=a;for(;a>Number.EPSILON*s;)o++,a*=e/o,s+=a;s=n?Math.log(s):s;const l=_r(t,e,n);r=i?n?s+l:s*l:n?xr(l+s):1-l*s}else if(t-1<e&&t<.8*(e+50)){let o=0;const a=_r(t,e,n);if(t<1)if(e*Number.EPSILON>1-t)o=n?0:1;else{const i=Nr(t,e-(t-1))*e/t;o=n?Math.log(i):i}else{let i=1,r=t-1;for(;r>=1&&i>o*Number.EPSILON;)i*=r/e,o+=i,r--;r!=Math.floor(r)&&(o+=i*Nr(r,e+1-r)),o=n?Math.log1p(o):1+o}r=i?n?xr(a+o):1-a*o:n?o+a:o*a}else r=function(e,t,i,n){const r=[-1e99,2/3,-4/135,8/2835,16/8505,-8992/12629925,-334144/492567075,698752/1477701225],o=[-1e99,1/12,1/288,-139/51840,-571/2488320,163879/209018880,5246819/75246796800,-.0005921664373536939];let a,s,l,u,p,c,d,h,f,m,g,y,v;for(h=t-e,f=-pr(h/e),m=Math.sqrt(2*e*f),h<0&&(m=-m),l=0,p=u=Math.sqrt(e),d=c=m,v=1;v<8;v++)l+=p*r[v],l+=d*o[v],u*=f/v,c*=2*f/(2*v+1),p=p/e+u,d=d/e+c;for(a=e,s=1,v=1;v<8;v++)a+=s*o[v],s/=e;if(i||(a=-a),g=l/a,y=function(e,t,i,n=!0,r=!1){if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(i))return e+t+i;if(!Number.isFinite(e)&&t==e)return Number.NaN;const o=n?r?Number.NEGATIVE_INFINITY:0:r?0:1,a=n?r?0:1:r?Number.NEGATIVE_INFINITY:0;let s=(e-t)/i;return Number.isFinite(s)?function(e,t,i){let n=t?0:1;const r=[2.2352520354606837,161.02823106855587,1067.6894854603709,18154.98125334356,.06568233791820745],o=[47.202581904688245,976.0985517377767,10260.932208618979,45507.78933502673],a=[.39894151208813466,8.883149794388377,93.50665613217785,597.2702763948002,2494.5375852903726,6848.190450536283,11602.65143764735,9842.714838383978,1.0765576773720192e-8],s=[22.266688044328117,235.387901782625,1519.3775994075547,6485.558298266761,18615.571640885097,34900.95272114598,38912.00328609327,19685.429676859992],l=[.215898534057957,.12740116116024736,.022235277870649807,.0014216191932278934,29112874951168793e-21,.023073441764940174],u=[1.284260096144911,.4682382124808651,.06598813786892856,.0037823963320275824,7297515550839662e-20];let p,c,d,h,f,m,g,y,v,b;if(Number.isNaN(e))return Number.NaN;f=.5*Number.EPSILON,v=1!=n,b=0!=n;let _=0,N=0;if(g=Math.abs(e),g<=.67448975){if(g>f)for(m=e*e,c=r[4]*m,p=m,y=0;y<3;++y)c=(c+r[y])*m,p=(p+o[y])*m;else c=p=0;d=e*(c+r[3])/(p+o[3]),v&&(_=.5+d),b&&(N=.5-d),i&&(v&&(_=Math.log(_)),b&&(N=Math.log(N)))}else if(g<=5.656854249492381){for(c=a[8]*g,p=g,y=0;y<7;++y)c=(c+a[y])*g,p=(p+s[y])*g;d=(c+a[7])/(p+s[7]),m=lr(Math.trunc(lr(g,4)),-4),h=(g-m)*(g+m),i?(_=-m*lr(m,-1)-lr(h,-1)+Math.log(d),(v&&e>0||b&&e<=0)&&(N=Math.log1p(-Math.exp(-m*lr(m,-1))*Math.exp(-lr(h,-1))*d))):(_=Math.exp(-m*lr(m,-1))*Math.exp(-lr(h,-1))*d,N=1-_),e>0&&(d=_,v&&(_=N),N=d)}else if(i&&g<1e170||v&&-38.4674<e&&e<8.2924||b&&-8.2924<e&&e<38.4674){for(m=1/(e*e),c=l[5]*m,p=m,y=0;y<4;++y)c=(c+l[y])*m,p=(p+u[y])*m;d=m*(c+l[4])/(p+u[4]),d=(hr-d)/g,m=lr(Math.trunc(lr(e,4)),-4),h=(e-m)*(e+m),i?(_=-m*lr(m,-1)-lr(h,-1)+Math.log(d),(v&&e>0||b&&e<=0)&&(N=Math.log1p(-Math.exp(-m*lr(m,-1))*Math.exp(-lr(h,-1))*d))):(_=Math.exp(-m*lr(m,-1))*Math.exp(-lr(h,-1))*d,N=1-_),e>0&&(d=_,v&&(_=N),N=d)}else e>0?(_=i?0:1,N=i?Number.NEGATIVE_INFINITY:0):(_=i?Number.NEGATIVE_INFINITY:0,N=i?0:1);return t?_:N}(s,n,r):e<t?o:a}(m,0,1,!i,n),n){let e,t=!i;if(m<0&&(m=-m,t=!t),m>10&&!t){let t=1/m,i=t,n=m*m,r=1;for(;Math.abs(t)>Number.EPSILON*i;)t*=-r/n,i+=t,r+=2;e=1/i}else e=wr(m,0,1,!1)/Math.exp(y);return y+Math.log1p(g*e)}return y+g*wr(m,0,1,n)}(t-1,e,!i,n);return!n&&r<Number.MIN_VALUE/Number.EPSILON?Math.exp(Er(e,t,i,!0)):r}function Mr(e,t,i,n=!0,r=!1){if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(i))return e+t+i;if(t<0||i<=0)return Number.NaN;if(e/=i,Number.isNaN(e))return e;if(0===t){const t=r?Number.NEGATIVE_INFINITY:0,i=r?0:1;return e<=0?n?t:i:n?i:t}return Er(e,t,n,r)}function Sr(e,t,i,n){if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(i))return e+t+i;if(t<0||i<=0)return Number.NaN;const r=n?Number.NEGATIVE_INFINITY:0;if(e<0)return r;if(0===t)return 0===e?Number.POSITIVE_INFINITY:r;if(0===e)return t<1?Number.POSITIVE_INFINITY:t>1?r:n?-Math.log(i):1/i;let o;if(t<1){if(o=br(t,e/i,n),n){const i=t/e;return o+(Number.isFinite(i)?Math.log(i):Math.log(t)-Math.log(e))}return o*t/e}return o=br(t-1,e/i,n),n?o-Math.log(i):o/i}function Ir(e,t,i,n,r,o,a,s){let l,u=.5*n*e;if(0===a)return u;if(o||(t=Math.log(t),o=!0),0===u){const e=1+1e-7,a=1-1e-7;if(u=Number.MIN_VALUE,l=Mr(u,i,n,r,o),r&&l>t*e||!r&&l<t*a)return 0}else l=Mr(u,i,n,r,o);if(l===Number.NEGATIVE_INFINITY)return 0;const p=o?Number.NEGATIVE_INFINITY:0;for(let e=1;e<=a;e++){const a=l-t;if(Math.abs(a)<Math.abs(s*t))break;const c=Sr(u,i,n,o);if(c===p)break;let d=o?a*Math.exp(l-c):a/c;d=r?u-d:u+d,l=Mr(d,i,n,r,o);const h=Math.abs(l-t),f=Math.abs(a);if(h>f||e>1&&h===f)break;u=d}return u}function Tr(e,t,i,n){let r=i[0],o=n[0];for(let t=1;t<i.length;t++)r=r*e+i[t],o=o*e+n[t];return t*r/o}function Ar(e,t,i){return t?i?e:Math.log(e):i?xr(e):Math.log1p(-e)}function $r(e,t,i=!0,n=!1){return function(e,t,i,n=!0,r=!1){if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(i))return e+t+i;if(r){if(e>0)return Number.NaN;if(0===e)return n?Number.POSITIVE_INFINITY:0;if(e===Number.NEGATIVE_INFINITY)return n?0:Number.POSITIVE_INFINITY}else{if(e<0||e>1)return Number.NaN;if(0===e)return n?0:Number.POSITIVE_INFINITY;if(1===e)return n?Number.POSITIVE_INFINITY:0}if(t<0||i<=0)return Number.NaN;if(0===t)return 0;let o=1;t<1e-10&&(o=7);const a=gr(t);let s=function(e,t,i,n=!0,r=!1,o){if(Number.isNaN(e)||Number.isNaN(t))return e+t;if(r&&e>0||!r&&(e<0||e>1)||t<=0)return Number.NaN;const a=.5*t;let s=Ar(e,n,r);if(t<-1.24*s){const e=a<.5?fr(a):Math.log(t)-Math.LN2+i;return Math.exp((e+s)/a+Math.LN2)}const l=a-1;if(t>.32){const o=function(e,t,i,n,r){let o,a,s,l;if(Number.isNaN(e)||Number.isNaN(0)||Number.isNaN(1))return e+0+1;if(r){if(e>0)return Number.NaN;if(0==e)return n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;if(e==Number.NEGATIVE_INFINITY)return n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY}else{if(e<0||e>1)return Number.NaN;if(0==e)return n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;if(1==e)return n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY}o=r?n?Math.exp(e):-Math.expm1(e):n?e:.5-e+.5,a=o-.5;const u=[.0007745450142783414,.022723844989269184,.2417807251774506,1.2704582524523684,3.6478483247632045,5.769497221460691,4.630337846156546,1.4234371107496835],p=[1.0507500716444169e-9,.0005475938084995345,.015198666563616457,.14810397642748008,.6897673349851,1.6763848301838038,2.053191626637759,1],c=[2.0103343992922881e-7,27115555687434876e-21,.0012426609473880784,.026532189526576124,.29656057182850487,1.7848265399172913,5.463784911164114,6.657904643501103],d=[20442631033899397e-31,1.421511758316446e-7,18463183175100548e-21,.0007868691311456133,.014875361290850615,.1369298809227358,.599832206555888,1];if(Math.abs(a)<=.425)s=.180625-a*a,l=Tr(s,a,[2509.0809287301227,33430.57558358813,67265.7709270087,45921.95393154987,13731.69376550946,1971.5909503065513,133.14166789178438,3.3871328727963665],[5226.495278852854,28729.085735721943,39307.89580009271,21213.794301586597,5394.196021424751,687.1870074920579,42.31333070160091,1]);else{let t;if(r&&(n&&a<=0||!n&&a>0)?t=e:(t=a>0?r?n?-Math.expm1(e):Math.exp(e):n?.5-e+.5:e:o,t=Math.log(t)),s=Math.sqrt(-t),s<=5)l=Tr(s-1.6,1,u,p);else if(s<=27)l=Tr(s-5,1,c,d);else if(s>=64e7)l=s*Math.SQRT2;else{const e=-lr(t,1);let i=e-(Math.log(e)+cr);s<36e3&&(i=e-(cr+Math.log(i))-2/(2+i),s<840&&(i=e-(cr+Math.log(i))+2*Math.log1p(-(1-1/(4+i))/(2+i)),s<109&&(i=e-(cr+Math.log(i))+2*Math.log1p(-(1-(1-5/(6+i))/(4+i))/(2+i)),s<55&&(i=e-(cr+Math.log(i))+2*Math.log1p(-(1-(1-(5-9/(8+i))/(6+i))/(4+i))/(2+i)))))),l=Math.sqrt(i)}a<0&&(l=-l)}return 0+1*l}(e,0,0,n,r);s=2/(9*t);const a=t*Math.pow(o*Math.sqrt(s)+1-s,3);return a>2.2*t+6?-2*(Ar(e,!n,r)-l*(Math.log(a)-Math.LN2)+i):a}let u=.4,p=0,c=0,d=0;const h=Ar(e,!n,r)+i+l*Math.LN2;for(;Math.abs(c-u)>o*Math.abs(u);)c=u,s=1/(1+u*(4.67+u)),p=u*(6.73+u*(6.66+u)),d=(4.67+2*u)*s-.5-(6.73+u*(13.32+3*u))/p,u-=(1-Math.exp(h+.5*u)*p*s)/d;return u}(e,2*t,a,n,r,.01);if(!Number.isFinite(s))return Ir(s,e,t,i,n,r,0,1e-15);const l=r?n?Math.exp(e):-Math.expm1(e):n?e:.5-e+.5;if(s<5e-7||l>1-1e-14||l<1e-100)return Ir(s,e,t,i,n,r,20,1e-15);const u=1/420,p=1/2520,c=1/5040,d=t-1,h=(120+d*(346+127*d))*c,f=s;for(let m=1;m<=1e3;m++){const m=s,g=.5*s,y=l-Er(g,t);if(!Number.isFinite(y)||s<=0)return Ir(f,e,t,i,n,r,27,1e-15);const v=y*Math.exp(t*Math.LN2+a+g-d*Math.log(s)),b=v/s,_=.5*v-b*d,N=(210+_*(140+_*(105+_*(84+_*(70+60*_)))))*u;if(s+=v*(1+.5*v*N-b*d*(N-b*((420+_*(735+_*(966+_*(1141+1278*_))))*p-b*((210+_*(462+_*(707+932*_)))*p-b*((252+_*(672+1182*_)+d*(294+_*(889+1740*_)))*c-b*((84+2264*_+d*(1175+606*_))*p-b*h)))))),Math.abs(m-s)<5e-7*s)return Ir(s,e,t,i,n,r,o,1e-15);Math.abs(m-s)>.1*s&&(s=m*(s<m?.9:1.1))}return Ir(s,e,t,i,n,r,o,1e-15)}(e,.5*t,2,i,n)}const Pr=function(e){return[]},kr=function(e){const t=e.denominators;return On(Nn(2,kn(t)))},Lr=function(e){return 1},Dr=function(e){const t=e.numerators,i=e.denominators;return kn(_n(t,i))},Rr=function(e){const t=e.target_transformed,i=e.q,n=e.SE,r=e.tau2,o=t+i*kn(Vn(n)+r);return Fn(Vn(o),{lower:0})},Vr=function(e){const t=e.denominators,i=e.p;return Fn($r(i,2*(t+(i>.5?1:0)))/2/t,{lower:0})},Or=function(e){const t=e.denominators;return On(Nn(2,kn(t)))},Fr=function(e){const t=e.numerators,i=e.denominators;return wt(t)/wt(i)},Cr=function(e){return Math.asin(Math.sqrt(Fr(e)))},jr=function(e){const t=e.numerators,i=e.denominators;return Rn(kn(_n(t,i)))},Ur=function(e){const t=e.target_transformed,i=e.q,n=e.SE,r=e.tau2,o=t+i*kn(Vn(n)+r);return Fn(Vn(Math.sin(o)),{lower:0,upper:1})},zr=function(e){const t=e.numerators?e.numerators:e.denominators,i=e.denominators;return kn(vn(_n(t,Vn(vn(t,.5))),_n(i,Vn(vn(i,.5)))))},qr=function(e){const t=e.numerators,i=e.denominators;return wt(t)/wt(i)},Gr=function(e){const t=e.numerators,i=e.denominators;return Dn(wt(t))-Dn(wt(i))},Yr=function(e){const t=e.numerators,i=e.denominators;return Dn(_n(vn(t,.5),vn(i,.5)))},Hr=function(e){const t=e.target_transformed,i=e.q,n=e.SE,r=e.tau2,o=t+i*kn(Vn(n)+r);return Fn(Ln(o),{lower:0})};var Br=Object.freeze({__proto__:null,PR:class extends nr{constructor(e,t){super({seFunction:Or,seFunctionOD:Or,targetFunction:Fr,targetFunctionTransformed:Cr,yFunction:jr,limitFunction:Ur,limitFunctionOD:Ur,inputData:e,inputSettings:t})}},RC:class extends nr{constructor(e,t){super({seFunction:zr,seFunctionOD:zr,targetFunction:qr,targetFunctionTransformed:Gr,yFunction:Yr,limitFunction:Hr,limitFunctionOD:Hr,inputData:e,inputSettings:t})}},SR:class extends nr{constructor(e,t){super({seFunction:Pr,seFunctionOD:kr,targetFunction:Lr,targetFunctionTransformed:Lr,yFunction:Dr,limitFunction:Vr,limitFunctionOD:Rr,inputData:e,inputSettings:t})}}});function Xr(e,t){return null!==t.ll95&&e<t.ll95?"lower":null!==t.ul95&&e>t.ul95?"upper":"none"}function Wr(e,t){return null!==t.ll99&&e<t.ll99?"lower":null!==t.ul99&&e>t.ul99?"upper":"none"}class Kr{constructor(){this.inputData=null,this.inputSettings=new hs,this.chartBase=null,this.calculatedLimits=null,this.plotPoints=new Array,this.groupedLines=new Array,this.firstRun=!0,this.colourPalette=null,this.headless=!1}update(e,t){var i;const n={status:!0};if((2===e.type||this.firstRun)&&this.inputSettings.update(e.dataViews[0]),""!==this.inputSettings.validationStatus.error)return n.status=!1,n.error=this.inputSettings.validationStatus.error,n.type="settings",n;const r=function(e){var t,i,n,r,o,a;if(!(null==e?void 0:e[0]))return"No data present";if(!(null===(i=null===(t=e[0])||void 0===t?void 0:t.categorical)||void 0===i?void 0:i.categories))return"No grouping/ID variable passed!";const s=null===(r=null===(n=e[0].categorical)||void 0===n?void 0:n.values)||void 0===r?void 0:r.some(e=>{var t,i;return null===(i=null===(t=e.source)||void 0===t?void 0:t.roles)||void 0===i?void 0:i.numerators});if(!s)return"No Numerators passed!";const l=null===(a=null===(o=e[0].categorical)||void 0===o?void 0:o.values)||void 0===a?void 0:a.some(e=>{var t,i;return null===(i=null===(t=e.source)||void 0===t?void 0:t.roles)||void 0===i?void 0:i.denominators});return l?"valid":"No denominators passed!"}(e.dataViews);if("valid"!==r)return n.status=!1,n.error=r,n;if(mn(this.colourPalette)&&(this.colourPalette={isHighContrast:t.colorPalette.isHighContrast,foregroundColour:t.colorPalette.foreground.value,backgroundColour:t.colorPalette.background.value,foregroundSelectedColour:t.colorPalette.foregroundSelected.value,hyperlinkColour:t.colorPalette.hyperlink.value}),this.svgWidth=e.viewport.width,this.svgHeight=e.viewport.height,this.headless=null!==(i=null==e?void 0:e.headless)&&void 0!==i&&i,2===e.type||this.firstRun){const i=this.inputSettings.settings.funnel.chart_type;this.inputData=function(e,t){var i,n;const r=t.settings,o=In(e,"numerators"),a=In(e,"denominators"),s=In(e,"key"),l=In(e,"labels");let u=null===(i=Mn(e,"scatter",r))||void 0===i?void 0:i.values;u=null===u?En(r.scatter,o.length):u;let p=null===(n=Mn(e,"labels",r))||void 0===n?void 0:n.values;p=null===p?En(r.labels,o.length):p;const c=In(e,"tooltips"),d=e.values[0].highlights,h=function(e,t,i,n){const r={status:0,messages:En("",e.length)};return e.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?null!=e?"":"Group missing":r.messages[t]}),r.messages.some(e=>""==e)?(t.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?null!=e?"":"Numerator missing":r.messages[t]}),r.messages.some(e=>""==e)?(t.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?isNaN(e)?"Numerator is not a number":"":r.messages[t]}),r.messages.some(e=>""==e)?(t.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?e>=0?"":"Numerator negative":r.messages[t]}),r.messages.some(e=>""==e)?(i.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?null!=e?"":"Denominator missing":r.messages[t]}),r.messages.some(e=>""==e)?(i.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?isNaN(e)?"Denominator is not a number":"":r.messages[t]}),r.messages.some(e=>""==e)?(i.forEach((e,t)=>{r.messages[t]=""===r.messages[t]?e>=0?"":"Denominator negative":r.messages[t]}),r.messages.some(e=>""==e)?("PR"!==n||(i.forEach((e,i)=>{r.messages[i]=""===r.messages[i]?e>=t[i]?"":"Denominator < numerator":r.messages[i]}),r.messages.some(e=>""==e))||(r.status=1,r.error="All denominators are smaller than numerators!"),r):(r.status=1,r.error="All denominators are negative!",r)):(r.status=1,r.error="All denominators are not numbers!",r)):(r.status=1,r.error="All denominators missing or null!",r)):(r.status=1,r.error="All numerators are negative!",r)):(r.status=1,r.error="All numerators are not numbers!",r)):(r.status=1,r.error="All numerators are missing or null!",r)):(r.status=1,r.error="All Groups/IDs are missing or null!",r)}(s,o,a,r.funnel.chart_type);if(0!==h.status)return{keys:null,id:null,numerators:null,denominators:null,highlights:null,anyHighlights:null,categories:null,scatter_formatting:null,label_formatting:null,tooltips:null,labels:null,anyLabels:!1,warningMessage:h.error,validationStatus:h};const f=new Array,m=new Array,g=new Array,y=e.categories[0].source.displayName,v=t.validationStatus.messages;let b=0;for(let e=0;e<o.length;e++)""===h.messages[e]?(f.push(e),m.push({x:b,id:e,label:s[e]}),b+=1,v[e].length>0&&v[e].forEach(t=>{g.push(`Conditional formatting for ${y} ${s[e]} ignored due to: ${t}.`)})):g.push(`${y} ${s[e]} removed due to: ${h.messages[e]}.`);const _=Tn(l,f);return{keys:m,id:f,numerators:Tn(o,f),denominators:Tn(a,f),tooltips:Tn(c,f),labels:_,anyLabels:_.filter(e=>!mn(e)&&""!==e).length>0,highlights:Tn(d,f),anyHighlights:null!=d,categories:e.categories[0],scatter_formatting:Tn(u,f),label_formatting:Tn(p,f),warningMessage:g.length>0?g.join("\n"):"",validationStatus:h}}(e.dataViews[0].categorical,this.inputSettings),0===this.inputData.validationStatus.status&&(this.chartBase=new Br[i](this.inputData,this.inputSettings),this.calculatedLimits=this.chartBase.getLimits(),this.scaleAndTruncateLimits(),this.initialisePlotData(t),this.initialiseGroupedLines())}return this.firstRun=!1,0!==this.inputData.validationStatus.status?(n.status=!1,n.error=this.inputData.validationStatus.error,n):(""!==this.inputData.warningMessage&&(n.warning=this.inputData.warningMessage),n)}initialisePlotData(e){var t,i;this.plotPoints=new Array;const n=wn(this.inputSettings.settings.funnel.transformation),r=this.inputSettings.derivedSettings.multiplier,o=this.inputSettings.settings.outliers.two_sigma,a=this.inputSettings.settings.outliers.three_sigma;for(let s=0;s<this.inputData.id.length;s++){const l=this.inputData.id[s],u=this.inputData.numerators[s],p=this.inputData.denominators[s],c=n(u/p*r),d=this.calculatedLimits.filter(e=>e.denominators===p&&null!==e.ll99&&null!==e.ul99)[0],h=this.inputData.scatter_formatting[s];this.colourPalette.isHighContrast&&(h.colour=this.colourPalette.foregroundColour);const f={process_flag_type:this.inputSettings.settings.outliers.process_flag_type,improvement_direction:this.inputSettings.settings.outliers.improvement_direction},m=Cn(o?Xr(c,d):"none",f),g=Cn(a?Wr(c,d):"none",f),y="number"==typeof this.inputData.categories.values[l]?this.inputData.categories.values[l].toString():this.inputData.categories.values[l];"none"!==m&&(h.colour=this.inputSettings.settings.outliers["two_sigma_colour_"+m],h.colour_outline=this.inputSettings.settings.outliers["two_sigma_colour_"+m],h.scatter_text_colour=h.colour),"none"!==g&&(h.colour=this.inputSettings.settings.outliers["three_sigma_colour_"+g],h.colour_outline=this.inputSettings.settings.outliers["three_sigma_colour_"+g],h.scatter_text_colour=h.colour),this.plotPoints.push({x:p,numerator:u,value:c,group_text:y,aesthetics:h,identity:e.createSelectionIdBuilder().withCategory(this.inputData.categories,l).createSelectionId(),highlighted:null!=(null===(t=this.inputData.highlights)||void 0===t?void 0:t[s]),tooltip:xn(s,this.calculatedLimits,{two_sigma:"none"!==m,three_sigma:"none"!==g},this.inputData,this.inputSettings.settings,this.inputSettings.derivedSettings),label:{text_value:null===(i=this.inputData.labels)||void 0===i?void 0:i[s],aesthetics:this.inputData.label_formatting[s],angle:null,distance:null,line_offset:null,marker_offset:null},two_sigma:m,three_sigma:g})}}initialiseGroupedLines(){const e=new Array;this.inputSettings.settings.lines.show_target&&e.push("target"),this.inputSettings.settings.lines.show_alt_target&&e.push("alt_target"),this.inputSettings.settings.lines.show_99&&e.push("ll99","ul99"),this.inputSettings.settings.lines.show_95&&e.push("ll95","ul95"),this.inputSettings.settings.lines.show_68&&e.push("ll68","ul68");const t=new Array;this.calculatedLimits.forEach(i=>{e.forEach(e=>{t.push({x:i.denominators,line_value:null==i?void 0:i[e],group:e})})}),this.groupedLines=function(e){var t;const i=new Map;for(let n=0;n<e.length;n++){const r=e[n],o=r.group;i.has(o)||i.set(o,[]),null===(t=i.get(o))||void 0===t||t.push(r)}return Array.from(i)}(t)}scaleAndTruncateLimits(){const e=this.inputSettings.derivedSettings.multiplier,t=wn(this.inputSettings.settings.funnel.transformation),i={lower:this.inputSettings.settings.funnel.ll_truncate,upper:this.inputSettings.settings.funnel.ul_truncate};this.calculatedLimits.forEach(n=>{["target","ll99","ll95","ll68","ul68","ul95","ul99"].forEach(r=>{n[r]=jn(t(Nn(n[r],e)),i)})})}}var Jr,Zr,Qr,eo,to,io,no,ro,oo,ao,so,lo,uo,po,co,ho,fo,mo,go,yo,vo,bo,_o,No,wo,xo,Eo,Mo,So,Io,To,Ao,$o,Po,ko,Lo,Do,Ro,Vo,Oo,Fo,Co,jo,Uo,zo,qo,Go,Yo,Ho,Bo,Xo,Wo,Ko,Jo,Zo,Qo,ea,ta,ia,na,ra,oa,aa,sa,la,ua,pa,ca,da,ha,fa,ma,ga,ya,va,ba,_a,Na,wa,xa,Ea,Ma,Sa,Ia,Ta,Aa,$a,Pa,ka,La,Da,Ra,Va,Oa={},Fa={exports:{}};function Ca(){if(Zr)return Jr;Zr=1;const e=Number.MAX_SAFE_INTEGER||9007199254740991;return Jr={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}}function ja(){if(eo)return Qr;eo=1;const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};return Qr=e}function Ua(){return to||(to=1,function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:r}=Ca(),o=ja(),a=(t=e.exports={}).re=[],s=t.safeRe=[],l=t.src=[],u=t.t={};let p=0;const c="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",r],[c,n]],h=(e,t,i)=>{const n=(e=>{for(const[t,i]of d)e=e.split(`${t}*`).join(`${t}{0,${i}}`).split(`${t}+`).join(`${t}{1,${i}}`);return e})(t),r=p++;o(e,r,t),u[e]=r,l[r]=t,a[r]=new RegExp(t,i?"g":void 0),s[r]=new RegExp(n,i?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","\\d+"),h("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${c}*`),h("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER",`${c}+`),h("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),h("FULL",`^${l[u.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),h("LOOSE",`^${l[u.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),h("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),h("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),h("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),h("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?`+`(?:${l[u.BUILD]})?(?:$|[^\\d])`),h("COERCERTL",l[u.COERCE],!0),h("COERCERTLFULL",l[u.COERCEFULL],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Fa,Fa.exports)),Fa.exports}function za(){if(no)return io;no=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return io=i=>i?"object"!=typeof i?e:i:t}function qa(){if(oo)return ro;oo=1;const e=/^[0-9]+$/,t=(t,i)=>{const n=e.test(t),r=e.test(i);return n&&r&&(t=+t,i=+i),t===i?0:n&&!r?-1:r&&!n?1:t<i?-1:1};return ro={compareIdentifiers:t,rcompareIdentifiers:(e,i)=>t(i,e)},ro}function Ga(){if(so)return ao;so=1;const e=ja(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:i}=Ca(),{safeRe:n,t:r}=Ua(),o=za(),{compareIdentifiers:a}=qa();class s{constructor(a,l){if(l=o(l),a instanceof s){if(a.loose===!!l.loose&&a.includePrerelease===!!l.includePrerelease)return a;a=a.version}else if("string"!=typeof a)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof a}".`);if(a.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",a,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const u=a.trim().match(l.loose?n[r.LOOSE]:n[r.FULL]);if(!u)throw new TypeError(`Invalid Version: ${a}`);if(this.raw=a,this.major=+u[1],this.minor=+u[2],this.patch=+u[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");u[4]?this.prerelease=u[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e}):this.prerelease=[],this.build=u[5]?u[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(e("SemVer.compare",this.version,this.options,t),!(t instanceof s)){if("string"==typeof t&&t===this.version)return 0;t=new s(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(e){return e instanceof s||(e=new s(e,this.options)),a(this.major,e.major)||a(this.minor,e.minor)||a(this.patch,e.patch)}comparePre(t){if(t instanceof s||(t=new s(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let i=0;do{const n=this.prerelease[i],r=t.prerelease[i];if(e("prerelease compare",i,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return a(n,r)}while(++i)}compareBuild(t){t instanceof s||(t=new s(t,this.options));let i=0;do{const n=this.build[i],r=t.build[i];if(e("prerelease compare",i,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return a(n,r)}while(++i)}inc(e,t,i){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(i)?1:0;if(!t&&!1===i)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===i)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===i&&(n=[t]),0===a(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return ao=s}function Ya(){if(uo)return lo;uo=1;const e=Ga();return lo=(t,i,n=!1)=>{if(t instanceof e)return t;try{return new e(t,i)}catch(e){if(!n)return null;throw e}}}function Ha(){if(To)return Io;To=1;const e=Ga();return Io=(t,i,n)=>new e(t,n).compare(new e(i,n)),Io}function Ba(){if(Do)return Lo;Do=1;const e=Ga();return Lo=(t,i,n)=>{const r=new e(t,n),o=new e(i,n);return r.compare(o)||r.compareBuild(o)},Lo}function Xa(){if(jo)return Co;jo=1;const e=Ha();return Co=(t,i,n)=>e(t,i,n)>0,Co}function Wa(){if(zo)return Uo;zo=1;const e=Ha();return Uo=(t,i,n)=>e(t,i,n)<0,Uo}function Ka(){if(Go)return qo;Go=1;const e=Ha();return qo=(t,i,n)=>0===e(t,i,n),qo}function Ja(){if(Ho)return Yo;Ho=1;const e=Ha();return Yo=(t,i,n)=>0!==e(t,i,n),Yo}function Za(){if(Xo)return Bo;Xo=1;const e=Ha();return Bo=(t,i,n)=>e(t,i,n)>=0,Bo}function Qa(){if(Ko)return Wo;Ko=1;const e=Ha();return Wo=(t,i,n)=>e(t,i,n)<=0,Wo}function es(){if(Zo)return Jo;Zo=1;const e=Ka(),t=Ja(),i=Xa(),n=Za(),r=Wa(),o=Qa();return Jo=(a,s,l,u)=>{switch(s){case"===":return"object"==typeof a&&(a=a.version),"object"==typeof l&&(l=l.version),a===l;case"!==":return"object"==typeof a&&(a=a.version),"object"==typeof l&&(l=l.version),a!==l;case"":case"=":case"==":return e(a,l,u);case"!=":return t(a,l,u);case">":return i(a,l,u);case">=":return n(a,l,u);case"<":return r(a,l,u);case"<=":return o(a,l,u);default:throw new TypeError(`Invalid operator: ${s}`)}},Jo}function ts(){if(la)return sa;la=1;class e{constructor(t,i){if(i=n(i),t instanceof e)return t.loose===!!i.loose&&t.includePrerelease===!!i.includePrerelease?t:new e(t.raw,i);if(t instanceof r)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=i,this.loose=!!i.loose,this.includePrerelease=!!i.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!f(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&m(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&d)|(this.options.loose&&h))+":"+e,n=i.get(t);if(n)return n;const a=this.options.loose,m=a?s[l.HYPHENRANGELOOSE]:s[l.HYPHENRANGE];e=e.replace(m,I(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(s[l.COMPARATORTRIM],u),o("comparator trim",e),e=e.replace(s[l.TILDETRIM],p),o("tilde trim",e),e=e.replace(s[l.CARETTRIM],c),o("caret trim",e);let g=e.split(" ").map(e=>y(e,this.options)).join(" ").split(/\s+/).map(e=>S(e,this.options));a&&(g=g.filter(e=>(o("loose invalid filter",e,this.options),!!e.match(s[l.COMPARATORLOOSE])))),o("range list",g);const v=new Map,b=g.map(e=>new r(e,this.options));for(const e of b){if(f(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const _=[...v.values()];return i.set(t,_),_}intersects(t,i){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some(e=>g(e,i)&&t.set.some(t=>g(t,i)&&e.every(e=>t.every(t=>e.intersects(t,i)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new a(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(T(this.set[t],e,this.options))return!0;return!1}}sa=e;const t=function(){if(aa)return oa;aa=1;const e=function(){if(ra)return na;function e(t){var i=this;if(i instanceof e||(i=new e),i.tail=null,i.head=null,i.length=0,t&&"function"==typeof t.forEach)t.forEach(function(e){i.push(e)});else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)i.push(arguments[n]);return i}function t(e,t,i){var n=t===e.head?new r(i,null,t,e):new r(i,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function i(e,t){e.tail=new r(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function n(e,t){e.head=new r(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function r(e,t,i,n){if(!(this instanceof r))return new r(e,t,i,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}ra=1,na=e,e.Node=r,e.create=e,e.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,i=e.prev;return t&&(t.prev=i),i&&(i.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=i),e.list.length--,e.next=null,e.prev=null,e.list=null,t},e.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},e.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},e.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},e.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)n(this,arguments[e]);return this.length},e.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},e.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},e.prototype.forEach=function(e,t){t=t||this;for(var i=this.head,n=0;null!==i;n++)e.call(t,i.value,n,this),i=i.next},e.prototype.forEachReverse=function(e,t){t=t||this;for(var i=this.tail,n=this.length-1;null!==i;n--)e.call(t,i.value,n,this),i=i.prev},e.prototype.get=function(e){for(var t=0,i=this.head;null!==i&&t<e;t++)i=i.next;if(t===e&&null!==i)return i.value},e.prototype.getReverse=function(e){for(var t=0,i=this.tail;null!==i&&t<e;t++)i=i.prev;if(t===e&&null!==i)return i.value},e.prototype.map=function(t,i){i=i||this;for(var n=new e,r=this.head;null!==r;)n.push(t.call(i,r.value,this)),r=r.next;return n},e.prototype.mapReverse=function(t,i){i=i||this;for(var n=new e,r=this.tail;null!==r;)n.push(t.call(i,r.value,this)),r=r.prev;return n},e.prototype.reduce=function(e,t){var i,n=this.head;if(arguments.length>1)i=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,i=this.head.value}for(var r=0;null!==n;r++)i=e(i,n.value,r),n=n.next;return i},e.prototype.reduceReverse=function(e,t){var i,n=this.tail;if(arguments.length>1)i=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,i=this.tail.value}for(var r=this.length-1;null!==n;r--)i=e(i,n.value,r),n=n.prev;return i},e.prototype.toArray=function(){for(var e=new Array(this.length),t=0,i=this.head;null!==i;t++)e[t]=i.value,i=i.next;return e},e.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,i=this.tail;null!==i;t++)e[t]=i.value,i=i.prev;return e},e.prototype.slice=function(t,i){(i=i||this.length)<0&&(i+=this.length),(t=t||0)<0&&(t+=this.length);var n=new e;if(i<t||i<0)return n;t<0&&(t=0),i>this.length&&(i=this.length);for(var r=0,o=this.head;null!==o&&r<t;r++)o=o.next;for(;null!==o&&r<i;r++,o=o.next)n.push(o.value);return n},e.prototype.sliceReverse=function(t,i){(i=i||this.length)<0&&(i+=this.length),(t=t||0)<0&&(t+=this.length);var n=new e;if(i<t||i<0)return n;t<0&&(t=0),i>this.length&&(i=this.length);for(var r=this.length,o=this.tail;null!==o&&r>i;r--)o=o.prev;for(;null!==o&&r>t;r--,o=o.prev)n.push(o.value);return n},e.prototype.splice=function(e,i,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,o=this.head;null!==o&&r<e;r++)o=o.next;var a=[];for(r=0;o&&r<i;r++)a.push(o.value),o=this.removeNode(o);for(null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev),r=0;r<n.length;r++)o=t(this,o,n[r]);return a},e.prototype.reverse=function(){for(var e=this.head,t=this.tail,i=e;null!==i;i=i.prev){var n=i.prev;i.prev=i.next,i.next=n}return this.head=t,this.tail=e,this};try{(ia?ta:(ia=1,ta=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}))(e)}catch(e){}return na}(),t=Symbol("max"),i=Symbol("length"),n=Symbol("lengthCalculator"),r=Symbol("allowStale"),o=Symbol("maxAge"),a=Symbol("dispose"),s=Symbol("noDisposeOnSet"),l=Symbol("lruList"),u=Symbol("cache"),p=Symbol("updateAgeOnGet"),c=()=>1,d=(e,t,i)=>{const n=e[u].get(t);if(n){const t=n.value;if(h(e,t)){if(m(e,n),!e[r])return}else i&&(e[p]&&(n.value.now=Date.now()),e[l].unshiftNode(n));return t.value}},h=(e,t)=>{if(!t||!t.maxAge&&!e[o])return!1;const i=Date.now()-t.now;return t.maxAge?i>t.maxAge:e[o]&&i>e[o]},f=e=>{if(e[i]>e[t])for(let n=e[l].tail;e[i]>e[t]&&null!==n;){const t=n.prev;m(e,n),n=t}},m=(e,t)=>{if(t){const n=t.value;e[a]&&e[a](n.key,n.value),e[i]-=n.length,e[u].delete(n.key),e[l].removeNode(t)}};class g{constructor(e,t,i,n,r){this.key=e,this.value=t,this.length=i,this.now=n,this.maxAge=r||0}}const y=(e,t,i,n)=>{let o=i.value;h(e,o)&&(m(e,i),e[r]||(o=void 0)),o&&t.call(n,o.value,o.key,e)};return oa=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[t]=e.max||1/0;const i=e.length||c;if(this[n]="function"!=typeof i?c:i,this[r]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[o]=e.maxAge||0,this[a]=e.dispose,this[s]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[t]=e||1/0,f(this)}get max(){return this[t]}set allowStale(e){this[r]=!!e}get allowStale(){return this[r]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[o]=e,f(this)}get maxAge(){return this[o]}set lengthCalculator(e){"function"!=typeof e&&(e=c),e!==this[n]&&(this[n]=e,this[i]=0,this[l].forEach(e=>{e.length=this[n](e.value,e.key),this[i]+=e.length})),f(this)}get lengthCalculator(){return this[n]}get length(){return this[i]}get itemCount(){return this[l].length}rforEach(e,t){t=t||this;for(let i=this[l].tail;null!==i;){const n=i.prev;y(this,e,i,t),i=n}}forEach(e,t){t=t||this;for(let i=this[l].head;null!==i;){const n=i.next;y(this,e,i,t),i=n}}keys(){return this[l].toArray().map(e=>e.key)}values(){return this[l].toArray().map(e=>e.value)}reset(){this[a]&&this[l]&&this[l].length&&this[l].forEach(e=>this[a](e.key,e.value)),this[u]=new Map,this[l]=new e,this[i]=0}dump(){return this[l].map(e=>!h(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[l]}set(e,r,p){if((p=p||this[o])&&"number"!=typeof p)throw new TypeError("maxAge must be a number");const c=p?Date.now():0,d=this[n](r,e);if(this[u].has(e)){if(d>this[t])return m(this,this[u].get(e)),!1;const n=this[u].get(e).value;return this[a]&&(this[s]||this[a](e,n.value)),n.now=c,n.maxAge=p,n.value=r,this[i]+=d-n.length,n.length=d,this.get(e),f(this),!0}const h=new g(e,r,d,c,p);return h.length>this[t]?(this[a]&&this[a](e,r),!1):(this[i]+=h.length,this[l].unshift(h),this[u].set(e,this[l].head),f(this),!0)}has(e){if(!this[u].has(e))return!1;const t=this[u].get(e).value;return!h(this,t)}get(e){return d(this,e,!0)}peek(e){return d(this,e,!1)}pop(){const e=this[l].tail;return e?(m(this,e),e.value):null}del(e){m(this,this[u].get(e))}load(e){this.reset();const t=Date.now();for(let i=e.length-1;i>=0;i--){const n=e[i],r=n.e||0;if(0===r)this.set(n.k,n.v);else{const e=r-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[u].forEach((e,t)=>d(this,t,!1))}},oa}(),i=new t({max:1e3}),n=za(),r=is(),o=ja(),a=Ga(),{safeRe:s,t:l,comparatorTrimReplace:u,tildeTrimReplace:p,caretTrimReplace:c}=Ua(),{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:h}=Ca(),f=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,g=(e,t)=>{let i=!0;const n=e.slice();let r=n.pop();for(;i&&n.length;)i=n.every(e=>r.intersects(e,t)),r=n.pop();return i},y=(e,t)=>(o("comp",e,t),e=N(e,t),o("caret",e),e=b(e,t),o("tildes",e),e=x(e,t),o("xrange",e),e=M(e,t),o("stars",e),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map(e=>_(e,t)).join(" "),_=(e,t)=>{const i=t.loose?s[l.TILDELOOSE]:s[l.TILDE];return e.replace(i,(t,i,n,r,a)=>{let s;return o("tilde",e,t,i,n,r,a),v(i)?s="":v(n)?s=`>=${i}.0.0 <${+i+1}.0.0-0`:v(r)?s=`>=${i}.${n}.0 <${i}.${+n+1}.0-0`:a?(o("replaceTilde pr",a),s=`>=${i}.${n}.${r}-${a} <${i}.${+n+1}.0-0`):s=`>=${i}.${n}.${r} <${i}.${+n+1}.0-0`,o("tilde return",s),s})},N=(e,t)=>e.trim().split(/\s+/).map(e=>w(e,t)).join(" "),w=(e,t)=>{o("caret",e,t);const i=t.loose?s[l.CARETLOOSE]:s[l.CARET],n=t.includePrerelease?"-0":"";return e.replace(i,(t,i,r,a,s)=>{let l;return o("caret",e,t,i,r,a,s),v(i)?l="":v(r)?l=`>=${i}.0.0${n} <${+i+1}.0.0-0`:v(a)?l="0"===i?`>=${i}.${r}.0${n} <${i}.${+r+1}.0-0`:`>=${i}.${r}.0${n} <${+i+1}.0.0-0`:s?(o("replaceCaret pr",s),l="0"===i?"0"===r?`>=${i}.${r}.${a}-${s} <${i}.${r}.${+a+1}-0`:`>=${i}.${r}.${a}-${s} <${i}.${+r+1}.0-0`:`>=${i}.${r}.${a}-${s} <${+i+1}.0.0-0`):(o("no pr"),l="0"===i?"0"===r?`>=${i}.${r}.${a}${n} <${i}.${r}.${+a+1}-0`:`>=${i}.${r}.${a}${n} <${i}.${+r+1}.0-0`:`>=${i}.${r}.${a} <${+i+1}.0.0-0`),o("caret return",l),l})},x=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map(e=>E(e,t)).join(" ")),E=(e,t)=>{e=e.trim();const i=t.loose?s[l.XRANGELOOSE]:s[l.XRANGE];return e.replace(i,(i,n,r,a,s,l)=>{o("xRange",e,i,n,r,a,s,l);const u=v(r),p=u||v(a),c=p||v(s),d=c;return"="===n&&d&&(n=""),l=t.includePrerelease?"-0":"",u?i=">"===n||"<"===n?"<0.0.0-0":"*":n&&d?(p&&(a=0),s=0,">"===n?(n=">=",p?(r=+r+1,a=0,s=0):(a=+a+1,s=0)):"<="===n&&(n="<",p?r=+r+1:a=+a+1),"<"===n&&(l="-0"),i=`${n+r}.${a}.${s}${l}`):p?i=`>=${r}.0.0${l} <${+r+1}.0.0-0`:c&&(i=`>=${r}.${a}.0${l} <${r}.${+a+1}.0-0`),o("xRange return",i),i})},M=(e,t)=>(o("replaceStars",e,t),e.trim().replace(s[l.STAR],"")),S=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(s[t.includePrerelease?l.GTE0PRE:l.GTE0],"")),I=e=>(t,i,n,r,o,a,s,l,u,p,c,d,h)=>`${i=v(n)?"":v(r)?`>=${n}.0.0${e?"-0":""}`:v(o)?`>=${n}.${r}.0${e?"-0":""}`:a?`>=${i}`:`>=${i}${e?"-0":""}`} ${l=v(u)?"":v(p)?`<${+u+1}.0.0-0`:v(c)?`<${u}.${+p+1}.0-0`:d?`<=${u}.${p}.${c}-${d}`:e?`<${u}.${p}.${+c+1}-0`:`<=${l}`}`.trim(),T=(e,t,i)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(let i=0;i<e.length;i++)if(o(e[i].semver),e[i].semver!==r.ANY&&e[i].semver.prerelease.length>0){const n=e[i].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0};return sa}function is(){if(pa)return ua;pa=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(n,r){if(r=i(r),n instanceof t){if(n.loose===!!r.loose)return n;n=n.value}n=n.trim().split(/\s+/).join(" "),a("comparator",n,r),this.options=r,this.loose=!!r.loose,this.parse(n),this.semver===e?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(t){const i=this.options.loose?n[r.COMPARATORLOOSE]:n[r.COMPARATOR],o=t.match(i);if(!o)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==o[1]?o[1]:"","="===this.operator&&(this.operator=""),o[2]?this.semver=new s(o[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(a("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new s(t,this.options)}catch(e){return!1}return o(t,this.operator,this.semver,this.options)}intersects(e,n){if(!(e instanceof t))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new l(e.value,n).test(this.value):""===e.operator?""===e.value||new l(this.value,n).test(e.semver):!((n=i(n)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!n.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(o(this.semver,"<",e.semver,n)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(o(this.semver,">",e.semver,n)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}ua=t;const i=za(),{safeRe:n,t:r}=Ua(),o=es(),a=ja(),s=Ga(),l=ts();return ua}function ns(){if(da)return ca;da=1;const e=ts();return ca=(t,i,n)=>{try{i=new e(i,n)}catch(e){return!1}return i.test(t)},ca}function rs(){if(wa)return Na;wa=1;const e=ts();return Na=(t,i)=>{try{return new e(t,i).range||"*"}catch(e){return null}},Na}function os(){if(Ea)return xa;Ea=1;const e=Ga(),t=is(),{ANY:i}=t,n=ts(),r=ns(),o=Xa(),a=Wa(),s=Qa(),l=Za();return xa=(u,p,c,d)=>{let h,f,m,g,y;switch(u=new e(u,d),p=new n(p,d),c){case">":h=o,f=s,m=a,g=">",y=">=";break;case"<":h=a,f=l,m=o,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(r(u,p,d))return!1;for(let e=0;e<p.set.length;++e){const n=p.set[e];let r=null,o=null;if(n.forEach(e=>{e.semver===i&&(e=new t(">=0.0.0")),r=r||e,o=o||e,h(e.semver,r.semver,d)?r=e:m(e.semver,o.semver,d)&&(o=e)}),r.operator===g||r.operator===y)return!1;if((!o.operator||o.operator===g)&&f(u,o.semver))return!1;if(o.operator===y&&m(u,o.semver))return!1}return!0},xa}function as(){if(Va)return Ra;Va=1;const e=Ua(),t=Ca(),i=Ga(),n=qa(),r=Ya(),o=function(){if(co)return po;co=1;const e=Ya();return po=(t,i)=>{const n=e(t,i);return n?n.version:null}}(),a=function(){if(fo)return ho;fo=1;const e=Ya();return ho=(t,i)=>{const n=e(t.trim().replace(/^[=v]+/,""),i);return n?n.version:null},ho}(),s=function(){if(go)return mo;go=1;const e=Ga();return mo=(t,i,n,r,o)=>{"string"==typeof n&&(o=r,r=n,n=void 0);try{return new e(t instanceof e?t.version:t,n).inc(i,r,o).version}catch(e){return null}}}(),l=function(){if(vo)return yo;vo=1;const e=Ya();return yo=(t,i)=>{const n=e(t,null,!0),r=e(i,null,!0),o=n.compare(r);if(0===o)return null;const a=o>0,s=a?n:r,l=a?r:n,u=!!s.prerelease.length;if(l.prerelease.length&&!u)return l.patch||l.minor?s.patch?"patch":s.minor?"minor":"major":"major";const p=u?"pre":"";return n.major!==r.major?p+"major":n.minor!==r.minor?p+"minor":n.patch!==r.patch?p+"patch":"prerelease"}}(),u=function(){if(_o)return bo;_o=1;const e=Ga();return bo=(t,i)=>new e(t,i).major,bo}(),p=function(){if(wo)return No;wo=1;const e=Ga();return No=(t,i)=>new e(t,i).minor,No}(),c=function(){if(Eo)return xo;Eo=1;const e=Ga();return xo=(t,i)=>new e(t,i).patch,xo}(),d=function(){if(So)return Mo;So=1;const e=Ya();return Mo=(t,i)=>{const n=e(t,i);return n&&n.prerelease.length?n.prerelease:null}}(),h=Ha(),f=function(){if($o)return Ao;$o=1;const e=Ha();return Ao=(t,i,n)=>e(i,t,n),Ao}(),m=function(){if(ko)return Po;ko=1;const e=Ha();return Po=(t,i)=>e(t,i,!0),Po}(),g=Ba(),y=function(){if(Vo)return Ro;Vo=1;const e=Ba();return Ro=(t,i)=>t.sort((t,n)=>e(t,n,i)),Ro}(),v=function(){if(Fo)return Oo;Fo=1;const e=Ba();return Oo=(t,i)=>t.sort((t,n)=>e(n,t,i)),Oo}(),b=Xa(),_=Wa(),N=Ka(),w=Ja(),x=Za(),E=Qa(),M=es(),S=function(){if(ea)return Qo;ea=1;const e=Ga(),t=Ya(),{safeRe:i,t:n}=Ua();return Qo=(r,o)=>{if(r instanceof e)return r;if("number"==typeof r&&(r=String(r)),"string"!=typeof r)return null;let a=null;if((o=o||{}).rtl){const e=o.includePrerelease?i[n.COERCERTLFULL]:i[n.COERCERTL];let t;for(;(t=e.exec(r))&&(!a||a.index+a[0].length!==r.length);)a&&t.index+t[0].length===a.index+a[0].length||(a=t),e.lastIndex=t.index+t[1].length+t[2].length;e.lastIndex=-1}else a=r.match(o.includePrerelease?i[n.COERCEFULL]:i[n.COERCE]);if(null===a)return null;const s=a[2],l=a[3]||"0",u=a[4]||"0",p=o.includePrerelease&&a[5]?`-${a[5]}`:"",c=o.includePrerelease&&a[6]?`+${a[6]}`:"";return t(`${s}.${l}.${u}${p}${c}`,o)},Qo}(),I=is(),T=ts(),A=ns(),$=function(){if(fa)return ha;fa=1;const e=ts();return ha=(t,i)=>new e(t,i).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" ")),ha}(),P=function(){if(ga)return ma;ga=1;const e=Ga(),t=ts();return ma=(i,n,r)=>{let o=null,a=null,s=null;try{s=new t(n,r)}catch(e){return null}return i.forEach(t=>{s.test(t)&&(o&&-1!==a.compare(t)||(o=t,a=new e(o,r)))}),o},ma}(),k=function(){if(va)return ya;va=1;const e=Ga(),t=ts();return ya=(i,n,r)=>{let o=null,a=null,s=null;try{s=new t(n,r)}catch(e){return null}return i.forEach(t=>{s.test(t)&&(o&&1!==a.compare(t)||(o=t,a=new e(o,r)))}),o},ya}(),L=function(){if(_a)return ba;_a=1;const e=Ga(),t=ts(),i=Xa();return ba=(n,r)=>{n=new t(n,r);let o=new e("0.0.0");if(n.test(o))return o;if(o=new e("0.0.0-0"),n.test(o))return o;o=null;for(let t=0;t<n.set.length;++t){const r=n.set[t];let a=null;r.forEach(t=>{const n=new e(t.semver.version);switch(t.operator){case">":0===n.prerelease.length?n.patch++:n.prerelease.push(0),n.raw=n.format();case"":case">=":a&&!i(n,a)||(a=n);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}}),!a||o&&!i(o,a)||(o=a)}return o&&n.test(o)?o:null},ba}(),D=rs(),R=os(),V=function(){if(Sa)return Ma;Sa=1;const e=os();return Ma=(t,i,n)=>e(t,i,">",n),Ma}(),O=function(){if(Ta)return Ia;Ta=1;const e=os();return Ia=(t,i,n)=>e(t,i,"<",n),Ia}(),F=function(){if($a)return Aa;$a=1;const e=ts();return Aa=(t,i,n)=>(t=new e(t,n),i=new e(i,n),t.intersects(i,n))}(),C=function(){if(ka)return Pa;ka=1;const e=ns(),t=Ha();return Pa=(i,n,r)=>{const o=[];let a=null,s=null;const l=i.sort((e,i)=>t(e,i,r));for(const t of l)e(t,n,r)?(s=t,a||(a=t)):(s&&o.push([a,s]),s=null,a=null);a&&o.push([a,null]);const u=[];for(const[e,t]of o)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");const p=u.join(" || "),c="string"==typeof n.raw?n.raw:String(n);return p.length<c.length?p:n},Pa}(),j=function(){if(Da)return La;Da=1;const e=ts(),t=is(),{ANY:i}=t,n=ns(),r=Ha(),o=[new t(">=0.0.0-0")],a=[new t(">=0.0.0")],s=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i){if(1===t.length&&t[0].semver===i)return!0;e=s.includePrerelease?o:a}if(1===t.length&&t[0].semver===i){if(s.includePrerelease)return!0;t=a}const p=new Set;let c,d,h,f,m,g,y;for(const t of e)">"===t.operator||">="===t.operator?c=l(c,t,s):"<"===t.operator||"<="===t.operator?d=u(d,t,s):p.add(t.semver);if(p.size>1)return null;if(c&&d){if(h=r(c.semver,d.semver,s),h>0)return null;if(0===h&&(">="!==c.operator||"<="!==d.operator))return null}for(const e of p){if(c&&!n(e,String(c),s))return null;if(d&&!n(e,String(d),s))return null;for(const i of t)if(!n(e,String(i),s))return!1;return!0}let v=!(!d||s.includePrerelease||!d.semver.prerelease.length)&&d.semver,b=!(!c||s.includePrerelease||!c.semver.prerelease.length)&&c.semver;v&&1===v.prerelease.length&&"<"===d.operator&&0===v.prerelease[0]&&(v=!1);for(const e of t){if(y=y||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,c)if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if(f=l(c,e,s),f===e&&f!==c)return!1}else if(">="===c.operator&&!n(c.semver,String(e),s))return!1;if(d)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if(m=u(d,e,s),m===e&&m!==d)return!1}else if("<="===d.operator&&!n(d.semver,String(e),s))return!1;if(!e.operator&&(d||c)&&0!==h)return!1}return!(c&&g&&!d&&0!==h||d&&y&&!c&&0!==h||b||v)},l=(e,t,i)=>{if(!e)return t;const n=r(e.semver,t.semver,i);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},u=(e,t,i)=>{if(!e)return t;const n=r(e.semver,t.semver,i);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};return La=(t,i,n={})=>{if(t===i)return!0;t=new e(t,n),i=new e(i,n);let r=!1;e:for(const e of t.set){for(const t of i.set){const i=s(e,t,n);if(r=r||null!==i,i)continue e}if(r)return!1}return!0}}();return Ra={parse:r,valid:o,clean:a,inc:s,diff:l,major:u,minor:p,patch:c,prerelease:d,compare:h,rcompare:f,compareLoose:m,compareBuild:g,sort:y,rsort:v,gt:b,lt:_,eq:N,neq:w,gte:x,lte:E,cmp:M,coerce:S,Comparator:I,Range:T,satisfies:A,toComparators:$,maxSatisfying:P,minSatisfying:k,minVersion:L,validRange:D,outside:R,gtr:V,ltr:O,intersects:F,simplifyRange:C,subset:j,SemVer:i,re:e.re,src:e.src,tokens:e.t,SEMVER_SPEC_VERSION:t.SEMVER_SPEC_VERSION,RELEASE_TYPES:t.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers}}var ss,ls={type:"object",properties:{privileges:{type:"array",description:"Defines required privileges for the visual",items:{$ref:"#/definitions/privilege"}},dataRoles:{type:"array",description:"Defines data roles for the visual",items:{$ref:"#/definitions/dataRole"}},dataViewMappings:{type:"array",description:"Defines data mappings for the visual",items:{$ref:"#/definitions/dataViewMapping"}},objects:{$ref:"#/definitions/objects"},tooltips:{$ref:"#/definitions/tooltips"},sorting:{$ref:"#/definitions/sorting"},drilldown:{$ref:"#/definitions/drilldown"},expandCollapse:{$ref:"#/definitions/expandCollapse"},suppressDefaultTitle:{type:"boolean",description:"Indicates whether the visual should show a default title"},supportsKeyboardFocus:{type:"boolean",description:"Allows the visual to receive focus through keyboard navigation"},supportsHighlight:{type:"boolean",description:"Tells the host to include highlight data"},supportsSynchronizingFilterState:{type:"boolean",description:"Indicates whether the visual supports synchronization across report pages (for slicer visuals only)"},advancedEditModeSupport:{type:"number",description:"Indicates the action requested from the host when this visual enters Advanced Edit mode."},supportsLandingPage:{type:"boolean",description:"Indicates whether the visual supports a landing page"},supportsEmptyDataView:{type:"boolean",description:"Indicates whether the visual can receive formatting pane properties when it has no dataroles"},supportsMultiVisualSelection:{type:"boolean",description:"Indicates whether the visual supports multi selection"},subtotals:{description:"Specifies the subtotal customizations applied in the customizeQuery method",$ref:"#/definitions/subtotals"},migration:{$ref:"#/definitions/migration"},keepAllMetadataColumns:{type:"boolean",description:"Indicates that visual is going to receive all metadata columns, no matter what the active projections are"}},required:["privileges"],additionalProperties:!1,definitions:{privilege:{type:"object",description:"privilege - Defines the name, essentiality, and optional parameters for a privilege",properties:{name:{type:"string",description:"The internal name of the privilege",enum:["WebAccess","LocalStorage","ExportContent"]},essential:{type:"boolean",description:"Determines if the privilege is essential for the visual. Default value is false"},parameters:{type:"array",description:"Determines a list of privilege parameters if any",items:{type:"string",description:"The privilege parameter"}}},required:["name"]},dataRole:{type:"object",description:"dataRole - Defines the name, displayName, and kind of a data role",properties:{name:{type:"string",description:"The internal name for this data role used for all references to this role"},displayName:{type:"string",description:"The name of this data role that is shown to the user"},displayNameKey:{type:"string",description:"The localization key for the displayed name in the stringResourced file"},kind:{description:"The kind of data that can be bound do this role",$ref:"#/definitions/dataRole.kind"},description:{type:"string",description:"A description of this role shown to the user as a tooltip"},descriptionKey:{type:"string",description:"The localization key for the description in the stringResourced file"},preferredTypes:{type:"array",description:"Defines the preferred type of data for this data role",items:{$ref:"#/definitions/valueType"}},requiredTypes:{type:"array",description:"Defines the required type of data for this data role. Any values that do not match will be set to null",items:{$ref:"#/definitions/valueType"}}},required:["name","displayName","kind"],additionalProperties:!1},dataViewMapping:{type:"object",description:"dataMapping - Defines how data is mapped to data roles",properties:{conditions:{type:"array",description:"List of conditions that must be met for this data mapping",items:{type:"object",description:"condition - Defines conditions for a data mapping (each key needs to be a valid data role)",patternProperties:{"^[\\w\\s-]+$":{description:"Specifies the number of values that can be assigned to this data role in this mapping",$ref:"#/definitions/dataViewMapping.numberRangeWithKind"}},additionalProperties:!1}},single:{$ref:"#/definitions/dataViewMapping.single"},categorical:{$ref:"#/definitions/dataViewMapping.categorical"},table:{$ref:"#/definitions/dataViewMapping.table"},matrix:{$ref:"#/definitions/dataViewMapping.matrix"},scriptResult:{$ref:"#/definitions/dataViewMapping.scriptResult"}},anyOf:[{required:["single"]},{required:["categorical"]},{required:["table"]},{required:["matrix"]},{required:["scriptResult"]}],additionalProperties:!1},"dataViewMapping.single":{type:"object",description:"single - Defines a single data mapping",properties:{role:{type:"string",description:"The data role to bind to this mapping"}},required:["role"],additionalProperties:!1},"dataViewMapping.categorical":{type:"object",description:"categorical - Defines a categorical data mapping",properties:{categories:{type:"object",description:"Defines data roles to be used as categories",properties:{bind:{$ref:"#/definitions/dataViewMapping.bindTo"},for:{$ref:"#/definitions/dataViewMapping.forIn"},select:{$ref:"#/definitions/dataViewMapping.select"},dataReductionAlgorithm:{$ref:"#/definitions/dataViewMapping.dataReductionAlgorithm"}},oneOf:[{required:["for"]},{required:["bind"]},{required:["select"]}]},values:{type:"object",description:"Defines data roles to be used as values",properties:{bind:{$ref:"#/definitions/dataViewMapping.bindTo"},for:{$ref:"#/definitions/dataViewMapping.forIn"},select:{$ref:"#/definitions/dataViewMapping.select"},group:{type:"object",description:"Groups on a a specific data role",properties:{by:{description:"Specifies a data role to use for grouping",type:"string"},select:{$ref:"#/definitions/dataViewMapping.select"},dataReductionAlgorithm:{$ref:"#/definitions/dataViewMapping.dataReductionAlgorithm"}},required:["by","select"]}},oneOf:[{required:["for"]},{required:["bind"]},{required:["select"]},{required:["group"]}]},dataVolume:{$ref:"#/definitions/dataViewMapping.dataVolume"}},additionalProperties:!1},"dataViewMapping.table":{type:"object",description:"table - Defines a table data mapping",properties:{rows:{type:"object",description:"Rows to use for the table",properties:{bind:{$ref:"#/definitions/dataViewMapping.bindTo"},for:{$ref:"#/definitions/dataViewMapping.forIn"},select:{$ref:"#/definitions/dataViewMapping.select"},dataReductionAlgorithm:{$ref:"#/definitions/dataViewMapping.dataReductionAlgorithm"}},oneOf:[{required:["for"]},{required:["bind"]},{required:["select"]}]},rowCount:{type:"object",description:"Specifies a constraint on the number of data rows supported by the visual",properties:{preferred:{description:"Specifies a preferred range of values for the constraint",$ref:"#/definitions/dataViewMapping.numberRange"},supported:{description:"Specifies a supported range of values for the constraint. Defaults to preferred if not specified.",$ref:"#/definitions/dataViewMapping.numberRange"}}},dataVolume:{$ref:"#/definitions/dataViewMapping.dataVolume"}},requires:["rows"]},"dataViewMapping.matrix":{type:"object",description:"matrix - Defines a matrix data mapping",properties:{rows:{type:"object",description:"Defines the rows used for the matrix",properties:{for:{$ref:"#/definitions/dataViewMapping.forIn"},select:{$ref:"#/definitions/dataViewMapping.select"},dataReductionAlgorithm:{$ref:"#/definitions/dataViewMapping.dataReductionAlgorithm"}},oneOf:[{required:["for"]},{required:["select"]}]},columns:{type:"object",description:"Defines the columns used for the matrix",properties:{for:{$ref:"#/definitions/dataViewMapping.forIn"},dataReductionAlgorithm:{$ref:"#/definitions/dataViewMapping.dataReductionAlgorithm"}},required:["for"]},values:{type:"object",description:"Defines the values used for the matrix",properties:{for:{$ref:"#/definitions/dataViewMapping.forIn"},select:{$ref:"#/definitions/dataViewMapping.select"}},oneOf:[{required:["for"]},{required:["select"]}]},dataVolume:{$ref:"#/definitions/dataViewMapping.dataVolume"}}},"dataViewMapping.scriptResult":{type:"object",description:"scriptResult - Defines a scriptResult data mapping",properties:{dataInput:{type:"object",description:"dataInput - Defines how data is mapped to data roles",properties:{table:{$ref:"#/definitions/dataViewMapping.table"}}},script:{type:"object",description:"script - Defines where the script text and provider are stored",properties:{scriptSourceDefault:{type:"string",description:"scriptSourceDefault - Defines the default script source value to be used when no script object is defined"},scriptProviderDefault:{type:"string",description:"scriptProviderDefault - Defines the default script provider value to be used when no provider object is defined"},scriptOutputType:{type:"string",description:"scriptOutputType - Defines the output type that the R script will generate"},source:{$ref:"#/definitions/dataViewObjectPropertyIdentifier"},provider:{$ref:"#/definitions/dataViewObjectPropertyIdentifier"}}}}},dataViewObjectPropertyIdentifier:{type:"object",description:"Points to an object property",properties:{objectName:{type:"string",description:"The name of a object"},propertyName:{type:"string",description:"The name of a property inside the object"}}},"dataViewMapping.bindTo":{type:"object",description:"Binds this data mapping to a single value",properties:{to:{type:"string",description:"The name of a data role to bind to"}},additionalProperties:!1,required:["to"]},"dataViewMapping.numberRange":{type:"object",description:"A number range from min to max",properties:{min:{type:"number",description:"Minimum value supported"},max:{type:"number",description:"Maximum value supported"}}},"dataViewMapping.numberRangeWithKind":{allOf:[{$ref:"#/definitions/dataViewMapping.numberRange"},{properties:{kind:{$ref:"#/definitions/dataRole.kind"}}}]},"dataRole.kind":{type:"string",enum:["Grouping","Measure","GroupingOrMeasure"]},"dataViewMapping.select":{type:"array",description:"Defines a list of properties to bind",items:{type:"object",properties:{bind:{$ref:"#/definitions/dataViewMapping.bindTo"},for:{$ref:"#/definitions/dataViewMapping.forIn"}},oneOf:[{required:["for"]},{required:["bind"]}]}},"dataViewMapping.dataReductionAlgorithm":{type:"object",description:"Describes how to reduce the amount of data exposed to the visual",properties:{top:{type:"object",description:"Reduce the data to the Top count items",properties:{count:{type:"number"}}},bottom:{type:"object",description:"Reduce the data to the Bottom count items",properties:{count:{type:"number"}}},sample:{type:"object",description:"Reduce the data using a simple Sample of count items",properties:{count:{type:"number"}}},window:{type:"object",description:"Allow the data to be loaded one window, containing count items, at a time",properties:{count:{type:"number"}}}},additionalProperties:!1,oneOf:[{required:["top"]},{required:["bottom"]},{required:["sample"]},{required:["window"]}]},"dataViewMapping.dataVolume":{description:"Specifies the volume of data the query should return (1-6)",type:"number",enum:[1,2,3,4,5,6]},"dataViewMapping.forIn":{type:"object",description:"Binds this data mapping for all items in a collection",properties:{in:{type:"string",description:"The name of a data role to iterate over"}},additionalProperties:!1,required:["in"]},objects:{type:"object",description:"A list of unique property groups",patternProperties:{"^[\\w\\s-]+$":{type:"object",description:"Settings for a group of properties",properties:{displayName:{type:"string",description:"The name shown to the user to describe this group of properties"},displayNameKey:{type:"string",description:"The localization key for the displayed name in the stringResourced file"},objectCategory:{type:"number",description:"What aspect of the visual this object controlls (1 = Formatting, 2 = Analytics). Formatting: look & feel, colors, axes, labels etc. Analytics: forcasts, trendlines, reference lines and shapes etc."},description:{type:"string",description:"A description of this object shown to the user as a tooltip"},descriptionKey:{type:"string",description:"The localization key for the description in the stringResourced file"},properties:{type:"object",description:"A list of unique properties contained in this group",patternProperties:{"^[\\w\\s-]+$":{$ref:"#/definitions/object.propertySettings"}},additionalProperties:!1}},additionalProperties:!1}},additionalProperties:!1},tooltips:{type:"object",description:"Instructs the host to include tooltips ability",properties:{supportedTypes:{type:"object",description:"Instructs the host what tooltip types to support",properties:{default:{type:"boolean",description:"Instructs the host to support showing default tooltips"},canvas:{type:"boolean",description:"Instructs the host to support showing canvas tooltips"}}},roles:{type:"array",items:{type:"string",description:"The name of the data role to bind the tooltips selected info to"}},supportEnhancedTooltips:{type:"boolean",description:"Indicates whether the visual support modern tooltip feature"}}},"object.propertySettings":{type:"object",description:"Settings for a property",properties:{displayName:{type:"string",description:"The name shown to the user to describe this property"},displayNameKey:{type:"string",description:"The localization key for the displayed name in the stringResourced file"},description:{type:"string",description:"A description of this property shown to the user as a tooltip"},descriptionKey:{type:"string",description:"The localization key for the description in the stringResourced file"},placeHolderText:{type:"string",description:"Text to display if the field is empty"},placeHolderTextKey:{type:"string",description:"The localization key for the placeHolderText in the stringResources file"},suppressFormatPainterCopy:{type:"boolean",description:"Indicates whether the Format Painter should ignore this property"},type:{description:"Describes what type of property this is and how it should be displayed to the user",$ref:"#/definitions/valueType"},rule:{type:"object",description:"Describes substitution rule that replaces property object, described inside the rule, to current property object that contains this rule",$ref:"#/definitions/substitutionRule"},filterState:{type:"boolean",description:"Indicates whether the property is a part of filtration information"}},additionalProperties:!1},substitutionRule:{type:"object",description:"Describes substitution rule that replaces property object, described inside the rule, to current property object that contains this rule",properties:{inputRole:{type:"string",description:"The name of role. If this role is set, the substitution will be applied"},output:{type:"object",description:"Describes what exactly is necessary to replace",properties:{property:{type:"string",description:"The name of property object that will be replaced"},selector:{type:"array",description:"The array of selector names. Usually, it contains only one selector -- 'Category'",items:{type:"string",description:"The name of selector"}}}}}},sorting:{type:"object",description:"Specifies the default sorting behavior for the visual",properties:{default:{type:"object",additionalProperties:!1},custom:{type:"object",additionalProperties:!1},implicit:{type:"object",description:"implicit sort",properties:{clauses:{type:"array",items:{type:"object",properties:{role:{type:"string"},direction:{type:"number",description:"Determines sort direction (1 = Ascending, 2 = Descending)",enum:[1,2]}},additionalProperties:!1}}},additionalProperties:!1}},additionalProperties:!1,anyOf:[{required:["default"]},{required:["custom"]},{required:["implicit"]}]},drilldown:{type:"object",description:"Defines the visual's drill capability",properties:{roles:{type:"array",description:"The drillable role names for this visual",items:{type:"string",description:"The name of the role"}}}},expandCollapse:{type:"object",description:"Defines the visual's expandCollapse capability",properties:{roles:{type:"array",description:"The expandCollapsed role names for this visual",items:{type:"string",description:"The name of the role"}},addDataViewFlags:{type:"object",description:"The data view flags",defaultValue:{type:"boolean",description:"Indicates if the DataViewTreeNode will contain the isCollapsed flag by default"}},supportsMerge:{type:"boolean",description:"Indicates that the expansion state should be updated when query projections change, instead of being reset."},restoreProjectionsOrderFromBookmark:{type:"boolean",description:"Indicates that the bookmarked expansion state should be restored even if the query projections order no longer matches the expansion state levels."}}},valueType:{type:"object",properties:{bool:{type:"boolean",description:"A boolean value that will be displayed to the user as a toggle switch"},enumeration:{type:"array",description:"A list of values that will be displayed as a drop down list",items:{type:"object",description:"Describes an item in the enumeration list",properties:{displayName:{type:"string",description:"The name shown to the user to describe this item"},displayNameKey:{type:"string",description:"The localization key for the displayed name in the stringResourced file"},value:{type:"string",description:"The internal value of this property when this item is selected"}}}},fill:{type:"object",description:"A color value that will be displayed to the user as a color picker",properties:{solid:{type:"object",description:"A solid color value that will be displayed to the user as a color picker",properties:{color:{oneOf:[{type:"boolean"},{type:"object",properties:{nullable:{description:"Allows the user to select 'no fill' for the color",type:"boolean"}}}]}}}}},fillRule:{type:"object",description:"A color gradient that will be dispalyed to the user as a minimum (,medium) and maximum color pickers",properties:{linearGradient2:{type:"object",description:"Two color gradient",properties:{max:{type:"object",description:"Maximum color for gradient",properties:{color:{type:"string"},value:{type:"number"}}},min:{type:"object",description:"Minimum color for gradient",properties:{color:{type:"string"},value:{type:"number"}}},nullColoringStrategy:{type:"object",description:"Null color strategy"}}},linearGradient3:{type:"object",description:"Three color gradient",properties:{max:{type:"object",description:"Maximum color for gradient",properties:{color:{type:"string"},value:{type:"number"}}},min:{type:"object",description:"Minimum color for gradient",properties:{color:{type:"string"},value:{type:"number"}}},mid:{type:"object",description:"Middle color for gradient",properties:{color:{type:"string"},value:{type:"number"}}},nullColoringStrategy:{type:"object",description:"Null color strategy"}}}}},formatting:{type:"object",description:"A numeric value that will be displayed to the user as a text input",properties:{labelDisplayUnits:{type:"boolean",description:"Displays a dropdown with common display units (Auto, None, Thousands, Millions, Billions, Trillions)"},alignment:{type:"boolean",description:"Displays a selector to allow the user to choose left, center, or right alignment"},fontSize:{type:"boolean",description:"Displays a slider that allows the user to choose a font size in points"},fontFamily:{type:"boolean",description:"Displays a dropdown with font families"},formatString:{type:"boolean",description:"Displays dynamic format string"}},additionalProperties:!1,oneOf:[{required:["labelDisplayUnits"]},{required:["alignment"]},{required:["fontSize"]},{required:["fontFamily"]},{required:["formatString"]}]},integer:{type:"boolean",description:"An integer (whole number) value that will be displayed to the user as a text input"},numeric:{type:"boolean",description:"A numeric value that will be displayed to the user as a text input"},filter:{oneOf:[{type:"boolean"},{type:"object",properties:{selfFilter:{type:"boolean"}}}],description:"A filter"},operations:{type:"object",description:"A visual operation",properties:{searchEnabled:{type:"boolean",description:"Turns search ability on"}}},text:{type:"boolean",description:"A text value that will be displayed to the user as a text input"},scripting:{type:"object",description:"A text value that will be displayed to the user as a script",properties:{source:{type:"boolean",description:"A source code"}}},geography:{type:"object",description:"Geographical data",properties:{address:{type:"boolean"},city:{type:"boolean"},continent:{type:"boolean"},country:{type:"boolean"},county:{type:"boolean"},region:{type:"boolean"},postalCode:{type:"boolean"},stateOrProvince:{type:"boolean"},place:{type:"boolean"},latitude:{type:"boolean"},longitude:{type:"boolean"}}}},additionalProperties:!1,oneOf:[{required:["bool"]},{required:["enumeration"]},{required:["fill"]},{required:["fillRule"]},{required:["formatting"]},{required:["integer"]},{required:["numeric"]},{required:["text"]},{required:["geography"]},{required:["scripting"]},{required:["filter"]},{required:["operations"]}]},subtotals:{type:"object",description:"Specifies the subtotal request customizations applied to the outgoing data query",properties:{matrix:{description:"Defines the subtotal customizations of the outgoing data query of a matrix-dataview visual",$ref:"#/definitions/subtotals.matrix"}},requires:["matrix"]},"subtotals.matrix":{type:"object",description:"Specifies the subtotal customizations of the outgoing data query of a matrix-dataview visual",properties:{rowSubtotals:{type:"object",description:"Indicates if the subtotal data should be requested for all fields in the rows field well",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"boolean"}}},rowSubtotalsPerLevel:{type:"object",description:"Indicates if the subtotal data can be toggled for individual fields in the rows field well",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"boolean"}}},columnSubtotals:{type:"object",description:"Indicates if the subtotal data should be requested for all fields in the columns field well",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"boolean"}}},columnSubtotalsPerLevel:{type:"object",description:"Indicates if the subtotal data can be toggled for individual fields in the columns field well",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"boolean"}}},levelSubtotalEnabled:{type:"object",description:"Unlike all other properites, this property is applied to individual rows/columns. The property indicates if the subtotals are requested for the row/column",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"boolean"}}},rowSubtotalsType:{type:"object",description:"Indicates location of row subtotals locations (Top, Bottom). Top means subtotals located at the start of datasource and calculated even before all datasource rows fetched, Bottom means subtotals located at the end of datasource and shown only after all rows are fetched",properties:{propertyIdentifier:{type:"object",properties:{objectName:{type:"string"},propertyName:{type:"string"}}},defaultValue:{type:"string",enum:["Top","Bottom"]}}}},requires:["matrix"]},migration:{type:"object",description:"Defines the supported APIs for migration",properties:{filter:{$ref:"#/definitions/migration.filter"}}},"migration.filter":{type:"object",description:"Defines the capabilities for migrating the filter API",properties:{shouldUseIdentityFilter:{type:"boolean",description:"Indicates whether the new filter should migrate to an identity filter"}}}}},us={type:"object",properties:{apiVersion:{type:"string",description:"Version of the IVisual API"},author:{type:"object",description:"Information about the author of the visual",properties:{name:{type:"string",description:"Name of the visual author. This is displayed to users."},email:{type:"string",description:"E-mail of the visual author. This is displayed to users for support."}}},assets:{type:"object",description:"Assets used by the visual",properties:{icon:{type:"string",description:"A 20x20 png icon used to represent the visual"}}},externalJS:{type:"array",description:"An array of relative paths to 3rd party javascript libraries to load",items:{type:"string"}},stringResources:{type:"array",description:"An array of relative paths to string resources to load",items:{type:"string"},uniqueItems:!0},style:{type:"string",description:"Relative path to the stylesheet (less) for the visual"},capabilities:{type:"string",description:"Relative path to the visual capabilities json file"},visual:{type:"object",description:"Details about this visual",properties:{description:{type:"string",description:"What does this visual do?"},name:{type:"string",description:"Internal visual name"},displayName:{type:"string",description:"A friendly name"},externals:{type:"array",description:"External files (such as JavaScript) that you would like to include"},guid:{type:"string",description:"Unique identifier for the visual"},visualClassName:{type:"string",description:"Class of your IVisual"},icon:{type:"string",description:"Icon path"},version:{type:"string",description:"Visual version"},gitHubUrl:{type:"string",description:"Url to the github repository for this visual"},supportUrl:{type:"string",description:"Url to the support page for this visual"}}}}},ps={type:"object",properties:{cranPackages:{type:"array",description:"An array of the Cran packages required for the custom R visual script to operate",items:{$ref:"#/definitions/cranPackage"}}},definitions:{cranPackage:{type:"object",description:"cranPackage - Defines the name and displayName of a required Cran package",properties:{name:{type:"string",description:"The name for this Cran package"},displayName:{type:"string",description:"The name for this Cran package that is shown to the user"},url:{type:"string",description:"A url for package documentation in Cran website"}},required:["name","url"],additionalProperties:!1}}},cs={type:"object",properties:{locale:{$ref:"#/definitions/localeOptions"},values:{type:"object",description:"translations for the display name keys in the capabilities",additionalProperties:{type:"string"}}},required:["locale"],definitions:{localeOptions:{description:"Specifies the locale key from a list of supported locales",type:"string",enum:["ar-SA","bg-BG","ca-ES","cs-CZ","da-DK","de-DE","el-GR","en-US","es-ES","et-EE","eu-ES","fi-FI","fr-FR","gl-ES","he-IL","hi-IN","hr-HR","hu-HU","id-ID","it-IT","ja-JP","kk-KZ","ko-KR","lt-LT","lv-LV","ms-MY","nb-NO","nl-NL","pl-PL","pt-BR","pt-PT","ro-RO","ru-RU","sk-SK","sl-SI","sr-Cyrl-RS","sr-Latn-RS","sv-SE","th-TH","tr-TR","uk-UA","vi-VN","zh-CN","zh-TW"]}}};!function(){if(ss)return Oa;ss=1;const e=as();let t="5.1.0",i=`${e.major(t)}.${e.minor(t)}.0`;Oa.version=i,Oa.schemas={capabilities:ls,pbiviz:us,dependencies:ps,stringResources:cs}}();class ds{update(e){const t=e.funnel.chart_type,i=["PR"].includes(t),n=e.funnel.perc_labels;let r,o=e.funnel.multiplier;"Yes"===n&&(o=100),i&&(o=1===o?100:o),r="Automatic"===n?i&&100===o:"Yes"===n,this.multiplier=o,this.percentLabels=r}}class hs{update(e){this.validationStatus=JSON.parse(JSON.stringify({status:0,messages:new Array,error:""})),Object.keys(this.settings).forEach(t=>{const i=Mn(null==e?void 0:e.categorical,t,this.settings);0!==i.validation.status&&(this.validationStatus.status=i.validation.status,this.validationStatus.error=i.validation.error),0===this.validationStatus.messages.length?this.validationStatus.messages=i.validation.messages:i.validation.messages.every(e=>0===e.length)||i.validation.messages.forEach((e,t)=>{e.length>0&&(this.validationStatus.messages[t]=this.validationStatus.messages[t].concat(e))}),Object.keys(this.settings[t]).forEach(e=>{this.settings[t][e]=(null==i?void 0:i.values)?null==i?void 0:i.values[0][e]:hn[t][e].default})}),this.derivedSettings.update(this.settings)}getFormattingModel(){var e,t;const i={cards:[]};for(const n in cn){let r={description:cn[n].description,displayName:cn[n].displayName,uid:n+"_card_uid",groups:[],revertToDefaultDescriptors:[]};for(const i in cn[n].settingsGroups){let o={displayName:"all"===i?cn[n].displayName:i,uid:n+"_"+i+"_uid",slices:[]};for(const a in cn[n].settingsGroups[i]){r.revertToDefaultDescriptors.push({objectName:n,propertyName:a});let s={uid:n+"_"+i+"_"+a+"_slice_uid",displayName:cn[n].settingsGroups[i][a].displayName,control:{type:cn[n].settingsGroups[i][a].type,properties:{descriptor:{objectName:n,propertyName:a,selector:{data:[{dataViewWildcard:{matchingOption:0}}]},instanceKind:"boolean"!=typeof this.settings[n][a]?3:null},value:this.valueLookup(n,i,a),items:null===(e=cn[n].settingsGroups[i][a])||void 0===e?void 0:e.items,options:null===(t=cn[n].settingsGroups[i][a])||void 0===t?void 0:t.options}}};o.slices.push(s)}r.groups.push(o)}i.cards.push(r)}return i}valueLookup(e,t,i){var n;if(i.includes("colour"))return{value:this.settings[e][i]};if(!mn(null===(n=cn[e].settingsGroups[t][i])||void 0===n?void 0:n.items)){const n=cn[e].settingsGroups[t][i].items,r=this.settings[e][i];return n.find(e=>e.value===r)}return this.settings[e][i]}constructor(){this.settings=Object.fromEntries(Object.keys(hn).map(e=>[e,Object.fromEntries(Object.keys(hn[e]).map(t=>[t,hn[e][t]]))])),this.derivedSettings=new ds}}return e.Visual=class{constructor(e){this.svg=ue(e.element).append("svg"),this.host=e.host,this.viewModel=new Kr,this.plotProperties=new rr,this.selectionManager=this.host.createSelectionManager(),this.selectionManager.registerOnSelectCallback(()=>this.updateHighlighting()),this.svg.call(Kn)}update(e){var t,i,n,r,o;try{this.host.eventService.renderingStarted(e),this.svg.select(".errormessage").remove();const a=this.viewModel.update(e,this.host);if(!a.status)return this.resizeCanvas(e.viewport.width,e.viewport.height),null===(o=null===(r=null===(n=null===(i=null===(t=this.viewModel)||void 0===t?void 0:t.inputSettings)||void 0===i?void 0:i.settings)||void 0===n?void 0:n.canvas)||void 0===r?void 0:r.show_errors)||void 0===o||o?this.svg.call(Jn,e,null==a?void 0:a.error,null==a?void 0:a.type):this.svg.call(Kn,!0),void this.host.eventService.renderingFailed(e);this.plotProperties.update(e,this.viewModel),a.warning&&this.host.displayWarningIcon("Invalid inputs or settings ignored.\n",a.warning),this.resizeCanvas(e.viewport.width,e.viewport.height),this.drawVisual(),this.adjustPaddingForOverflow(),this.updateHighlighting(),this.host.eventService.renderingFinished(e)}catch(t){this.svg.call(Jn,e,t.message,"internal"),console.error(t),this.host.eventService.renderingFailed(e)}}resizeCanvas(e,t){this.svg.attr("width",e).attr("height",t)}updateHighlighting(){const e=!!this.viewModel.inputData&&this.viewModel.inputData.anyHighlights,t=this.selectionManager.getSelectionIds(),i=this.svg.selectAll(".dotsgroup").selectChildren(),n=this.svg.selectAll(".linesgroup").selectChildren();n.style("stroke-opacity",e=>$n(e[0],"lines","opacity",this.viewModel.inputSettings.settings)),i.style("fill-opacity",e=>e.aesthetics.opacity),i.style("stroke-opacity",e=>e.aesthetics.opacity),(e||t.length>0)&&(n.style("stroke-opacity",e=>$n(e[0],"lines","opacity_unselected",this.viewModel.inputSettings.settings)),i.nodes().forEach(e=>{const t=ue(e).datum(),i=function(e,t){const i=t.getSelectionIds();var n=!1;for(const t of i)if(Array.isArray(e)){for(const i of e)if(t===i){n=!0;break}}else if(t===e){n=!0;break}return n}(t.identity,this.selectionManager),n=t.highlighted,r=i||n?t.aesthetics.opacity_selected:t.aesthetics.opacity_unselected;ue(e).style("fill-opacity",r),ue(e).style("stroke-opacity",r)}))}drawVisual(){this.svg.call(Xn,this).call(Wn,this).call(Bn,this).call(Hn,this).call(ir,this).call(zn,this).call(fn,this).call(Zn,this)}adjustPaddingForOverflow(){if(this.viewModel.headless)return;const e=this.viewModel.svgWidth,t=this.viewModel.svgHeight,i=this.svg.node().getBBox(),n=Math.abs(Math.min(0,i.x)),r=Math.max(0,i.width+i.x-e),o=Math.abs(Math.min(0,i.y)),a=Math.max(0,i.height+i.y-t);n>0&&(this.plotProperties.xAxis.start_padding+=n+this.plotProperties.xAxis.start_padding),r>0&&(this.plotProperties.xAxis.end_padding+=r+this.plotProperties.xAxis.end_padding),o>0&&(this.plotProperties.yAxis.end_padding+=o+this.plotProperties.yAxis.end_padding),a>0&&(this.plotProperties.yAxis.start_padding+=a+this.plotProperties.yAxis.start_padding),(n>0||r>0||o>0||a>0)&&(this.plotProperties.initialiseScale(e,t),this.drawVisual())}getFormattingModel(){return this.viewModel.inputSettings.getFormattingModel()}},e.d3=tn,e.defaultSettings=hn,e}({});
