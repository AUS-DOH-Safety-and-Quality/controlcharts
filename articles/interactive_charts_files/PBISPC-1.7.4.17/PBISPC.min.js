var spc=function(t){"use strict";var e="http://www.w3.org/1999/xhtml",i={svg:"http://www.w3.org/2000/svg",xhtml:e,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a(t){var e=t+="",a=e.indexOf(":");return a>=0&&"xmlns"!==(e=t.slice(0,a))&&(t=t.slice(a+1)),i.hasOwnProperty(e)?{space:i[e],local:t}:t}function l(t){return function(){var i=this.ownerDocument,a=this.namespaceURI;return a===e&&i.documentElement.namespaceURI===e?i.createElement(t):i.createElementNS(a,t)}}function r(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function n(t){var e=a(t);return(e.local?r:l)(e)}function o(){}function s(t){return null==t?o:function(){return this.querySelector(t)}}function u(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function d(){return[]}function p(t){return function(e){return e.matches(t)}}var c=Array.prototype.find;function h(){return this.firstElementChild}var m=Array.prototype.filter;function f(){return Array.from(this.children)}function y(t){return new Array(t.length)}function g(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function _(t,e,i,a,l,r){for(var n,o=0,s=e.length,u=r.length;o<u;++o)(n=e[o])?(n.__data__=r[o],a[o]=n):i[o]=new g(t,r[o]);for(;o<s;++o)(n=e[o])&&(l[o]=n)}function v(t,e,i,a,l,r,n){var o,s,u,d=new Map,p=e.length,c=r.length,h=new Array(p);for(o=0;o<p;++o)(s=e[o])&&(h[o]=u=n.call(s,s.__data__,o,e)+"",d.has(u)?l[o]=s:d.set(u,s));for(o=0;o<c;++o)u=n.call(t,r[o],o,r)+"",(s=d.get(u))?(a[o]=s,s.__data__=r[o],d.delete(u)):i[o]=new g(t,r[o]);for(o=0;o<p;++o)(s=e[o])&&d.get(h[o])===s&&(l[o]=s)}function w(t){return t.__data__}function b(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function x(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function k(t){return function(){this.removeAttribute(t)}}function N(t){return function(){this.removeAttributeNS(t.space,t.local)}}function M(t,e){return function(){this.setAttribute(t,e)}}function A(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function F(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function S(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function C(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function T(t){return function(){this.style.removeProperty(t)}}function $(t,e,i){return function(){this.style.setProperty(t,e,i)}}function D(t,e,i){return function(){var a=e.apply(this,arguments);null==a?this.style.removeProperty(t):this.style.setProperty(t,a,i)}}function P(t){return function(){delete this[t]}}function L(t,e){return function(){this[t]=e}}function E(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function I(t){return t.trim().split(/^|\s+/)}function O(t){return t.classList||new V(t)}function V(t){this._node=t,this._names=I(t.getAttribute("class")||"")}function B(t,e){for(var i=O(t),a=-1,l=e.length;++a<l;)i.add(e[a])}function z(t,e){for(var i=O(t),a=-1,l=e.length;++a<l;)i.remove(e[a])}function j(t){return function(){B(this,t)}}function U(t){return function(){z(this,t)}}function H(t,e){return function(){(e.apply(this,arguments)?B:z)(this,t)}}function R(){this.textContent=""}function Z(t){return function(){this.textContent=t}}function G(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function q(){this.innerHTML=""}function Y(t){return function(){this.innerHTML=t}}function W(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function J(){this.nextSibling&&this.parentNode.appendChild(this)}function X(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function K(){return null}function Q(){var t=this.parentNode;t&&t.removeChild(this)}function tt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function et(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function it(t){return function(){var e=this.__on;if(e){for(var i,a=0,l=-1,r=e.length;a<r;++a)i=e[a],t.type&&i.type!==t.type||i.name!==t.name?e[++l]=i:this.removeEventListener(i.type,i.listener,i.options);++l?e.length=l:delete this.__on}}}function at(t,e,i){return function(){var a,l=this.__on,r=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(l)for(var n=0,o=l.length;n<o;++n)if((a=l[n]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=r,a.options=i),void(a.value=e);this.addEventListener(t.type,r,i),a={type:t.type,name:t.name,value:e,listener:r,options:i},l?l.push(a):this.__on=[a]}}function lt(t,e,i){var a=C(t),l=a.CustomEvent;"function"==typeof l?l=new l(e,i):(l=a.document.createEvent("Event"),i?(l.initEvent(e,i.bubbles,i.cancelable),l.detail=i.detail):l.initEvent(e,!1,!1)),t.dispatchEvent(l)}function rt(t,e){return function(){return lt(this,t,e)}}function nt(t,e){return function(){return lt(this,t,e.apply(this,arguments))}}g.prototype={constructor:g,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},V.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ot=[null];function st(t,e){this._groups=t,this._parents=e}function ut(t){return"string"==typeof t?new st([[document.querySelector(t)]],[document.documentElement]):new st([[t]],ot)}function dt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var i=e.ownerSVGElement||e;if(i.createSVGPoint){var a=i.createSVGPoint();return a.x=t.clientX,a.y=t.clientY,[(a=a.matrixTransform(e.getScreenCTM().inverse())).x,a.y]}if(e.getBoundingClientRect){var l=e.getBoundingClientRect();return[t.clientX-l.left-e.clientLeft,t.clientY-l.top-e.clientTop]}}return[t.pageX,t.pageY]}function pt(t){return function(){return t}}st.prototype={constructor:st,select:function(t){"function"!=typeof t&&(t=s(t));for(var e=this._groups,i=e.length,a=new Array(i),l=0;l<i;++l)for(var r,n,o=e[l],u=o.length,d=a[l]=new Array(u),p=0;p<u;++p)(r=o[p])&&(n=t.call(r,r.__data__,p,o))&&("__data__"in r&&(n.__data__=r.__data__),d[p]=n);return new st(a,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return u(t.apply(this,arguments))}}(t):function(t){return null==t?d:function(){return this.querySelectorAll(t)}}(t);for(var e=this._groups,i=e.length,a=[],l=[],r=0;r<i;++r)for(var n,o=e[r],s=o.length,p=0;p<s;++p)(n=o[p])&&(a.push(t.call(n,n.__data__,p,o)),l.push(n));return new st(a,l)},selectChild:function(t){return this.select(null==t?h:function(t){return function(){return c.call(this.children,t)}}("function"==typeof t?t:p(t)))},selectChildren:function(t){return this.selectAll(null==t?f:function(t){return function(){return m.call(this.children,t)}}("function"==typeof t?t:p(t)))},filter:function(t){"function"!=typeof t&&(t=function(t){return function(){return this.matches(t)}}(t));for(var e=this._groups,i=e.length,a=new Array(i),l=0;l<i;++l)for(var r,n=e[l],o=n.length,s=a[l]=[],u=0;u<o;++u)(r=n[u])&&t.call(r,r.__data__,u,n)&&s.push(r);return new st(a,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,w);var i=e?v:_,a=this._parents,l=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var r=l.length,n=new Array(r),o=new Array(r),s=new Array(r),u=0;u<r;++u){var d=a[u],p=l[u],c=p.length,h=b(t.call(d,d&&d.__data__,u,a)),m=h.length,f=o[u]=new Array(m),y=n[u]=new Array(m);i(d,p,f,y,s[u]=new Array(c),h,e);for(var g,x,k=0,N=0;k<m;++k)if(g=f[k]){for(k>=N&&(N=k+1);!(x=y[N])&&++N<m;);g._next=x||null}}return(n=new st(n,a))._enter=o,n._exit=s,n},enter:function(){return new st(this._enter||this._groups.map(y),this._parents)},exit:function(){return new st(this._exit||this._groups.map(y),this._parents)},join:function(t,e,i){var a=this.enter(),l=this,r=this.exit();return"function"==typeof t?(a=t(a))&&(a=a.selection()):a=a.append(t+""),null!=e&&(l=e(l))&&(l=l.selection()),null==i?r.remove():i(r),a&&l?a.merge(l).order():l},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,a=e._groups,l=i.length,r=a.length,n=Math.min(l,r),o=new Array(l),s=0;s<n;++s)for(var u,d=i[s],p=a[s],c=d.length,h=o[s]=new Array(c),m=0;m<c;++m)(u=d[m]||p[m])&&(h[m]=u);for(;s<l;++s)o[s]=i[s];return new st(o,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var a,l=t[e],r=l.length-1,n=l[r];--r>=0;)(a=l[r])&&(n&&4^a.compareDocumentPosition(n)&&n.parentNode.insertBefore(a,n),n=a);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=x);for(var i=this._groups,a=i.length,l=new Array(a),r=0;r<a;++r){for(var n,o=i[r],s=o.length,u=l[r]=new Array(s),d=0;d<s;++d)(n=o[d])&&(u[d]=n);u.sort(e)}return new st(l,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var a=t[e],l=0,r=a.length;l<r;++l){var n=a[l];if(n)return n}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,a=e.length;i<a;++i)for(var l,r=e[i],n=0,o=r.length;n<o;++n)(l=r[n])&&t.call(l,l.__data__,n,r);return this},attr:function(t,e){var i=a(t);if(arguments.length<2){var l=this.node();return i.local?l.getAttributeNS(i.space,i.local):l.getAttribute(i)}return this.each((null==e?i.local?N:k:"function"==typeof e?i.local?S:F:i.local?A:M)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?T:"function"==typeof e?D:$)(t,e,null==i?"":i)):function(t,e){return t.style.getPropertyValue(e)||C(t).getComputedStyle(t,null).getPropertyValue(e)}(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?P:"function"==typeof e?E:L)(t,e)):this.node()[t]},classed:function(t,e){var i=I(t+"");if(arguments.length<2){for(var a=O(this.node()),l=-1,r=i.length;++l<r;)if(!a.contains(i[l]))return!1;return!0}return this.each(("function"==typeof e?H:e?j:U)(i,e))},text:function(t){return arguments.length?this.each(null==t?R:("function"==typeof t?G:Z)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?q:("function"==typeof t?W:Y)(t)):this.node().innerHTML},raise:function(){return this.each(J)},lower:function(){return this.each(X)},append:function(t){var e="function"==typeof t?t:n(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var i="function"==typeof t?t:n(t),a=null==e?K:"function"==typeof e?e:s(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),a.apply(this,arguments)||null)})},remove:function(){return this.each(Q)},clone:function(t){return this.select(t?et:tt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var a,l,r=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}(t+""),n=r.length;if(!(arguments.length<2)){for(o=e?at:it,a=0;a<n;++a)this.each(o(r[a],e,i));return this}var o=this.node().__on;if(o)for(var s,u=0,d=o.length;u<d;++u)for(a=0,s=o[u];a<n;++a)if((l=r[a]).type===s.type&&l.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?nt:rt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var a,l=t[e],r=0,n=l.length;r<n;++r)(a=l[r])&&(yield a)}};const ct=Math.cos,ht=Math.min,mt=Math.sin,ft=Math.sqrt,yt=Math.PI,gt=2*yt,_t=Math.PI,vt=2*_t,wt=1e-6,bt=vt-wt;function xt(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=arguments[e]+t[e]}class kt{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?xt:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return xt;const i=10**e;return function(t){this._+=t[0];for(let e=1,a=t.length;e<a;++e)this._+=Math.round(arguments[e]*i)/i+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,i,a){this._append`Q${+t},${+e},${this._x1=+i},${this._y1=+a}`}bezierCurveTo(t,e,i,a,l,r){this._append`C${+t},${+e},${+i},${+a},${this._x1=+l},${this._y1=+r}`}arcTo(t,e,i,a,l){if(t=+t,e=+e,i=+i,a=+a,(l=+l)<0)throw new Error(`negative radius: ${l}`);let r=this._x1,n=this._y1,o=i-t,s=a-e,u=r-t,d=n-e,p=u*u+d*d;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(p>wt)if(Math.abs(d*o-s*u)>wt&&l){let c=i-r,h=a-n,m=o*o+s*s,f=c*c+h*h,y=Math.sqrt(m),g=Math.sqrt(p),_=l*Math.tan((_t-Math.acos((m+p-f)/(2*y*g)))/2),v=_/g,w=_/y;Math.abs(v-1)>wt&&this._append`L${t+v*u},${e+v*d}`,this._append`A${l},${l},0,0,${+(d*c>u*h)},${this._x1=t+w*o},${this._y1=e+w*s}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,i,a,l,r){if(t=+t,e=+e,r=!!r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let n=i*Math.cos(a),o=i*Math.sin(a),s=t+n,u=e+o,d=1^r,p=r?a-l:l-a;null===this._x1?this._append`M${s},${u}`:(Math.abs(this._x1-s)>wt||Math.abs(this._y1-u)>wt)&&this._append`L${s},${u}`,i&&(p<0&&(p=p%vt+vt),p>bt?this._append`A${i},${i},0,1,${d},${t-n},${e-o}A${i},${i},0,1,${d},${this._x1=s},${this._y1=u}`:p>wt&&this._append`A${i},${i},0,${+(p>=_t)},${d},${this._x1=t+i*Math.cos(l)},${this._y1=e+i*Math.sin(l)}`)}rect(t,e,i,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${i=+i}v${+a}h${-i}Z`}toString(){return this._}}function Nt(t){let e=3;return t.digits=function(i){if(!arguments.length)return e;if(null==i)e=null;else{const t=Math.floor(i);if(!(t>=0))throw new RangeError(`invalid digits: ${i}`);e=t}return t},()=>new kt(e)}function Mt(t){this._context=t}function At(t){return new Mt(t)}function Ft(t){return t[0]}function St(t){return t[1]}Mt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const Ct=ft(3);var Tt={draw(t,e){const i=.59436*ft(e+ht(e/28,.75)),a=i/2,l=a*Ct;t.moveTo(0,i),t.lineTo(0,-i),t.moveTo(-l,-a),t.lineTo(l,a),t.moveTo(-l,a),t.lineTo(l,-a)}},$t={draw(t,e){const i=ft(e/yt);t.moveTo(i,0),t.arc(0,0,i,0,gt)}},Dt={draw(t,e){const i=ft(e/5)/2;t.moveTo(-3*i,-i),t.lineTo(-i,-i),t.lineTo(-i,-3*i),t.lineTo(i,-3*i),t.lineTo(i,-i),t.lineTo(3*i,-i),t.lineTo(3*i,i),t.lineTo(i,i),t.lineTo(i,3*i),t.lineTo(-i,3*i),t.lineTo(-i,i),t.lineTo(-3*i,i),t.closePath()}};const Pt=ft(1/3),Lt=2*Pt;var Et={draw(t,e){const i=ft(e/Lt),a=i*Pt;t.moveTo(0,-i),t.lineTo(a,0),t.lineTo(0,i),t.lineTo(-a,0),t.closePath()}},It={draw(t,e){const i=ft(e),a=-i/2;t.rect(a,a,i,i)}};const Ot=mt(yt/10)/mt(7*yt/10),Vt=mt(gt/10)*Ot,Bt=-ct(gt/10)*Ot;var zt={draw(t,e){const i=ft(.8908130915292852*e),a=Vt*i,l=Bt*i;t.moveTo(0,-i),t.lineTo(a,l);for(let e=1;e<5;++e){const r=gt*e/5,n=ct(r),o=mt(r);t.lineTo(o*i,-n*i),t.lineTo(n*a-o*l,o*a+n*l)}t.closePath()}};const jt=ft(3);var Ut={draw(t,e){const i=-ft(e/(3*jt));t.moveTo(0,2*i),t.lineTo(-jt*i,-i),t.lineTo(jt*i,-i),t.closePath()}};const Ht=-.5,Rt=ft(3)/2,Zt=1/ft(12),Gt=3*(Zt/2+1);var qt={draw(t,e){const i=ft(e/Gt),a=i/2,l=i*Zt,r=a,n=i*Zt+i,o=-r,s=n;t.moveTo(a,l),t.lineTo(r,n),t.lineTo(o,s),t.lineTo(Ht*a-Rt*l,Rt*a+Ht*l),t.lineTo(Ht*r-Rt*n,Rt*r+Ht*n),t.lineTo(Ht*o-Rt*s,Rt*o+Ht*s),t.lineTo(Ht*a+Rt*l,Ht*l-Rt*a),t.lineTo(Ht*r+Rt*n,Ht*n-Rt*r),t.lineTo(Ht*o+Rt*s,Ht*s-Rt*o),t.closePath()}};function Yt(t,e){let i=null,a=Nt(l);function l(){let l;if(i||(i=l=a()),t.apply(this,arguments).draw(i,+e.apply(this,arguments)),l)return i=null,l+""||null}return t="function"==typeof t?t:pt(t||$t),e="function"==typeof e?e:pt(void 0===e?64:+e),l.type=function(e){return arguments.length?(t="function"==typeof e?e:pt(e),l):t},l.size=function(t){return arguments.length?(e="function"==typeof t?t:pt(+t),l):e},l.context=function(t){return arguments.length?(i=null==t?null:t,l):i},l}function Wt(t){return t}var Jt=1e-6;function Xt(t){return"translate("+t+",0)"}function Kt(t){return"translate(0,"+t+")"}function Qt(t){return e=>+t(e)}function te(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),i=>+t(i)+e}function ee(){return!this.__axis}function ie(t,e){var i=[],a=null,l=null,r=6,n=6,o=3,s="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,u=1===t||4===t?-1:1,d=4===t||2===t?"x":"y",p=1===t||3===t?Xt:Kt;function c(c){var h=null==a?e.ticks?e.ticks.apply(e,i):e.domain():a,m=null==l?e.tickFormat?e.tickFormat.apply(e,i):Wt:l,f=Math.max(r,0)+o,y=e.range(),g=+y[0]+s,_=+y[y.length-1]+s,v=(e.bandwidth?te:Qt)(e.copy(),s),w=c.selection?c.selection():c,b=w.selectAll(".domain").data([null]),x=w.selectAll(".tick").data(h,e).order(),k=x.exit(),N=x.enter().append("g").attr("class","tick"),M=x.select("line"),A=x.select("text");b=b.merge(b.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(N),M=M.merge(N.append("line").attr("stroke","currentColor").attr(d+"2",u*r)),A=A.merge(N.append("text").attr("fill","currentColor").attr(d,u*f).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),c!==w&&(b=b.transition(c),x=x.transition(c),M=M.transition(c),A=A.transition(c),k=k.transition(c).attr("opacity",Jt).attr("transform",function(t){return isFinite(t=v(t))?p(t+s):this.getAttribute("transform")}),N.attr("opacity",Jt).attr("transform",function(t){var e=this.parentNode.__axis;return p((e&&isFinite(e=e(t))?e:v(t))+s)})),k.remove(),b.attr("d",4===t||2===t?n?"M"+u*n+","+g+"H"+s+"V"+_+"H"+u*n:"M"+s+","+g+"V"+_:n?"M"+g+","+u*n+"V"+s+"H"+_+"V"+u*n:"M"+g+","+s+"H"+_),x.attr("opacity",1).attr("transform",function(t){return p(v(t)+s)}),M.attr(d+"2",u*r),A.attr(d,u*f).text(m),w.filter(ee).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),w.each(function(){this.__axis=v})}return c.scale=function(t){return arguments.length?(e=t,c):e},c.ticks=function(){return i=Array.from(arguments),c},c.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),c):i.slice()},c.tickValues=function(t){return arguments.length?(a=null==t?null:Array.from(t),c):a&&a.slice()},c.tickFormat=function(t){return arguments.length?(l=t,c):l},c.tickSize=function(t){return arguments.length?(r=n=+t,c):r},c.tickSizeInner=function(t){return arguments.length?(r=+t,c):r},c.tickSizeOuter=function(t){return arguments.length?(n=+t,c):n},c.tickPadding=function(t){return arguments.length?(o=+t,c):o},c.offset=function(t){return arguments.length?(s=+t,c):s},c}function ae(t){return ie(3,t)}function le(t){return ie(4,t)}function re(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function ne(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function oe(t){let e,i,a;function l(t,a,l=0,r=t.length){if(l<r){if(0!==e(a,a))return r;do{const e=l+r>>>1;i(t[e],a)<0?l=e+1:r=e}while(l<r)}return l}return 2!==t.length?(e=re,i=(e,i)=>re(t(e),i),a=(e,i)=>t(e)-i):(e=t===re||t===ne?t:se,i=t,a=t),{left:l,center:function(t,e,i=0,r=t.length){const n=l(t,e,i,r-1);return n>i&&a(t[n-1],e)>-a(t[n],e)?n-1:n},right:function(t,a,l=0,r=t.length){if(l<r){if(0!==e(a,a))return r;do{const e=l+r>>>1;i(t[e],a)<=0?l=e+1:r=e}while(l<r)}return l}}}function se(){return 0}const ue=oe(re).right;oe(function(t){return null===t?NaN:+t}).center;const de=Math.sqrt(50),pe=Math.sqrt(10),ce=Math.sqrt(2);function he(t,e,i){const a=(e-t)/Math.max(0,i),l=Math.floor(Math.log10(a)),r=a/Math.pow(10,l),n=r>=de?10:r>=pe?5:r>=ce?2:1;let o,s,u;return l<0?(u=Math.pow(10,-l)/n,o=Math.round(t*u),s=Math.round(e*u),o/u<t&&++o,s/u>e&&--s,u=-u):(u=Math.pow(10,l)*n,o=Math.round(t/u),s=Math.round(e/u),o*u<t&&++o,s*u>e&&--s),s<o&&.5<=i&&i<2?he(t,e,2*i):[o,s,u]}function me(t,e,i){return he(t=+t,e=+e,i=+i)[2]}function fe(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function ye(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function ge(t,e){var i=Object.create(t.prototype);for(var a in e)i[a]=e[a];return i}function _e(){}var ve=.7,we=1/ve,be="\\s*([+-]?\\d+)\\s*",xe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ke="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ne=/^#([0-9a-f]{3,8})$/,Me=new RegExp(`^rgb\\(${be},${be},${be}\\)$`),Ae=new RegExp(`^rgb\\(${ke},${ke},${ke}\\)$`),Fe=new RegExp(`^rgba\\(${be},${be},${be},${xe}\\)$`),Se=new RegExp(`^rgba\\(${ke},${ke},${ke},${xe}\\)$`),Ce=new RegExp(`^hsl\\(${xe},${ke},${ke}\\)$`),Te=new RegExp(`^hsla\\(${xe},${ke},${ke},${xe}\\)$`),$e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function De(){return this.rgb().formatHex()}function Pe(){return this.rgb().formatRgb()}function Le(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Ne.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?Ee(e):3===i?new Ve(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?Ie(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?Ie(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Me.exec(t))?new Ve(e[1],e[2],e[3],1):(e=Ae.exec(t))?new Ve(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Fe.exec(t))?Ie(e[1],e[2],e[3],e[4]):(e=Se.exec(t))?Ie(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ce.exec(t))?Re(e[1],e[2]/100,e[3]/100,1):(e=Te.exec(t))?Re(e[1],e[2]/100,e[3]/100,e[4]):$e.hasOwnProperty(t)?Ee($e[t]):"transparent"===t?new Ve(NaN,NaN,NaN,0):null}function Ee(t){return new Ve(t>>16&255,t>>8&255,255&t,1)}function Ie(t,e,i,a){return a<=0&&(t=e=i=NaN),new Ve(t,e,i,a)}function Oe(t,e,i,a){return 1===arguments.length?((l=t)instanceof _e||(l=Le(l)),l?new Ve((l=l.rgb()).r,l.g,l.b,l.opacity):new Ve):new Ve(t,e,i,null==a?1:a);var l}function Ve(t,e,i,a){this.r=+t,this.g=+e,this.b=+i,this.opacity=+a}function Be(){return`#${He(this.r)}${He(this.g)}${He(this.b)}`}function ze(){const t=je(this.opacity);return`${1===t?"rgb(":"rgba("}${Ue(this.r)}, ${Ue(this.g)}, ${Ue(this.b)}${1===t?")":`, ${t})`}`}function je(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ue(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function He(t){return((t=Ue(t))<16?"0":"")+t.toString(16)}function Re(t,e,i,a){return a<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Ge(t,e,i,a)}function Ze(t){if(t instanceof Ge)return new Ge(t.h,t.s,t.l,t.opacity);if(t instanceof _e||(t=Le(t)),!t)return new Ge;if(t instanceof Ge)return t;var e=(t=t.rgb()).r/255,i=t.g/255,a=t.b/255,l=Math.min(e,i,a),r=Math.max(e,i,a),n=NaN,o=r-l,s=(r+l)/2;return o?(n=e===r?(i-a)/o+6*(i<a):i===r?(a-e)/o+2:(e-i)/o+4,o/=s<.5?r+l:2-r-l,n*=60):o=s>0&&s<1?0:n,new Ge(n,o,s,t.opacity)}function Ge(t,e,i,a){this.h=+t,this.s=+e,this.l=+i,this.opacity=+a}function qe(t){return(t=(t||0)%360)<0?t+360:t}function Ye(t){return Math.max(0,Math.min(1,t||0))}function We(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}ye(_e,Le,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:De,formatHex:De,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Ze(this).formatHsl()},formatRgb:Pe,toString:Pe}),ye(Ve,Oe,ge(_e,{brighter(t){return t=null==t?we:Math.pow(we,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?ve:Math.pow(ve,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ve(Ue(this.r),Ue(this.g),Ue(this.b),je(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Be,formatHex:Be,formatHex8:function(){return`#${He(this.r)}${He(this.g)}${He(this.b)}${He(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ze,toString:ze})),ye(Ge,function(t,e,i,a){return 1===arguments.length?Ze(t):new Ge(t,e,i,null==a?1:a)},ge(_e,{brighter(t){return t=null==t?we:Math.pow(we,t),new Ge(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?ve:Math.pow(ve,t),new Ge(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,a=i+(i<.5?i:1-i)*e,l=2*i-a;return new Ve(We(t>=240?t-240:t+120,l,a),We(t,l,a),We(t<120?t+240:t-120,l,a),this.opacity)},clamp(){return new Ge(qe(this.h),Ye(this.s),Ye(this.l),je(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=je(this.opacity);return`${1===t?"hsl(":"hsla("}${qe(this.h)}, ${100*Ye(this.s)}%, ${100*Ye(this.l)}%${1===t?")":`, ${t})`}`}}));var Je=t=>()=>t;function Xe(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):Je(isNaN(t)?e:t)}var Ke=function t(e){var i=function(t){return 1===(t=+t)?Xe:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(a){return Math.pow(t+a*e,i)}}(e,i,t):Je(isNaN(e)?i:e)}}(e);function a(t,e){var a=i((t=Oe(t)).r,(e=Oe(e)).r),l=i(t.g,e.g),r=i(t.b,e.b),n=Xe(t.opacity,e.opacity);return function(e){return t.r=a(e),t.g=l(e),t.b=r(e),t.opacity=n(e),t+""}}return a.gamma=t,a}(1);function Qe(t,e){e||(e=[]);var i,a=t?Math.min(e.length,t.length):0,l=e.slice();return function(r){for(i=0;i<a;++i)l[i]=t[i]*(1-r)+e[i]*r;return l}}function ti(t,e){var i,a=e?e.length:0,l=t?Math.min(a,t.length):0,r=new Array(l),n=new Array(a);for(i=0;i<l;++i)r[i]=oi(t[i],e[i]);for(;i<a;++i)n[i]=e[i];return function(t){for(i=0;i<l;++i)n[i]=r[i](t);return n}}function ei(t,e){var i=new Date;return t=+t,e=+e,function(a){return i.setTime(t*(1-a)+e*a),i}}function ii(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function ai(t,e){var i,a={},l={};for(i in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)i in t?a[i]=oi(t[i],e[i]):l[i]=e[i];return function(t){for(i in a)l[i]=a[i](t);return l}}var li=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ri=new RegExp(li.source,"g");function ni(t,e){var i,a,l,r=li.lastIndex=ri.lastIndex=0,n=-1,o=[],s=[];for(t+="",e+="";(i=li.exec(t))&&(a=ri.exec(e));)(l=a.index)>r&&(l=e.slice(r,l),o[n]?o[n]+=l:o[++n]=l),(i=i[0])===(a=a[0])?o[n]?o[n]+=a:o[++n]=a:(o[++n]=null,s.push({i:n,x:ii(i,a)})),r=ri.lastIndex;return r<e.length&&(l=e.slice(r),o[n]?o[n]+=l:o[++n]=l),o.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var i,a=0;a<e;++a)o[(i=s[a]).i]=i.x(t);return o.join("")})}function oi(t,e){var i,a=typeof e;return null==e||"boolean"===a?Je(e):("number"===a?ii:"string"===a?(i=Le(e))?(e=i,Ke):ni:e instanceof Le?Ke:e instanceof Date?ei:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?Qe:Array.isArray(e)?ti:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?ai:ii)(t,e)}function si(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}function ui(t){return+t}var di=[0,1];function pi(t){return t}function ci(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function hi(t,e,i){var a=t[0],l=t[1],r=e[0],n=e[1];return l<a?(a=ci(l,a),r=i(n,r)):(a=ci(a,l),r=i(r,n)),function(t){return r(a(t))}}function mi(t,e,i){var a=Math.min(t.length,e.length)-1,l=new Array(a),r=new Array(a),n=-1;for(t[a]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++n<a;)l[n]=ci(t[n],t[n+1]),r[n]=i(e[n],e[n+1]);return function(e){var i=ue(t,e,1,a)-1;return r[i](l[i](e))}}function fi(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,a=t.slice(0,i);return[a.length>1?a[0]+a.slice(2):a,+t.slice(i+1)]}function yi(t){return(t=fi(Math.abs(t)))?t[1]:NaN}var gi,_i=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vi(t){if(!(e=_i.exec(t)))throw new Error("invalid format: "+t);var e;return new wi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function wi(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function bi(t,e){var i=fi(t,e);if(!i)return t+"";var a=i[0],l=i[1];return l<0?"0."+new Array(-l).join("0")+a:a.length>l+1?a.slice(0,l+1)+"."+a.slice(l+1):a+new Array(l-a.length+2).join("0")}vi.prototype=wi.prototype,wi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var xi={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>bi(100*t,e),r:bi,s:function(t,e){var i=fi(t,e);if(!i)return t+"";var a=i[0],l=i[1],r=l-(gi=3*Math.max(-8,Math.min(8,Math.floor(l/3))))+1,n=a.length;return r===n?a:r>n?a+new Array(r-n+1).join("0"):r>0?a.slice(0,r)+"."+a.slice(r):"0."+new Array(1-r).join("0")+fi(t,Math.max(0,e+r-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function ki(t){return t}var Ni,Mi,Ai,Fi=Array.prototype.map,Si=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ci(t){var e=t.domain;return t.ticks=function(t){var i=e();return function(t,e,i){if(!((i=+i)>0))return[];if((t=+t)===(e=+e))return[t];const a=e<t,[l,r,n]=a?he(e,t,i):he(t,e,i);if(!(r>=l))return[];const o=r-l+1,s=new Array(o);if(a)if(n<0)for(let t=0;t<o;++t)s[t]=(r-t)/-n;else for(let t=0;t<o;++t)s[t]=(r-t)*n;else if(n<0)for(let t=0;t<o;++t)s[t]=(l+t)/-n;else for(let t=0;t<o;++t)s[t]=(l+t)*n;return s}(i[0],i[i.length-1],null==t?10:t)},t.tickFormat=function(t,i){var a=e();return function(t,e,i,a){var l,r=function(t,e,i){i=+i;const a=(e=+e)<(t=+t),l=a?me(e,t,i):me(t,e,i);return(a?-1:1)*(l<0?1/-l:l)}(t,e,i);switch((a=vi(null==a?",f":a)).type){case"s":var n=Math.max(Math.abs(t),Math.abs(e));return null!=a.precision||isNaN(l=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(yi(e)/3)))-yi(Math.abs(t)))}(r,n))||(a.precision=l),Ai(a,n);case"":case"e":case"g":case"p":case"r":null!=a.precision||isNaN(l=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,yi(e)-yi(t))+1}(r,Math.max(Math.abs(t),Math.abs(e))))||(a.precision=l-("e"===a.type));break;case"f":case"%":null!=a.precision||isNaN(l=function(t){return Math.max(0,-yi(Math.abs(t)))}(r))||(a.precision=l-2*("%"===a.type))}return Mi(a)}(a[0],a[a.length-1],null==t?10:t,i)},t.nice=function(i){null==i&&(i=10);var a,l,r=e(),n=0,o=r.length-1,s=r[n],u=r[o],d=10;for(u<s&&(l=s,s=u,u=l,l=n,n=o,o=l);d-- >0;){if((l=me(s,u,i))===a)return r[n]=s,r[o]=u,e(r);if(l>0)s=Math.floor(s/l)*l,u=Math.ceil(u/l)*l;else{if(!(l<0))break;s=Math.ceil(s*l)/l,u=Math.floor(u*l)/l}a=l}return t},t}function Ti(){var t=function(){var t,e,i,a,l,r,n=di,o=di,s=oi,u=pi;function d(){var t=Math.min(n.length,o.length);return u!==pi&&(u=function(t,e){var i;return t>e&&(i=t,t=e,e=i),function(i){return Math.max(t,Math.min(e,i))}}(n[0],n[t-1])),a=t>2?mi:hi,l=r=null,p}function p(e){return null==e||isNaN(e=+e)?i:(l||(l=a(n.map(t),o,s)))(t(u(e)))}return p.invert=function(i){return u(e((r||(r=a(o,n.map(t),ii)))(i)))},p.domain=function(t){return arguments.length?(n=Array.from(t,ui),d()):n.slice()},p.range=function(t){return arguments.length?(o=Array.from(t),d()):o.slice()},p.rangeRound=function(t){return o=Array.from(t),s=si,d()},p.clamp=function(t){return arguments.length?(u=!!t||pi,d()):u!==pi},p.interpolate=function(t){return arguments.length?(s=t,d()):s},p.unknown=function(t){return arguments.length?(i=t,p):i},function(i,a){return t=i,e=a,d()}}()(pi,pi);return t.copy=function(){return e=t,Ti().domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown());var e},fe.apply(t,arguments),Ci(t)}Ni=function(t){var e,i,a=void 0===t.grouping||void 0===t.thousands?ki:(e=Fi.call(t.grouping,Number),i=t.thousands+"",function(t,a){for(var l=t.length,r=[],n=0,o=e[0],s=0;l>0&&o>0&&(s+o+1>a&&(o=Math.max(1,a-s)),r.push(t.substring(l-=o,l+o)),!((s+=o+1)>a));)o=e[n=(n+1)%e.length];return r.reverse().join(i)}),l=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",n=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?ki:function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(Fi.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"−":t.minus+"",d=void 0===t.nan?"NaN":t.nan+"";function p(t){var e=(t=vi(t)).fill,i=t.align,p=t.sign,c=t.symbol,h=t.zero,m=t.width,f=t.comma,y=t.precision,g=t.trim,_=t.type;"n"===_?(f=!0,_="g"):xi[_]||(void 0===y&&(y=12),g=!0,_="g"),(h||"0"===e&&"="===i)&&(h=!0,e="0",i="=");var v="$"===c?l:"#"===c&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",w="$"===c?r:/[%p]/.test(_)?s:"",b=xi[_],x=/[defgprs%]/.test(_);function k(t){var l,r,s,c=v,k=w;if("c"===_)k=b(t)+k,t="";else{var N=(t=+t)<0||1/t<0;if(t=isNaN(t)?d:b(Math.abs(t),y),g&&(t=function(t){t:for(var e,i=t.length,a=1,l=-1;a<i;++a)switch(t[a]){case".":l=e=a;break;case"0":0===l&&(l=a),e=a;break;default:if(!+t[a])break t;l>0&&(l=0)}return l>0?t.slice(0,l)+t.slice(e+1):t}(t)),N&&0===+t&&"+"!==p&&(N=!1),c=(N?"("===p?p:u:"-"===p||"("===p?"":p)+c,k=("s"===_?Si[8+gi/3]:"")+k+(N&&"("===p?")":""),x)for(l=-1,r=t.length;++l<r;)if(48>(s=t.charCodeAt(l))||s>57){k=(46===s?n+t.slice(l+1):t.slice(l))+k,t=t.slice(0,l);break}}f&&!h&&(t=a(t,1/0));var M=c.length+t.length+k.length,A=M<m?new Array(m-M+1).join(e):"";switch(f&&h&&(t=a(A+t,A.length?m-k.length:1/0),A=""),i){case"<":t=c+t+k+A;break;case"=":t=c+A+t+k;break;case"^":t=A.slice(0,M=A.length>>1)+c+t+k+A.slice(M);break;default:t=A+c+t+k}return o(t)}return y=void 0===y?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),k.toString=function(){return t+""},k}return{format:p,formatPrefix:function(t,e){var i=p(((t=vi(t)).type="f",t)),a=3*Math.max(-8,Math.min(8,Math.floor(yi(e)/3))),l=Math.pow(10,-a),r=Si[8+a/3];return function(t){return i(l*t)+r}}}}({thousands:",",grouping:[3],currency:["$",""]}),Mi=Ni.format,Ai=Ni.formatPrefix;var $i={value:()=>{}};function Di(){for(var t,e=0,i=arguments.length,a={};e<i;++e){if(!(t=arguments[e]+"")||t in a||/[\s.]/.test(t))throw new Error("illegal type: "+t);a[t]=[]}return new Pi(a)}function Pi(t){this._=t}function Li(t,e){for(var i,a=0,l=t.length;a<l;++a)if((i=t[a]).name===e)return i.value}function Ei(t,e,i){for(var a=0,l=t.length;a<l;++a)if(t[a].name===e){t[a]=$i,t=t.slice(0,a).concat(t.slice(a+1));break}return null!=i&&t.push({name:e,value:i}),t}Pi.prototype=Di.prototype={constructor:Pi,on:function(t,e){var i,a,l=this._,r=(a=l,(t+"").trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!a.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),n=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++n<o;)if(i=(t=r[n]).type)l[i]=Ei(l[i],t.name,e);else if(null==e)for(i in l)l[i]=Ei(l[i],t.name,null);return this}for(;++n<o;)if((i=(t=r[n]).type)&&(i=Li(l[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new Pi(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,a,l=new Array(i),r=0;r<i;++r)l[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,i=(a=this._[t]).length;r<i;++r)a[r].value.apply(e,l)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var a=this._[t],l=0,r=a.length;l<r;++l)a[l].value.apply(e,i)}};const Ii={passive:!1},Oi={capture:!0,passive:!1};function Vi(t){t.stopImmediatePropagation()}function Bi(t){t.preventDefault(),t.stopImmediatePropagation()}var zi=t=>()=>t;function ji(t,{sourceEvent:e,subject:i,target:a,identifier:l,active:r,x:n,y:o,dx:s,dy:u,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},identifier:{value:l,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:n,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:s,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}function Ui(t){return!t.ctrlKey&&!t.button}function Hi(){return this.parentNode}function Ri(t,e){return null==e?{x:t.x,y:t.y}:e}function Zi(){return navigator.maxTouchPoints||"ontouchstart"in this}function Gi(){var t,e,i,a,l=Ui,r=Hi,n=Ri,o=Zi,s={},u=Di("start","drag","end"),d=0,p=0;function c(t){t.on("mousedown.drag",h).filter(o).on("touchstart.drag",y).on("touchmove.drag",g,Ii).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(n,o){if(!a&&l.call(this,n,o)){var s=v(this,r.call(this,n,o),n,o,"mouse");s&&(ut(n.view).on("mousemove.drag",m,Oi).on("mouseup.drag",f,Oi),function(t){var e=t.document.documentElement,i=ut(t).on("dragstart.drag",Bi,Oi);"onselectstart"in e?i.on("selectstart.drag",Bi,Oi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(n.view),Vi(n),i=!1,t=n.clientX,e=n.clientY,s("start",n))}}function m(a){if(Bi(a),!i){var l=a.clientX-t,r=a.clientY-e;i=l*l+r*r>p}s.mouse("drag",a)}function f(t){ut(t.view).on("mousemove.drag mouseup.drag",null),function(t,e){var i=t.document.documentElement,a=ut(t).on("dragstart.drag",null);e&&(a.on("click.drag",Bi,Oi),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in i?a.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(t.view,i),Bi(t),s.mouse("end",t)}function y(t,e){if(l.call(this,t,e)){var i,a,n=t.changedTouches,o=r.call(this,t,e),s=n.length;for(i=0;i<s;++i)(a=v(this,o,t,e,n[i].identifier,n[i]))&&(Vi(t),a("start",t,n[i]))}}function g(t){var e,i,a=t.changedTouches,l=a.length;for(e=0;e<l;++e)(i=s[a[e].identifier])&&(Bi(t),i("drag",t,a[e]))}function _(t){var e,i,l=t.changedTouches,r=l.length;for(a&&clearTimeout(a),a=setTimeout(function(){a=null},500),e=0;e<r;++e)(i=s[l[e].identifier])&&(Vi(t),i("end",t,l[e]))}function v(t,e,i,a,l,r){var o,p,h,m=u.copy(),f=dt(r||i,e);if(null!=(h=n.call(t,new ji("beforestart",{sourceEvent:i,target:c,identifier:l,active:d,x:f[0],y:f[1],dx:0,dy:0,dispatch:m}),a)))return o=h.x-f[0]||0,p=h.y-f[1]||0,function i(r,n,u){var y,g=f;switch(r){case"start":s[l]=i,y=d++;break;case"end":delete s[l],--d;case"drag":f=dt(u||n,e),y=d}m.call(r,t,new ji(r,{sourceEvent:n,subject:h,target:c,identifier:l,active:y,x:f[0]+o,y:f[1]+p,dx:f[0]-g[0],dy:f[1]-g[1],dispatch:m}),a)}}return c.filter=function(t){return arguments.length?(l="function"==typeof t?t:zi(!!t),c):l},c.container=function(t){return arguments.length?(r="function"==typeof t?t:zi(t),c):r},c.subject=function(t){return arguments.length?(n="function"==typeof t?t:zi(t),c):n},c.touchable=function(t){return arguments.length?(o="function"==typeof t?t:zi(!!t),c):o},c.on=function(){var t=u.on.apply(u,arguments);return t===u?c:t},c.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,c):Math.sqrt(p)},c}ji.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var qi=Object.freeze({__proto__:null,axisBottom:ae,axisLeft:le,drag:Gi,line:function(t,e){var i=pt(!0),a=null,l=At,r=null,n=Nt(o);function o(o){var s,u,d,p=(o=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(o)).length,c=!1;for(null==a&&(r=l(d=n())),s=0;s<=p;++s)!(s<p&&i(u=o[s],s,o))===c&&((c=!c)?r.lineStart():r.lineEnd()),c&&r.point(+t(u,s,o),+e(u,s,o));if(d)return r=null,d+""||null}return t="function"==typeof t?t:void 0===t?Ft:pt(t),e="function"==typeof e?e:void 0===e?St:pt(e),o.x=function(e){return arguments.length?(t="function"==typeof e?e:pt(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:pt(+t),o):e},o.defined=function(t){return arguments.length?(i="function"==typeof t?t:pt(!!t),o):i},o.curve=function(t){return arguments.length?(l=t,null!=a&&(r=l(a)),o):l},o.context=function(t){return arguments.length?(null==t?a=r=null:r=l(a=t),o):a},o},scaleLinear:Ti,select:ut,selectAll:function(t){return"string"==typeof t?new st([document.querySelectorAll(t)],[document.documentElement]):new st([u(t)],ot)},symbol:Yt,symbolAsterisk:Tt,symbolCircle:$t,symbolCross:Dt,symbolDiamond:Et,symbolSquare:It,symbolStar:zt,symbolTriangle:Ut,symbolWye:qt});const Yi=["'Arial', sans-serif","Arial","'Arial Black'","'Arial Unicode MS'","Calibri","Cambria","'Cambria Math'","Candara","'Comic Sans MS'","Consolas","Constantia","Corbel","'Courier New'","wf_standard-font, helvetica, arial, sans-serif","wf_standard-font_light, helvetica, arial, sans-serif","Georgia","'Lucida Sans Unicode'","'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif","'Segoe UI Light', wf_segoe-ui_light, helvetica, arial, sans-serif","'Segoe UI Semibold', wf_segoe-ui_semibold, helvetica, arial, sans-serif","'Segoe UI Bold', wf_segoe-ui_bold, helvetica, arial, sans-serif","Symbol","Tahoma","'Times New Roman'","'Trebuchet MS'","Verdana","Wingdings"],Wi=[{displayName:"Solid",value:"10 0"},{displayName:"Dashed",value:"10 10"},{displayName:"Dotted",value:"2 5"}],Ji=["10 0","10 10","2 5"],Xi=[{displayName:"Above",value:"above"},{displayName:"Below",value:"below"},{displayName:"Beside",value:"beside"}],Ki=[{displayName:"Outside",value:"outside"},{displayName:"Inside",value:"inside"},...Xi],Qi=[{displayName:"Solid",value:"solid"},{displayName:"Dashed",value:"dashed"},{displayName:"Dotted",value:"dotted"},{displayName:"Double",value:"double"},{displayName:"Groove",value:"groove"},{displayName:"Ridge",value:"ridge"},{displayName:"Inset",value:"inset"},{displayName:"Outset",value:"outset"}],ta=(t,e)=>({displayName:t,type:"NumUpDown",default:e,options:{minValue:{value:0},maxValue:{value:100}}}),ea=(t,e)=>({displayName:t,type:"Dropdown",default:e,valid:Ji,items:Wi}),ia=(t,e)=>({displayName:t,type:"NumUpDown",default:e,options:{minValue:{value:0},maxValue:{value:1}}}),aa=(t,e)=>({displayName:t,type:"FontPicker",default:e,valid:Yi}),la=(t,e)=>({displayName:t,type:"NumUpDown",default:e,options:{minValue:{value:0},maxValue:{value:100}}}),ra=(t,e=!1)=>{const i=e?Ki:Xi,a=i.map(t=>t.value);return{[`plot_label_show_${t}`]:{displayName:"Show Value on Plot",type:"ToggleSwitch",default:!1},[`plot_label_show_all_${t}`]:{displayName:"Show Value at all Re-Baselines",type:"ToggleSwitch",default:!1},[`plot_label_show_n_${t}`]:{displayName:"Show Value at Last N Re-Baselines",type:"NumUpDown",default:1,options:{minValue:{value:1}}},[`plot_label_position_${t}`]:{displayName:"Position of Value on Line(s)",type:"Dropdown",default:"beside",valid:a,items:i},[`plot_label_vpad_${t}`]:{displayName:"Value Vertical Padding",type:"NumUpDown",default:0},[`plot_label_hpad_${t}`]:{displayName:"Value Horizontal Padding",type:"NumUpDown",default:10},[`plot_label_font_${t}`]:aa("Value Font","'Arial', sans-serif"),[`plot_label_size_${t}`]:la("Value Font Size",10),[`plot_label_colour_${t}`]:{displayName:"Value Colour",type:"ColorPicker",default:"#000000"},[`plot_label_prefix_${t}`]:{displayName:"Value Prefix",type:"TextInput",default:""}}},na=(t,e)=>{const i=t=>t.charAt(0).toUpperCase()+t.slice(1);return{[`${t}_colour_improvement`]:{displayName:`Imp. ${i(t)} Colour`,type:"ColorPicker",default:e.improvement},[`${t}_colour_deterioration`]:{displayName:`Det. ${i(t)} Colour`,type:"ColorPicker",default:e.deterioration},[`${t}_colour_neutral_low`]:{displayName:`Neutral (Low) ${i(t)} Colour`,type:"ColorPicker",default:e.neutral_low},[`${t}_colour_neutral_high`]:{displayName:`Neutral (High) ${i(t)} Colour`,type:"ColorPicker",default:e.neutral_high}}},oa=(t,e,i,a=!0)=>{const l={[`show_${t}`]:{displayName:`Show ${e} Lines`,type:"ToggleSwitch",default:i.show},[`width_${t}`]:ta("Line Width",i.width),[`type_${t}`]:ea("Line Type",i.type),[`colour_${t}`]:{displayName:"Line Colour",type:"ColorPicker",default:i.colour},[`opacity_${t}`]:ia("Default Opacity",i.opacity),[`opacity_unselected_${t}`]:ia("Opacity if Any Selected",i.opacity_unselected),[`join_rebaselines_${t}`]:{displayName:"Connect Rebaselined Limits",type:"ToggleSwitch",default:!1},[`ttip_show_${t}`]:{displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},[`ttip_label_${t}`]:{displayName:"Tooltip Label",type:"TextInput",default:`${e} Limit`}};return a&&(l[`ttip_label_${t}_prefix_lower`]={displayName:"Tooltip Label - Lower Prefix",type:"TextInput",default:"Lower "},l[`ttip_label_${t}_prefix_upper`]={displayName:"Tooltip Label - Upper Prefix",type:"TextInput",default:"Upper "}),Object.assign(Object.assign({},l),ra(t,a))},sa=(t,e,i,a=!1)=>{const l={[`show_${t}`]:{displayName:`Show ${e}`,type:"ToggleSwitch",default:i.show},[`width_${t}`]:ta("Main Line"===e?"Main Line Width":"Line Width",i.width),[`type_${t}`]:ea("Main Line"===e?"Main Line Type":"Line Type",i.type),[`colour_${t}`]:{displayName:"Main Line"===e?"Main Line Colour":"Line Colour",type:"ColorPicker",default:i.colour},[`opacity_${t}`]:ia("Default Opacity",i.opacity),[`opacity_unselected_${t}`]:ia("Opacity if Any Selected",i.opacity_unselected),[`join_rebaselines_${t}`]:{displayName:"Connect Rebaselined Limits",type:"ToggleSwitch",default:!1}};return a&&(l[`ttip_show_${t}`]={displayName:"Show value in tooltip",type:"ToggleSwitch",default:!0},l[`ttip_label_${t}`]={displayName:"Tooltip Label",type:"TextInput",default:i.tooltip_label||e}),Object.assign(Object.assign({},l),ra(t,!1))},ua={improvement:"#00B0F0",deterioration:"#E46C0A",neutral_low:"#490092",neutral_high:"#490092",common_cause:"#A6A6A6",limits:"#6495ED",standard:"#000000"},da={font:{default:"'Arial', sans-serif"},size:{default:10},weight:{default:"normal",valid:["normal","bold","bolder","lighter"]},text_transform:{default:"uppercase",valid:["uppercase","lowercase","capitalize","none"]},text_overflow:{default:"ellipsis",valid:["ellipsis","clip","none"]},text_align:{default:"center",valid:["center","left","right"]}},pa={width:{default:1,options:{minValue:{value:0}}},style:{default:"solid",valid:["solid","dotted","dashed","double","groove","ridge","inset","outset","none"]},colour:{default:"#000000"}},ca={canvas:{description:"Canvas Settings",displayName:"Canvas Settings",settingsGroups:{all:{show_errors:{displayName:"Show Errors on Canvas",type:"ToggleSwitch",default:!0},lower_padding:{displayName:"Padding Below Plot (pixels):",type:"NumUpDown",default:10},upper_padding:{displayName:"Padding Above Plot (pixels):",type:"NumUpDown",default:10},left_padding:{displayName:"Padding Left of Plot (pixels):",type:"NumUpDown",default:10},right_padding:{displayName:"Padding Right of Plot (pixels):",type:"NumUpDown",default:10}}}},spc:{description:"SPC Settings",displayName:"Data Settings",settingsGroups:{all:{chart_type:{displayName:"Chart Type",type:"Dropdown",default:"i",valid:["run","i","i_m","i_mm","mr","p","pp","u","up","c","xbar","s","g","t"],items:[{displayName:"run - Run Chart",value:"run"},{displayName:"i - Individual Measurements",value:"i"},{displayName:"i_m - Individual Measurements: Median centerline",value:"i_m"},{displayName:"i_mm - Individual Measurements: Median centerline, Median MR Limits",value:"i_mm"},{displayName:"mr - Moving Range of Individual Measurements",value:"mr"},{displayName:"p - Proportions",value:"p"},{displayName:"p prime - Proportions: Large-Sample Corrected",value:"pp"},{displayName:"u - Rates",value:"u"},{displayName:"u prime - Rates: Large-Sample Correction",value:"up"},{displayName:"c - Counts",value:"c"},{displayName:"xbar - Sample Means",value:"xbar"},{displayName:"s - Sample SDs",value:"s"},{displayName:"g - Number of Non-Events Between Events",value:"g"},{displayName:"t - Time Between Events",value:"t"}]},outliers_in_limits:{displayName:"Keep Outliers in Limit Calcs.",type:"ToggleSwitch",default:!1},multiplier:{displayName:"Multiplier",type:"NumUpDown",default:1,options:{minValue:{value:0}}},sig_figs:{displayName:"Decimals to Report:",type:"NumUpDown",default:2,options:{minValue:{value:0},maxValue:{value:20}}},perc_labels:{displayName:"Report as percentage",type:"Dropdown",default:"Automatic",valid:["Automatic","Yes","No"],items:[{displayName:"Automatic",value:"Automatic"},{displayName:"Yes",value:"Yes"},{displayName:"No",value:"No"}]},split_on_click:{displayName:"Split Limits on Click",type:"ToggleSwitch",default:!1},num_points_subset:{displayName:"Subset Number of Points for Limit Calculations",type:"NumUpDown",default:null},subset_points_from:{displayName:"Subset Points From",type:"Dropdown",default:"Start",valid:["Start","End"],items:[{displayName:"Start",value:"Start"},{displayName:"End",value:"End"}]},ttip_show_date:{displayName:"Show Date in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_date:{displayName:"Date Tooltip Label",type:"TextInput",default:"Automatic"},ttip_show_numerator:{displayName:"Show Numerator in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_numerator:{displayName:"Numerator Tooltip Label",type:"TextInput",default:"Numerator"},ttip_show_denominator:{displayName:"Show Denominator in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_denominator:{displayName:"Denominator Tooltip Label",type:"TextInput",default:"Denominator"},ttip_show_value:{displayName:"Show Value in Tooltip",type:"ToggleSwitch",default:!0},ttip_label_value:{displayName:"Value Tooltip Label",type:"TextInput",default:"Automatic"},ll_truncate:{displayName:"Truncate Lower Limits at:",type:"NumUpDown",default:null},ul_truncate:{displayName:"Truncate Upper Limits at:",type:"NumUpDown",default:null}}}},outliers:{description:"Outlier Settings",displayName:"Outlier Settings",settingsGroups:{General:{process_flag_type:{displayName:"Type of Change to Flag",type:"Dropdown",default:"both",valid:["both","improvement","deterioration"],items:[{displayName:"Both",value:"both"},{displayName:"Improvement (Imp.)",value:"improvement"},{displayName:"Deterioration (Det.)",value:"deterioration"}]},improvement_direction:{displayName:"Improvement Direction",type:"Dropdown",default:"increase",valid:["increase","neutral","decrease"],items:[{displayName:"Increase",value:"increase"},{displayName:"Neutral",value:"neutral"},{displayName:"Decrease",value:"decrease"}]}},"Astronomical Points":Object.assign({astronomical:{displayName:"Highlight Astronomical Points",type:"ToggleSwitch",default:!1},astronomical_limit:{displayName:"Limit for Astronomical Points",type:"Dropdown",default:"3 Sigma",valid:["1 Sigma","2 Sigma","3 Sigma","Specification"],items:[{displayName:"1 Sigma",value:"1 Sigma"},{displayName:"2 Sigma",value:"2 Sigma"},{displayName:"3 Sigma",value:"3 Sigma"},{displayName:"Specification",value:"Specification"}]}},na("ast",ua)),Shifts:Object.assign({shift:{displayName:"Highlight Shifts",type:"ToggleSwitch",default:!1},shift_n:{displayName:"Shift Points",type:"NumUpDown",default:7,options:{minValue:{value:1}}}},na("shift",ua)),Trends:Object.assign({trend:{displayName:"Highlight Trends",type:"ToggleSwitch",default:!1},trend_n:{displayName:"Trend Points",type:"NumUpDown",default:5,options:{minValue:{value:1}}}},na("trend",ua)),"Two-In-Three":Object.assign({two_in_three:{displayName:"Highlight Two-in-Three",type:"ToggleSwitch",default:!1},two_in_three_highlight_series:{displayName:"Highlight all in Pattern",type:"ToggleSwitch",default:!1},two_in_three_limit:{displayName:"Warning Limit for Two-in-Three",type:"Dropdown",default:"2 Sigma",valid:["1 Sigma","2 Sigma","3 Sigma","Specification"],items:[{displayName:"1 Sigma",value:"1 Sigma"},{displayName:"2 Sigma",value:"2 Sigma"},{displayName:"3 Sigma",value:"3 Sigma"},{displayName:"Specification",value:"Specification"}]}},na("twointhree",ua))}},nhs_icons:{description:"NHS Icons Settings",displayName:"NHS Icons Settings",settingsGroups:{all:{show_variation_icons:{displayName:"Show Variation Icons",type:"ToggleSwitch",default:!1},flag_last_point:{displayName:"Flag Only Last Point",type:"ToggleSwitch",default:!0},variation_icons_locations:{displayName:"Variation Icon Locations",type:"Dropdown",default:"Top Right",valid:["Top Right","Bottom Right","Top Left","Bottom Left"],items:[{displayName:"Top Right",value:"Top Right"},{displayName:"Bottom Right",value:"Bottom Right"},{displayName:"Top Left",value:"Top Left"},{displayName:"Bottom Left",value:"Bottom Left"}]},variation_icons_scaling:{displayName:"Scale Variation Icon Size",type:"NumUpDown",default:1,options:{minValue:{value:0}}},show_assurance_icons:{displayName:"Show Assurance Icons",type:"ToggleSwitch",default:!1},assurance_icons_locations:{displayName:"Assurance Icon Locations",type:"Dropdown",default:"Top Right",valid:["Top Right","Bottom Right","Top Left","Bottom Left"],items:[{displayName:"Top Right",value:"Top Right"},{displayName:"Bottom Right",value:"Bottom Right"},{displayName:"Top Left",value:"Top Left"},{displayName:"Bottom Left",value:"Bottom Left"}]},assurance_icons_scaling:{displayName:"Scale Assurance Icon Size",type:"NumUpDown",default:1,options:{minValue:{value:0}}}}}},scatter:{description:"Scatter Settings",displayName:"Scatter Settings",settingsGroups:{all:{show_dots:{displayName:"Show Scatter",type:"ToggleSwitch",default:!0},shape:{displayName:"Shape",type:"Dropdown",default:"Circle",valid:["Circle","Cross","Diamond","Square","Star","Triangle","Wye"],items:[{displayName:"Circle",value:"Circle"},{displayName:"Cross",value:"Cross"},{displayName:"Diamond",value:"Diamond"},{displayName:"Square",value:"Square"},{displayName:"Star",value:"Star"},{displayName:"Triangle",value:"Triangle"},{displayName:"Wye",value:"Wye"}]},size:{displayName:"Size",type:"NumUpDown",default:2.5,options:{minValue:{value:0},maxValue:{value:100}}},colour:{displayName:"Colour",type:"ColorPicker",default:ua.common_cause},colour_outline:{displayName:"Outline Colour",type:"ColorPicker",default:ua.common_cause},width_outline:{displayName:"Outline Width",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:100}}},opacity:{displayName:"Default Opacity",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_selected:{displayName:"Opacity if Selected",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:1}}},opacity_unselected:{displayName:"Opacity if Unselected",type:"NumUpDown",default:.2,options:{minValue:{value:0},maxValue:{value:1}}}}}},lines:{description:"Line Settings",displayName:"Line Settings",settingsGroups:{Main:sa("main","Main Line",{show:!0,width:1,type:"10 0",colour:ua.common_cause,opacity:1,opacity_unselected:.2},!1),Target:sa("target","Target",{show:!0,width:1.5,type:"10 0",colour:ua.standard,opacity:1,opacity_unselected:.2,tooltip_label:"Centerline"},!0),"Alt. Target":Object.assign({show_alt_target:{displayName:"Show Alt. Target Line",type:"ToggleSwitch",default:!1},alt_target:{displayName:"Additional Target Value:",type:"NumUpDown",default:null},multiplier_alt_target:{displayName:"Apply Multiplier to Alt. Target",type:"ToggleSwitch",default:!1}},sa("alt_target","Alt. Target",{show:!1,width:1.5,type:"10 0",colour:ua.standard,opacity:1,opacity_unselected:.2,tooltip_label:"Alt. Target"},!0)),"68% Limits":oa("68","68%",{show:!1,width:2,type:"2 5",colour:ua.limits,opacity:1,opacity_unselected:.2},!0),"95% Limits":oa("95","95%",{show:!0,width:2,type:"2 5",colour:ua.limits,opacity:1,opacity_unselected:.2},!0),"99% Limits":oa("99","99%",{show:!0,width:2,type:"10 10",colour:ua.limits,opacity:1,opacity_unselected:.2},!0),"Specification Limits":Object.assign({show_specification:{displayName:"Show Specification Lines",type:"ToggleSwitch",default:!1},specification_upper:{displayName:"Upper Specification Limit:",type:"NumUpDown",default:null},specification_lower:{displayName:"Lower Specification Limit:",type:"NumUpDown",default:null},multiplier_specification:{displayName:"Apply Multiplier to Specification Limits",type:"ToggleSwitch",default:!1}},oa("specification","specification",{show:!1,width:2,type:"10 10",colour:ua.limits,opacity:1,opacity_unselected:.2},!0)),Trend:sa("trend","Trend",{show:!1,width:1.5,type:"10 0",colour:ua.common_cause,opacity:1,opacity_unselected:.2,tooltip_label:"Centerline"},!0)}},x_axis:{description:"X Axis Settings",displayName:"X Axis Settings",settingsGroups:{Axis:{xlimit_show:{displayName:"Show X Axis",type:"ToggleSwitch",default:!0},xlimit_colour:{displayName:"Axis Colour",type:"ColorPicker",default:ua.standard},xlimit_l:{displayName:"Lower Limit",type:"NumUpDown",default:null},xlimit_u:{displayName:"Upper Limit",type:"NumUpDown",default:null}},Ticks:{xlimit_ticks:{displayName:"Draw Ticks",type:"ToggleSwitch",default:!0},xlimit_tick_count:{displayName:"Maximum Ticks",type:"NumUpDown",default:10,options:{minValue:{value:0},maxValue:{value:100}}},xlimit_tick_font:aa("Tick Font",da.font.default),xlimit_tick_size:la("Tick Font Size",da.size.default),xlimit_tick_colour:{displayName:"Tick Font Colour",type:"ColorPicker",default:ua.standard},xlimit_tick_rotation:{displayName:"Tick Rotation (Degrees)",type:"NumUpDown",default:-35,options:{minValue:{value:-360},maxValue:{value:360}}}},Label:{xlimit_label:{displayName:"Label",type:"TextInput",default:null},xlimit_label_font:aa("Label Font",da.font.default),xlimit_label_size:la("Label Font Size",da.size.default),xlimit_label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:ua.standard}}}},y_axis:{description:"Y Axis Settings",displayName:"Y Axis Settings",settingsGroups:{Axis:{ylimit_show:{displayName:"Show Y Axis",type:"ToggleSwitch",default:!0},ylimit_colour:{displayName:"Axis Colour",type:"ColorPicker",default:ua.standard},limit_multiplier:{displayName:"Axis Scaling Factor",type:"NumUpDown",default:1.5,options:{minValue:{value:0}}},ylimit_sig_figs:{displayName:"Tick Decimal Places",type:"NumUpDown",default:null,options:{minValue:{value:0},maxValue:{value:100}}},ylimit_l:{displayName:"Lower Limit",type:"NumUpDown",default:null},ylimit_u:{displayName:"Upper Limit",type:"NumUpDown",default:null}},Ticks:{ylimit_ticks:{displayName:"Draw Ticks",type:"ToggleSwitch",default:!0},ylimit_tick_count:{displayName:"Maximum Ticks",type:"NumUpDown",default:10,options:{minValue:{value:0},maxValue:{value:100}}},ylimit_tick_font:aa("Tick Font",da.font.default),ylimit_tick_size:la("Tick Font Size",da.size.default),ylimit_tick_colour:{displayName:"Tick Font Colour",type:"ColorPicker",default:ua.standard},ylimit_tick_rotation:{displayName:"Tick Rotation (Degrees)",type:"NumUpDown",default:0,options:{minValue:{value:-360},maxValue:{value:360}}}},Label:{ylimit_label:{displayName:"Label",type:"TextInput",default:null},ylimit_label_font:aa("Label Font",da.font.default),ylimit_label_size:la("Label Font Size",da.size.default),ylimit_label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:ua.standard}}}},dates:{description:"Date Settings",displayName:"Date Settings",settingsGroups:{all:{date_format_day:{displayName:"Day Format",type:"Dropdown",default:"DD",valid:["DD","Thurs DD","Thursday DD","(blank)"],items:[{displayName:"DD",value:"DD"},{displayName:"Thurs DD",value:"Thurs DD"},{displayName:"Thursday DD",value:"Thursday DD"},{displayName:"(blank)",value:"(blank)"}]},date_format_month:{displayName:"Month Format",type:"Dropdown",default:"MM",valid:["MM","Mon","Month","(blank)"],items:[{displayName:"MM",value:"MM"},{displayName:"Mon",value:"Mon"},{displayName:"Month",value:"Month"},{displayName:"(blank)",value:"(blank)"}]},date_format_year:{displayName:"Year Format",type:"Dropdown",default:"YYYY",valid:["YYYY","YY","(blank)"],items:[{displayName:"YYYY",value:"YYYY"},{displayName:"YY",value:"YY"},{displayName:"(blank)",value:"(blank)"}]},date_format_delim:{displayName:"Delimiter",type:"Dropdown",default:"/",valid:["/","-"," "],items:[{displayName:"/",value:"/"},{displayName:"-",value:"-"},{displayName:" ",value:" "}]},date_format_locale:{displayName:"Locale",type:"Dropdown",default:"en-GB",valid:["en-GB","en-US"],items:[{displayName:"en-GB",value:"en-GB"},{displayName:"en-US",value:"en-US"}]}}}},summary_table:{description:"Summary Table Settings",displayName:"Summary Table Settings",settingsGroups:{General:{show_table:{displayName:"Show Summary Table",type:"ToggleSwitch",default:!1},table_variation_filter:{displayName:"Filter by Variation Type",type:"Dropdown",default:"all",valid:["all","common","special","improvement","deterioration","neutral"],items:[{displayName:"All",value:"all"},{displayName:"Common Cause",value:"common"},{displayName:"Special Cause - Any",value:"special"},{displayName:"Special Cause - Improvement",value:"improvement"},{displayName:"Special Cause - Deterioration",value:"deterioration"},{displayName:"Special Cause - Neutral",value:"neutral"}]},table_assurance_filter:{displayName:"Filter by Assurance Type",type:"Dropdown",default:"all",valid:["all","any","pass","fail","inconsistent"],items:[{displayName:"All",value:"all"},{displayName:"Consistent - Any",value:"any"},{displayName:"Consistent Pass",value:"pass"},{displayName:"Consistent Fail",value:"fail"},{displayName:"Inconsistent",value:"inconsistent"}]},table_text_overflow:{displayName:"Text Overflow Handling",type:"Dropdown",default:da.text_overflow.default,valid:da.text_overflow.valid,items:[{displayName:"Ellipsis",value:"ellipsis"},{displayName:"Truncate",value:"clip"},{displayName:"None",value:"none"}]},table_opacity:ia("Default Opacity",1),table_opacity_selected:ia("Opacity if Selected",1),table_opacity_unselected:ia("Opacity if Unselected",.2),table_outer_border_style:{displayName:"Outer Border Style",type:"Dropdown",default:pa.style.default,valid:pa.style.valid,items:Qi},table_outer_border_width:{displayName:"Outer Border Width",type:"NumUpDown",default:pa.width.default,options:pa.width.options},table_outer_border_colour:{displayName:"Outer Border Colour",type:"ColorPicker",default:pa.colour.default},table_outer_border_top:{displayName:"Outer Border Top",type:"ToggleSwitch",default:!0},table_outer_border_bottom:{displayName:"Outer Border Bottom",type:"ToggleSwitch",default:!0},table_outer_border_left:{displayName:"Outer Border Left",type:"ToggleSwitch",default:!0},table_outer_border_right:{displayName:"Outer Border Right",type:"ToggleSwitch",default:!0}},Header:{table_header_font:aa("Header Font",da.font.default),table_header_size:la("Header Font Size",da.size.default),table_header_text_align:{displayName:"Text Alignment",type:"AlignmentGroup",default:da.text_align.default,valid:da.text_align.valid},table_header_font_weight:{displayName:"Header Font Weight",type:"Dropdown",default:da.weight.default,valid:da.weight.valid,items:[{displayName:"Normal",value:"normal"},{displayName:"Bold",value:"bold"}]},table_header_text_transform:{displayName:"Header Text Transform",type:"Dropdown",default:da.text_transform.default,valid:da.text_transform.valid,items:[{displayName:"Uppercase",value:"uppercase"},{displayName:"Lowercase",value:"lowercase"},{displayName:"Capitalise",value:"capitalize"},{displayName:"None",value:"none"}]},table_header_text_padding:{displayName:"Padding Around Text",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:100}}},table_header_colour:{displayName:"Header Font Colour",type:"ColorPicker",default:ua.standard},table_header_bg_colour:{displayName:"Header Background Colour",type:"ColorPicker",default:"#D3D3D3"},table_header_border_style:{displayName:"Header Border Style",type:"Dropdown",default:pa.style.default,valid:pa.style.valid,items:Qi},table_header_border_width:{displayName:"Header Border Width",type:"NumUpDown",default:pa.width.default,options:pa.width.options},table_header_border_colour:{displayName:"Header Border Colour",type:"ColorPicker",default:pa.colour.default},table_header_border_bottom:{displayName:"Bottom Border",type:"ToggleSwitch",default:!0},table_header_border_inner:{displayName:"Inner Borders",type:"ToggleSwitch",default:!0}},Body:{table_body_font:aa("Body Font",da.font.default),table_body_size:la("Body Font Size",da.size.default),table_body_text_align:{displayName:"Text Alignment",type:"AlignmentGroup",default:da.text_align.default,valid:da.text_align.valid},table_body_font_weight:{displayName:"Font Weight",type:"Dropdown",default:da.weight.default,valid:da.weight.valid,items:[{displayName:"Normal",value:"normal"},{displayName:"Bold",value:"bold"}]},table_body_text_transform:{displayName:"Text Transform",type:"Dropdown",default:da.text_transform.default,valid:da.text_transform.valid,items:[{displayName:"Uppercase",value:"uppercase"},{displayName:"Lowercase",value:"lowercase"},{displayName:"Capitalise",value:"capitalize"},{displayName:"None",value:"none"}]},table_body_text_padding:{displayName:"Padding Around Text",type:"NumUpDown",default:1,options:{minValue:{value:0},maxValue:{value:100}}},table_body_colour:{displayName:"Body Font Colour",type:"ColorPicker",default:ua.standard},table_body_bg_colour:{displayName:"Body Background Colour",type:"ColorPicker",default:"#FFFFFF"},table_body_border_style:{displayName:"Body Border Style",type:"Dropdown",default:pa.style.default,valid:pa.style.valid,items:Qi},table_body_border_width:{displayName:"Body Border Width",type:"NumUpDown",default:pa.width.default,options:pa.width.options},table_body_border_colour:{displayName:"Body Border Colour",type:"ColorPicker",default:pa.colour.default},table_body_border_top_bottom:{displayName:"Top/Bottom Borders",type:"ToggleSwitch",default:!0},table_body_border_left_right:{displayName:"Left/Right Borders",type:"ToggleSwitch",default:!0}}}},download_options:{description:"Download Options",displayName:"Download Options",settingsGroups:{all:{show_button:{displayName:"Show Download Button",type:"ToggleSwitch",default:!1}}}},labels:{description:"Labels Settings",displayName:"Labels Settings",settingsGroups:{all:{show_labels:{displayName:"Show Value Labels",type:"ToggleSwitch",default:!0},label_position:{displayName:"Label Position",type:"Dropdown",default:"top",valid:["top","bottom"],items:[{displayName:"Top",value:"top"},{displayName:"Bottom",value:"bottom"}]},label_y_offset:{displayName:"Label Offset from Top/Bottom (px)",type:"NumUpDown",default:20},label_line_offset:{displayName:"Label Offset from Connecting Line (px)",type:"NumUpDown",default:5},label_angle_offset:{displayName:"Label Angle Offset (degrees)",type:"NumUpDown",default:0,options:{minValue:{value:-90},maxValue:{value:90}}},label_font:aa("Label Font",da.font.default),label_size:la("Label Font Size",da.size.default),label_colour:{displayName:"Label Font Colour",type:"ColorPicker",default:ua.standard},label_line_colour:{displayName:"Connecting Line Colour",type:"ColorPicker",default:ua.standard},label_line_width:ta("Connecting Line Width",1),label_line_type:ea("Connecting Line Type","10 0"),label_line_max_length:{displayName:"Max Connecting Line Length (px)",type:"NumUpDown",default:1e3,options:{minValue:{value:0},maxValue:{value:1e4}}},label_marker_show:{displayName:"Show Line Markers",type:"ToggleSwitch",default:!0},label_marker_offset:{displayName:"Marker Offset from Value (px)",type:"NumUpDown",default:5},label_marker_size:{displayName:"Marker Size",type:"NumUpDown",default:3,options:{minValue:{value:0},maxValue:{value:100}}},label_marker_colour:{displayName:"Marker Fill Colour",type:"ColorPicker",default:ua.standard},label_marker_outline_colour:{displayName:"Marker Outline Colour",type:"ColorPicker",default:ua.standard}}}}},ha=[];for(const t in ca){const e=[];for(const i in ca[t].settingsGroups)for(const a in ca[t].settingsGroups[i])e.push([a,ca[t].settingsGroups[i][a]]);ha.push([t,Object.fromEntries(e)])}const ma=Object.fromEntries(ha);function fa(t,e){const i=t.select(".xaxisgroup"),a=t.select(".xaxislabel");if(!e.viewModel.inputSettings.settings[0].x_axis.xlimit_show)return i.remove(),void a.remove();i.empty()&&t.append("g").classed("xaxisgroup",!0),a.empty()&&t.append("text").classed("xaxislabel",!0);const l=e.plotProperties.xAxis,r=ae(e.plotProperties.xScale);l.ticks?(l.tick_count&&r.ticks(l.tick_count),e.viewModel.tickLabels&&r.tickFormat(t=>{const i=e.viewModel.tickLabels.filter(e=>e.x==t);return i.length>0?i[0].label:""})):r.tickValues([]);const n=e.viewModel.svgHeight,o=n-e.plotProperties.yAxis.start_padding,s=e.plotProperties.displayPlot;i.call(r).attr("color",s?l.colour:"#FFFFFF").attr("transform",`translate(0, ${o})`).selectAll(".tick text").style("text-anchor",l.tick_rotation<0?"end":"start").attr("dx",l.tick_rotation<0?"-.8em":".8em").attr("dy",l.tick_rotation<0?"-.15em":".15em").attr("transform","rotate("+l.tick_rotation+")").style("font-size",l.tick_size).style("font-family",l.tick_font).style("fill",s?l.tick_colour:"#FFFFFF");const u=e.viewModel.svgWidth/2;let d;if(e.viewModel.frontend)d=n-e.plotProperties.yAxis.start_padding/3;else{const e=t.selectAll(".xaxisgroup").node();if(!e)return void t.select(".xaxislabel").style("fill",s?l.label_colour:"#FFFFFF");d=n-(n-e.getBoundingClientRect().bottom)/2}t.select(".xaxislabel").attr("x",u).attr("y",d).style("text-anchor","middle").text(l.label).style("font-size",l.label_size).style("font-family",l.label_font).style("fill",s?l.label_colour:"#FFFFFF")}function ya(t){return null==t}function ga(t,e){const i=t.select(".yaxisgroup"),a=t.select(".yaxislabel");if(!e.viewModel.inputSettings.settings[0].y_axis.ylimit_show)return i.remove(),void a.remove();i.empty()&&t.append("g").classed("yaxisgroup",!0),a.empty()&&t.append("text").classed("yaxislabel",!0);const l=e.plotProperties.yAxis,r=le(e.plotProperties.yScale),n=e.viewModel.inputSettings.settings[0].y_axis.ylimit_sig_figs,o=ya(n)?e.viewModel.inputSettings.settings[0].spc.sig_figs:n,s=e.plotProperties.displayPlot;if(l.ticks){if(l.tick_count&&r.ticks(l.tick_count),e.viewModel.inputData.length>0&&e.viewModel.inputData[0]){const t=e.viewModel.inputSettings.derivedSettings[0];r.tickFormat(e=>t.percentLabels?e.toFixed(o)+"%":e.toFixed(o))}}else r.tickValues([]);let u;i.call(r).attr("color",s?l.colour:"#FFFFFF").attr("transform",`translate(${e.plotProperties.xAxis.start_padding}, 0)`).selectAll(".tick text").style("text-anchor","right").attr("transform",`rotate(${l.tick_rotation})`).style("font-size",l.tick_size).style("font-family",l.tick_font).style("fill",s?l.tick_colour:"#FFFFFF");const d=e.viewModel.svgHeight/2;if(e.viewModel.frontend)u=e.plotProperties.xAxis.start_padding/2;else{const e=t.selectAll(".yaxisgroup").node();if(!e)return void t.select(".yaxislabel").style("fill",s?l.label_colour:"#FFFFFF");u=.7*e.getBoundingClientRect().x}t.select(".yaxislabel").attr("x",u).attr("y",d).attr("transform",`rotate(-90, ${u}, ${d})`).text(l.label).style("text-anchor","middle").style("font-size",l.label_size).style("font-family",l.label_font).style("fill",s?l.label_colour:"#FFFFFF")}function _a(t,e){const i=e.plotProperties,a=e.viewModel.colourPalette.isHighContrast?e.viewModel.colourPalette.foregroundColour:"black",l=t.select(".ttip-line-x").attr("x1",0).attr("x2",0).attr("y1",i.yAxis.end_padding).attr("y2",e.viewModel.svgHeight-i.yAxis.start_padding).attr("stroke-width","1px").attr("stroke",a).style("stroke-opacity",0),r=t.select(".ttip-line-y").attr("x1",i.xAxis.start_padding).attr("x2",e.viewModel.svgWidth-i.xAxis.end_padding).attr("y1",0).attr("y2",0).attr("stroke-width","1px").attr("stroke",a).style("stroke-opacity",0);t.on("mousemove",t=>{if(!i.displayPlot)return;const a=e.viewModel.plotPoints[0],n=e.svg.node().getBoundingClientRect(),o=t.pageX-n.left;let s,u,d,p=1/0;for(let t=0;t<a.length;t++){const e=i.xScale(a[t].x),l=Math.abs(e-o);l<p&&(p=l,s=t,u=e,d=i.yScale(a[t].value))}e.host.tooltipService.show({dataItems:a[s].tooltip,identities:[a[s].identity],coordinates:[u,d],isTouchEvent:!1}),l.style("stroke-opacity",.4).attr("x1",u).attr("x2",u),r.style("stroke-opacity",.4).attr("y1",d).attr("y2",d)}).on("mouseleave",()=>{i.displayPlot&&(e.host.tooltipService.hide({immediately:!0,isTouchEvent:!1}),l.style("stroke-opacity",0),r.style("stroke-opacity",0))})}const va={ll99:"99",ll95:"95",ll68:"68",ul68:"68",ul95:"95",ul99:"99",targets:"target",values:"main",alt_targets:"alt_target",speclimits_lower:"specification",speclimits_upper:"specification",trend_line:"trend"};function wa(t,e,i,a){const l=i+"_"+(e.includes("line")?va[t]:t);return a[e][l]}function ba(t,e,i){let a=!0;return ya(e)||(a=a&&t>=e),ya(i)||(a=a&&t<=i),a}function xa(t,e){const i=e.plotProperties.yAxis.lower,a=e.plotProperties.yAxis.upper,l=e.plotProperties.xAxis.lower,r=e.plotProperties.xAxis.upper;t.select(".linesgroup").selectAll(".linegroup").data(e.viewModel.groupedLines).join("g").classed("linegroup",!0).each(function(t){const n=t[0],o=t[1].filter(t=>ba(t.x,l,r)),s=o.length;let u=new Array(s),d=!1,p=new Array(s),c=new Array(s);for(let t=0;t<s;t++){const l=o[t];p[t]=e.plotProperties.xScale(l.x),c[t]=e.plotProperties.yScale(l.line_value),u[t]=!ya(l.line_value)&&ba(l.line_value,i,a),d=d||u[t]}d?ut(this).selectAll("line").data(o.slice(1)).join("line").attr("x1",(t,e)=>u[e]?p[e]:p[e+1]).attr("y1",(t,e)=>u[e]?c[e]:c[e+1]).attr("x2",(t,e)=>u[e+1]?p[e+1]:p[e]).attr("y2",(t,e)=>u[e+1]?c[e+1]:c[e]).attr("fill","none").attr("stroke",t=>e.viewModel.colourPalette.isHighContrast?e.viewModel.colourPalette.foregroundColour:wa(n,"lines","colour",{lines:t.aesthetics})).attr("stroke-width",t=>wa(n,"lines","width",{lines:t.aesthetics})).attr("stroke-dasharray",t=>wa(n,"lines","type",{lines:t.aesthetics})).attr("stroke-dashoffset",(t,i)=>{const a=e.plotProperties.xScale(o[0].x);return e.plotProperties.xScale(o[i].x)-a}):ut(this).selectAll("line").remove()})}function ka(t,e){if(!e.viewModel.inputSettings.settings[0].scatter.show_dots)return void t.select(".dotsgroup").selectAll("path").data([]).join("path").remove();const i=e.plotProperties.yAxis.lower,a=e.plotProperties.yAxis.upper,l=e.plotProperties.xAxis.lower,r=e.plotProperties.xAxis.upper;t.select(".dotsgroup").selectAll("path").data(e.viewModel.plotPoints[0]).join("path").filter(t=>!ya(t.value)).attr("d",t=>{const e=t.aesthetics.shape,i=t.aesthetics.size;return Yt().type(qi[`symbol${e}`]).size(i*i*Math.PI)()}).attr("transform",t=>ba(t.value,i,a)&&ba(t.x,l,r)?`translate(${e.plotProperties.xScale(t.x)}, ${e.plotProperties.yScale(t.value)})`:"translate(0, 0) scale(0)").style("fill",t=>t.aesthetics.colour).style("stroke",t=>t.aesthetics.colour_outline).style("stroke-width",t=>t.aesthetics.width_outline).on("click",(t,i)=>{if(e.host.hostCapabilities.allowInteractions){if(e.viewModel.inputSettings.settings[0].spc.split_on_click){const t=e.viewModel.splitIndexes.indexOf(i.x);t>-1?e.viewModel.splitIndexes.splice(t,1):e.viewModel.splitIndexes.push(i.x),e.host.persistProperties({replace:[{objectName:"split_indexes_storage",selector:void 0,properties:{split_indexes:JSON.stringify(e.viewModel.splitIndexes)}}]})}else e.selectionManager.select(i.identity,t.ctrlKey||t.metaKey).then(()=>{e.updateHighlighting()});t.stopPropagation()}}).on("mouseover",(t,i)=>{const a=t.pageX,l=t.pageY;e.host.tooltipService.show({dataItems:i.tooltip,identities:[i.identity],coordinates:[a,l],isTouchEvent:!1})}).on("mouseout",()=>{e.host.tooltipService.hide({immediately:!0,isTouchEvent:!1})}),t.on("click",()=>{e.selectionManager.clear(),e.updateHighlighting()})}var Na=Object.freeze({__proto__:null,commonCause:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#A6A6A6").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#A6A6A6").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M106.903 196.084 144.607 228.433 138.766 235.241 101.062 202.892Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M146.159 218.909 179.921 159.846 187.708 164.298 153.946 223.361Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M198.708 154.94 239.365 214.134 231.971 219.212 191.314 160.019Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M238.825 216.117 285.383 198.784 288.512 207.19 241.954 224.523Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M76.5001 195C76.5001 183.678 85.6782 174.5 97.0001 174.5 108.322 174.5 117.5 183.678 117.5 195 117.5 206.322 108.322 215.5 97.0001 215.5 85.6782 215.5 76.5001 206.322 76.5001 195Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M123.5 233C123.5 221.678 132.678 212.5 144 212.5 155.322 212.5 164.5 221.678 164.5 233 164.5 244.322 155.322 253.5 144 253.5 132.678 253.5 123.5 244.322 123.5 233Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M170.5 153.5C170.5 141.902 179.902 132.5 191.5 132.5 203.098 132.5 212.5 141.902 212.5 153.5 212.5 165.098 203.098 174.5 191.5 174.5 179.902 174.5 170.5 165.098 170.5 153.5Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M217.5 221.5C217.5 209.902 226.902 200.5 238.5 200.5 250.098 200.5 259.5 209.902 259.5 221.5 259.5 233.098 250.098 242.5 238.5 242.5 226.902 242.5 217.5 233.098 217.5 221.5Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd"),t.append("path").attr("d","M265.5 206.5C265.5 194.902 274.678 185.5 286 185.5 297.322 185.5 306.5 194.902 306.5 206.5 306.5 218.098 297.322 227.5 286 227.5 274.678 227.5 265.5 218.098 265.5 206.5Z").attr("stroke","#A6A6A6").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#A6A6A6").attr("fill-rule","evenodd")},concernHigh:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M0 155.53C-1.9801e-14 69.6331 69.6331-1.9801e-14 155.53-3.96021e-14 241.427-7.92042e-14 311.06 69.6331 311.06 155.53 311.06 241.427 241.427 311.06 155.53 311.06 69.6331 311.06-9.90052e-14 241.427 0 155.53Z").attr("stroke","#E46C0A").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 17.47 328.36)"),t.append("path").attr("d","M0 151C-1.92243e-14 67.605 67.605-1.92243e-14 151-3.84486e-14 234.395-7.68973e-14 302 67.605 302 151 302 234.395 234.395 302 151 302 67.605 302-9.61216e-14 234.395 0 151Z").attr("stroke","#E46C0A").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 38 340)"),t.append("text").attr("fill","#E46C0A").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(106.228 172) scale(10, 10)").text("H"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.919094 0.394039 0.394039 -0.919094 95.4025 215.096)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.880045 -0.47489 -0.47489 -0.880045 149.897 232.457)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.715824 -0.698281 -0.698281 -0.715824 199.882 206.276)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.937161 0.348898 0.348898 -0.937161 238.113 168.387)"),t.append("path").attr("d","M0 21C-2.60992e-15 9.40202 9.17816-2.67358e-15 20.5-5.34716e-15 31.8218-1.06943e-14 41 9.40202 41 21 41 32.598 31.8218 42 20.5 42 9.17816 42-1.30496e-14 32.598 0 21Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 76.5001 231.5)"),t.append("path").attr("d","M0 20.5C-2.60992e-15 9.17816 9.17816-2.60992e-15 20.5-5.21985e-15 31.8218-1.04397e-14 41 9.17816 41 20.5 41 31.8218 31.8218 41 20.5 41 9.17816 41-1.30496e-14 31.8218 0 20.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 123.5 249.5)"),t.append("path").attr("d","M0 21C-2.67358e-15 9.40202 9.40202-2.67358e-15 21-5.34716e-15 32.598-1.06943e-14 42 9.40202 42 21 42 32.598 32.598 42 21 42 9.40202 42-1.33679e-14 32.598 0 21Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 170.5 231.5)"),t.append("path").attr("d","M0 20.5C-2.67358e-15 9.17816 9.40202-2.60992e-15 21-5.21985e-15 32.598-1.04397e-14 42 9.17816 42 20.5 42 31.8218 32.598 41 21 41 9.40202 41-1.33679e-14 31.8218 0 20.5Z").attr("stroke","#E46C0A").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#E46C0A").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 217.5 185.5)"),t.append("path").attr("d","M0 20.5C-2.60992e-15 9.17816 9.17816-2.60992e-15 20.5-5.21985e-15 31.8218-1.04397e-14 41 9.17816 41 20.5 41 31.8218 31.8218 41 20.5 41 9.17816 41-1.30496e-14 31.8218 0 20.5Z").attr("stroke","#E46C0A").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#E46C0A").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 265.5 200.5)")},concernLow:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#E46C0A").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#E46C0A").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("text").attr("fill","#E46C0A").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(106.228 292) scale(10, 10)").text("L"),t.append("path").attr("d","M95.4025 162.857 141.063 143.281 144.597 151.525 98.9371 171.101Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M149.897 145.496 193.618 169.089 189.358 176.983 145.638 153.39Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M199.882 171.677 235.443 206.367 229.18 212.788 193.618 178.098Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M238.113 209.566 284.671 192.233 287.8 200.639 241.243 217.972Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M76.5001 168.5C76.5001 156.902 85.6782 147.5 97.0001 147.5 108.322 147.5 117.5 156.902 117.5 168.5 117.5 180.098 108.322 189.5 97.0001 189.5 85.6782 189.5 76.5001 180.098 76.5001 168.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M123.5 150C123.5 138.678 132.678 129.5 144 129.5 155.322 129.5 164.5 138.678 164.5 150 164.5 161.322 155.322 170.5 144 170.5 132.678 170.5 123.5 161.322 123.5 150Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M170.5 168.5C170.5 156.902 179.902 147.5 191.5 147.5 203.098 147.5 212.5 156.902 212.5 168.5 212.5 180.098 203.098 189.5 191.5 189.5 179.902 189.5 170.5 180.098 170.5 168.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M217.5 214C217.5 202.678 226.902 193.5 238.5 193.5 250.098 193.5 259.5 202.678 259.5 214 259.5 225.322 250.098 234.5 238.5 234.5 226.902 234.5 217.5 225.322 217.5 214Z").attr("stroke","#E46C0A").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#E46C0A").attr("fill-rule","evenodd"),t.append("path").attr("d","M265.5 199C265.5 187.678 274.678 178.5 286 178.5 297.322 178.5 306.5 187.678 306.5 199 306.5 210.322 297.322 219.5 286 219.5 274.678 219.5 265.5 210.322 265.5 199Z").attr("stroke","#E46C0A").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#E46C0A").attr("fill-rule","evenodd")},consistentFail:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#FF6600").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#FF6600").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("text").attr("fill","#FF6600").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(155.851 158) scale(10, 10)").text("F"),t.append("path").attr("d","M38.5001 185.5 340.862 185.5").attr("stroke","#FF6600").attr("stroke-width","8.66667").attr("stroke-miterlimit","8").attr("stroke-dasharray","26 8.66667").attr("fill","none").attr("fill-rule","evenodd"),t.append("path").attr("d","M72.5001 238.762C89.0456 218.168 107.725 200.801 129.638 200.507 152.134 201.459 176.57 238.689 192.563 241.313 206.31 244.118 205.897 217.733 212.814 216.659 217.563 215.414 220.151 238.182 233.066 240.463 248.557 243.786 291.62 234.385 302.5 236.212").attr("stroke","#7F7F7F").attr("stroke-width","10.66667").attr("stroke-miterlimit","8").attr("fill","none").attr("fill-rule","evenodd")},consistentPass:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#0072C6").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#0072C6").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("text").attr("fill","#0072C6").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(155.851 158) scale(10, 10)").text("P"),t.append("path").attr("d","M55.5001 257.5 323.847 257.5").attr("stroke","#0072C6").attr("stroke-width","8.66667").attr("stroke-miterlimit","8").attr("stroke-dasharray","26 8.66667").attr("fill","none").attr("fill-rule","evenodd"),t.append("path").attr("d","M72.5001 238.762C89.0456 218.168 107.725 200.801 129.638 200.507 152.134 201.459 176.57 238.689 192.563 241.313 206.31 244.118 205.897 217.733 212.814 216.659 217.563 215.414 220.151 238.182 233.066 240.463 248.557 243.786 291.62 234.385 302.5 236.212").attr("stroke","#7F7F7F").attr("stroke-width","10.66667").attr("stroke-miterlimit","8").attr("fill","none").attr("fill-rule","evenodd")},improvementHigh:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M0 155.53C-1.9801e-14 69.6331 69.6331-1.9801e-14 155.53-3.96021e-14 241.427-7.92042e-14 311.06 69.6331 311.06 155.53 311.06 241.427 241.427 311.06 155.53 311.06 69.6331 311.06-9.90052e-14 241.427 0 155.53Z").attr("stroke","#00B0F0").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 17.47 328.36)"),t.append("path").attr("d","M0 151C-1.92243e-14 67.605 67.605-1.92243e-14 151-3.84486e-14 234.395-7.68973e-14 302 67.605 302 151 302 234.395 234.395 302 151 302 67.605 302-9.61216e-14 234.395 0 151Z").attr("stroke","#00B0F0").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 38 340)"),t.append("text").attr("fill","#00B0F0").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(106.228 172) scale(10, 10)").text("H"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.919094 0.394039 0.394039 -0.919094 95.4025 215.096)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.880045 -0.47489 -0.47489 -0.880045 149.897 232.457)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.715824 -0.698281 -0.698281 -0.715824 199.882 206.276)"),t.append("rect").attr("x","0").attr("y","0").attr("width","49.6797").attr("height","8.97008").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("transform","matrix(0.937161 0.348898 0.348898 -0.937161 238.113 168.387)"),t.append("path").attr("d","M0 21C-2.60992e-15 9.40202 9.17816-2.67358e-15 20.5-5.34716e-15 31.8218-1.06943e-14 41 9.40202 41 21 41 32.598 31.8218 42 20.5 42 9.17816 42-1.30496e-14 32.598 0 21Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 76.5001 231.5)"),t.append("path").attr("d","M0 20.5C-2.60992e-15 9.17816 9.17816-2.60992e-15 20.5-5.21985e-15 31.8218-1.04397e-14 41 9.17816 41 20.5 41 31.8218 31.8218 41 20.5 41 9.17816 41-1.30496e-14 31.8218 0 20.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 123.5 249.5)"),t.append("path").attr("d","M0 21C-2.67358e-15 9.40202 9.40202-2.67358e-15 21-5.34716e-15 32.598-1.06943e-14 42 9.40202 42 21 42 32.598 32.598 42 21 42 9.40202 42-1.33679e-14 32.598 0 21Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 170.5 231.5)"),t.append("path").attr("d","M0 20.5C-2.67358e-15 9.17816 9.40202-2.60992e-15 21-5.21985e-15 32.598-1.04397e-14 42 9.17816 42 20.5 42 31.8218 32.598 41 21 41 9.40202 41-1.33679e-14 31.8218 0 20.5Z").attr("stroke","#00B0F0").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#00B0F0").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 217.5 185.5)"),t.append("path").attr("d","M0 20.5C-2.60992e-15 9.17816 9.17816-2.60992e-15 20.5-5.21985e-15 31.8218-1.04397e-14 41 9.17816 41 20.5 41 31.8218 31.8218 41 20.5 41 9.17816 41-1.30496e-14 31.8218 0 20.5Z").attr("stroke","#00B0F0").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#00B0F0").attr("fill-rule","evenodd").attr("transform","matrix(1 0 0 -1 265.5 200.5)")},improvementLow:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#00B0F0").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#00B0F0").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("text").attr("fill","#00B0F0").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(106.228 292) scale(10, 10)").text("L"),t.append("path").attr("d","M95.4025 162.857 141.063 143.281 144.597 151.525 98.9371 171.101Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M149.897 145.496 193.618 169.089 189.358 176.983 145.638 153.39Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M199.882 171.677 235.443 206.367 229.18 212.788 193.618 178.098Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M238.113 209.566 284.671 192.233 287.8 200.639 241.243 217.972Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M76.5001 168.5C76.5001 156.902 85.6782 147.5 97.0001 147.5 108.322 147.5 117.5 156.902 117.5 168.5 117.5 180.098 108.322 189.5 97.0001 189.5 85.6782 189.5 76.5001 180.098 76.5001 168.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M123.5 150C123.5 138.678 132.678 129.5 144 129.5 155.322 129.5 164.5 138.678 164.5 150 164.5 161.322 155.322 170.5 144 170.5 132.678 170.5 123.5 161.322 123.5 150Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M170.5 168.5C170.5 156.902 179.902 147.5 191.5 147.5 203.098 147.5 212.5 156.902 212.5 168.5 212.5 180.098 203.098 189.5 191.5 189.5 179.902 189.5 170.5 180.098 170.5 168.5Z").attr("stroke","#7F7F7F").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#7F7F7F").attr("fill-rule","evenodd"),t.append("path").attr("d","M217.5 214C217.5 202.678 226.902 193.5 238.5 193.5 250.098 193.5 259.5 202.678 259.5 214 259.5 225.322 250.098 234.5 238.5 234.5 226.902 234.5 217.5 225.322 217.5 214Z").attr("stroke","#00B0F0").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#00B0F0").attr("fill-rule","evenodd"),t.append("path").attr("d","M265.5 199C265.5 187.678 274.678 178.5 286 178.5 297.322 178.5 306.5 187.678 306.5 199 306.5 210.322 297.322 219.5 286 219.5 274.678 219.5 265.5 210.322 265.5 199Z").attr("stroke","#00B0F0").attr("stroke-width","2.66667").attr("stroke-miterlimit","8").attr("fill","#00B0F0").attr("fill-rule","evenodd")},inconsistent:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 173.345C17.47 87.1637 87.1031 17.3 173 17.3 258.897 17.3 328.53 87.1637 328.53 173.345 328.53 259.526 258.897 329.39 173 329.39 87.1031 329.39 17.47 259.526 17.47 173.345Z").attr("stroke","#BFBFBF").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189.5C38 105.829 105.605 38 189 38 272.395 38 340 105.829 340 189.5 340 273.171 272.395 341 189 341 105.605 341 38 273.171 38 189.5Z").attr("stroke","#BFBFBF").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("text").attr("fill","#7F7F7F").attr("font-family","Arial,Arial_MSFontService,sans-serif").attr("font-weight","700").attr("font-size","11.7").attr("transform","translate(155.851 158) scale(10, 10)").text("?"),t.append("path").attr("d","M38.5001 222.5 340.862 222.5").attr("stroke","#BFBFBF").attr("stroke-width","8.66667").attr("stroke-miterlimit","8").attr("stroke-dasharray","26 8.66667").attr("fill","none").attr("fill-rule","evenodd"),t.append("path").attr("d","M72.5001 239.762C89.0456 219.168 107.725 201.801 129.638 201.507 152.134 202.459 176.57 239.689 192.563 242.313 206.31 245.118 205.897 218.733 212.814 217.659 217.563 216.414 220.151 239.182 233.066 241.463 248.557 244.786 291.62 235.385 302.5 237.212").attr("stroke","#7F7F7F").attr("stroke-width","10.66667").attr("stroke-miterlimit","8").attr("fill","none").attr("fill-rule","evenodd")},neutralHigh:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#490092").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#490092").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M103.652 242.245 180.02 165.878 151.735 137.593 258.273 119.68 240.359 226.217 212.075 197.933 135.708 274.3Z").attr("fill","#490092").attr("fill-rule","evenodd")},neutralLow:function(t){t.append("g").attr("clip-path","url(#clip2)").append("g").attr("clip-path","url(#clip3)").attr("filter","url(#fx0)").attr("transform","translate(16 25)").append("g").attr("clip-path","url(#clip4)").append("path").attr("d","M17.47 172.83C17.47 86.9332 87.1031 17.3 173 17.3 258.897 17.3 328.53 86.9332 328.53 172.83 328.53 258.727 258.897 328.36 173 328.36 87.1031 328.36 17.47 258.727 17.47 172.83Z").attr("stroke","#490092").attr("stroke-width","21").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M38 189C38 105.605 105.605 38 189 38 272.395 38 340 105.605 340 189 340 272.395 272.395 340 189 340 105.605 340 38 272.395 38 189Z").attr("stroke","#490092").attr("stroke-width","20").attr("stroke-miterlimit","8").attr("fill","#FFFFFF").attr("fill-rule","evenodd"),t.append("path").attr("d","M135.708 103.652 212.075 180.02 240.359 151.735 258.273 258.273 151.735 240.359 180.02 212.075 103.652 135.708Z").attr("fill","#490092").attr("fill-rule","evenodd")}});function Ma(t,e,i,a,l){const r=e/378*.08*a;return`scale(${r}) translate(${i.includes("Right")?t/r-(378+378*l):i.includes("Centre")?t/r/2-189:378*l}, ${i.includes("Bottom")?e/r-378:i.includes("Centre")?e/r/2-189:0})`}function Aa(t,e,i){const a=t.append("g").classed("icongroup",!0);i&&a.attr("transform",i);const l=a.append("defs"),r=l.append("filter").attr("id","fx0").attr("x","-10%").attr("y","-10%").attr("width","120%").attr("height","120%").attr("filterUnits","userSpaceOnUse").attr("userSpaceOnUse","userSpaceOnUse"),n=r.append("feComponentTransfer").attr("color-interpolation-filters","sRGB");n.append("feFuncR").attr("type","discrete").attr("tableValues","0 0"),n.append("feFuncG").attr("type","discrete").attr("tableValues","0 0"),n.append("feFuncB").attr("type","discrete").attr("tableValues","0 0"),n.append("feFuncA").attr("type","linear").attr("slope","0.4").attr("intercept","0"),r.append("feGaussianBlur").attr("stdDeviation","1.77778 1.77778"),l.append("clipPath").attr("id","clip1").append("rect").attr("x","0").attr("y","0").attr("width","378").attr("height","378"),l.append("clipPath").attr("id","clip2").append("path").attr("d","M189 38C105.605 38 38 105.605 38 189 38 272.395 105.605 340 189 340 272.395 340 340 272.395 340 189 340 105.605 272.395 38 189 38ZM5.63264e-06 5.63264e-06 378 5.63264e-06 378 378 5.63264e-06 378Z").attr("fill-rule","evenodd").attr("clip-rule","evenodd"),l.append("clipPath").attr("id","clip3").append("rect").attr("x","-2").attr("y","-2").attr("width","346").attr("height","346"),a.append("g").classed(e,!0).attr("clip-path","url(#clip1)").append("rect").attr("x","0").attr("y","0").attr("width","378").attr("height","378").attr("fill","#FFFFFF")}function Fa(t,e,i){var a;if(!i.chart_type_props.has_control_limits)return"none";const l=e.outliers.improvement_direction,r=t.ll99.length-1,n=null===(a=null==t?void 0:t.alt_targets)||void 0===a?void 0:a[r];if(ya(n)||"neutral"===l)return"none";const o="increase"===l;return n>t.ul99[r]?o?"consistentFail":"consistentPass":n<t.ll99[r]?o?"consistentPass":"consistentFail":"inconsistent"}function Sa(t,e){const i={increase:"High",decrease:"Low",neutral:""}[e.outliers.improvement_direction];let a;if(e.nhs_icons.flag_last_point){const e=t.astpoint.length-1;a=[t.astpoint[e],t.shift[e],t.trend[e],t.two_in_three[e]]}else a=t.astpoint.concat(t.shift,t.trend,t.two_in_three);const l=new Array;return a.includes("improvement")&&l.push("improvement"+i),a.includes("deterioration")&&l.push("concern"+{High:"Low",Low:"High","":""}[i]),a.includes("neutral_low")&&l.push("neutralLow"),a.includes("neutral_high")&&l.push("neutralHigh"),0===l.length&&l.push("commonCause"),l}function Ca(t,e){if(t.selectAll(".icongroup").remove(),!e.plotProperties.displayPlot)return;const i=e.viewModel.inputSettings.settings[0].nhs_icons,a=i.show_variation_icons,l=i.variation_icons_locations,r=e.viewModel.svgWidth,n=e.viewModel.svgHeight;let o=0;if(a){const a=i.variation_icons_scaling,s=Sa(e.viewModel.outliers[0],e.viewModel.inputSettings.settings[0]);s.forEach((e,i)=>{t.call(Aa,e,Ma(r,n,l,a,i)).selectAll(`.${e}`).call(Na[e])}),o=s.length}if(i.show_assurance_icons){const a=i.assurance_icons_locations,s=i.assurance_icons_scaling,u=e.viewModel.inputSettings.settings[0],d=e.viewModel.inputSettings.derivedSettings[0],p=Fa(e.viewModel.controlLimits[0],u,d);if("none"===p)return;const c=o>0&&l===a?o:0;t.call(Aa,p,Ma(r,n,a,s,c)).selectAll(`.${p}`).call(Na[p])}}function Ta(t,e){e.plotProperties.displayPlot||e.viewModel.inputSettings.settings[0].summary_table.show_table||e.viewModel.showGrouped?t.on("contextmenu",t=>{const i=ut(t.target).datum();e.selectionManager.showContextMenu(i?i.identity:{},{x:t.clientX,y:t.clientY}),t.preventDefault()}):t.on("contextmenu",()=>{})}function $a(t,e=!1){e&&t.selectChildren().remove(),t.append("line").classed("ttip-line-x",!0),t.append("line").classed("ttip-line-y",!0),t.append("g").classed("xaxisgroup",!0),t.append("text").classed("xaxislabel",!0),t.append("g").classed("yaxisgroup",!0),t.append("text").classed("yaxislabel",!0),t.append("g").classed("linesgroup",!0),t.append("g").classed("dotsgroup",!0)}function Da(t,e,i,a,l=null){t.call($a,!0);const r=t.append("g").classed("errormessage",!0);if(l){const t={internal:"Internal Error! Please file a bug report with the following text:",settings:"Invalid settings provided for all observations! First error:"};r.append("text").attr("x",e.viewport.width/2).attr("y",e.viewport.height/3).style("text-anchor","middle").text(t[l]).style("font-size","10px").style("fill",i.foregroundColour)}r.append("text").attr("x",e.viewport.width/2).attr("y",e.viewport.height/2).style("text-anchor","middle").text(a).style("font-size","10px").style("fill",i.foregroundColour)}function Pa(t,e){const i=e.getSelectionIds();var a=!1;for(const e of i)if(Array.isArray(t)){for(const i of t)if(e===i){a=!0;break}}else if(e===t){a=!0;break}return a}function La(t,e,i,a){const l=t.select(".table-header").selectAll("th").data(e).join("th");l.selectAll("text").data(t=>[t.label]).join("text").text(t=>t).style("font-size",`${i.table_header_size}px`).style("font-family",i.table_header_font).style("color",i.table_header_colour),l.style("padding",`${i.table_header_text_padding}px`).style("background-color",i.table_header_bg_colour).style("font-weight",i.table_header_font_weight).style("text-transform",i.table_header_text_transform).style("text-align",i.table_header_text_align).style("border-width",`${i.table_header_border_width}px`).style("border-style",i.table_header_border_style).style("border-color",i.table_header_border_colour).style("border-top","inherit"),i.table_header_border_bottom||l.style("border-bottom","none"),i.table_header_border_inner||l.style("border-left","none").style("border-right","none"),"none"!==i.table_text_overflow?l.style("overflow","hidden").style("max-width",`${a}px`).style("text-overflow",i.table_text_overflow):l.style("overflow","auto").style("max-width","none")}function Ea(t,e,i,a,l){const r=t.select(".table-body").selectAll("tr").data(i).join("tr").on("click",(t,i)=>{if(e.host.hostCapabilities.allowInteractions){const a=Pa(i.identity,e.selectionManager);e.selectionManager.select(i.identity,a||t.ctrlKey||t.metaKey).then(()=>e.updateHighlighting()),t.stopPropagation()}}).on("mouseover",t=>{ut(t.target).select(function(){return this.closest("td")}).style("background-color","lightgray")}).on("mouseout",t=>{var e,i;let a=ut(t.target).select(function(){return this.closest("td")}),l=ut(a.node().parentNode).datum();a.style("background-color",null!==(i=null===(e=l.aesthetics)||void 0===e?void 0:e.table_body_bg_colour)&&void 0!==i?i:"inherit")});"none"!==a.table_text_overflow?r.style("overflow","hidden").style("max-width",`${l}px`).style("text-overflow",a.table_text_overflow):r.style("overflow","auto").style("max-width","none")}function Ia(t,e){t.select(".table-group").style("border-width",`${e.table_outer_border_width}px`).style("border-style",e.table_outer_border_style).style("border-color",e.table_outer_border_colour),["top","right","bottom","left"].forEach(i=>{e[`table_outer_border_${i}`]||t.select(".table-group").style(`border-${i}`,"none")}),t.selectAll("th:first-child").style("border-left","inherit"),t.selectAll("th:last-child").style("border-right","inherit"),t.selectAll("td:first-child").style("border-left","inherit"),t.selectAll("td:last-child").style("border-right","inherit"),t.selectAll("tr:first-child").selectAll("td").style("border-top","inherit"),t.selectAll("tr:last-child").selectAll("td").style("border-bottom","inherit")}function Oa(t,e,i,a){const l=t.select(".table-body").selectAll("tr").selectAll("td").data(t=>e.map(e=>({column:e.name,value:t.table_row[e.name]}))).join("td"),r=i.nhs_icons.show_variation_icons||i.nhs_icons.show_assurance_icons,n=l.node().getBoundingClientRect();l.each(function(t){var e;const l=ut(this),o=ut(l.property("parentNode")).datum();if(a&&r&&("variation"===t.column||"assurance"===t.column)){if("none"!==t.value){const e=i.nhs_icons[`${t.column}_icons_scaling`];l.append("svg").attr("width",.5*n.width*e+"px").attr("viewBox","0 0 378 378").classed("rowsvg",!0).call(Aa,t.value).selectAll(".icongroup").selectAll(`.${t.value}`).call(Na[t.value])}}else{const e="number"==typeof t.value?t.value.toFixed(i.spc.sig_figs):t.value;l.text(e).classed("cell-text",!0)}const s=(null===(e=o.aesthetics)||void 0===e?void 0:e.table_body_bg_colour)?o.aesthetics:i.summary_table;l.style("background-color",s.table_body_bg_colour).style("font-weight",s.table_body_font_weight).style("text-transform",s.table_body_text_transform).style("text-align",s.table_body_text_align).style("font-size",`${s.table_body_size}px`).style("font-family",s.table_body_font).style("color",s.table_body_colour).style("border-width",`${s.table_body_border_width}px`).style("border-style",s.table_body_border_style).style("border-color",s.table_body_border_colour).style("padding",`${s.table_body_text_padding}px`).style("opacity","inherit"),s.table_body_border_left_right||l.style("border-left","none").style("border-right","none"),s.table_body_border_top_bottom||l.style("border-top","none").style("border-bottom","none")})}function Va(t,e){let i,a;t.selectAll(".rowsvg").remove(),t.selectAll(".cell-text").remove(),e.viewModel.showGrouped?(i=e.viewModel.plotPoints.flat(),a=e.viewModel.tableColumns[0]):(i=e.viewModel.plotPoints[0],a=e.viewModel.tableColumns[0]);const l=e.viewModel.svgWidth/a.length,r=e.viewModel.inputSettings.settings[0].summary_table;t.call(La,a,r,l).call(Ea,e,i,r,l),i.length>0&&t.call(Oa,a,e.viewModel.inputSettings.settings[0],e.viewModel.showGrouped),t.call(Ia,r),t.on("click",()=>{e.selectionManager.clear(),e.updateHighlighting()})}function Ba(t){return!ya(t)&&!Number.isNaN(t)&&Number.isFinite(t)}function za(t,e){var i;if(!e.viewModel.inputSettings.settings[0].labels.show_labels||!(null===(i=e.viewModel.inputData[0])||void 0===i?void 0:i.anyLabels))return void t.select(".text-labels").remove();t.select(".text-labels").empty()&&t.append("g").classed("text-labels",!0);const a=Gi().on("drag",function(t){const i=t.subject,a=e.plotProperties.xScale(i.x),l=e.plotProperties.yScale(i.value),r=180*Math.atan2(t.sourceEvent.y-l,t.sourceEvent.x-a)/Math.PI,n=Math.sqrt(Math.pow(t.sourceEvent.y-l,2)+Math.pow(t.sourceEvent.x-a,2)),o=10*Math.cos(r*Math.PI/180),s=10*Math.sin(r*Math.PI/180);t.subject.label.angle=r,t.subject.label.distance=n,ut(this).select("text").attr("x",t.sourceEvent.x).attr("y",t.sourceEvent.y);let u=i.label.aesthetics.label_line_offset;u="top"===i.label.aesthetics.label_position?u:-(u+i.label.aesthetics.label_size/2),ut(this).select("line").attr("x1",t.sourceEvent.x).attr("y1",t.sourceEvent.y+u).attr("x2",a+o).attr("y2",l+s),ut(this).select("path").attr("transform",`translate(${a+o}, ${l+s}) rotate(${r-90})`)});t.select(".text-labels").selectAll(".text-group-inner").data(e.viewModel.plotPoints[0]).join("g").classed("text-group-inner",!0).each(function(t){var i;const l=ut(this);if(""===(null!==(i=t.label.text_value)&&void 0!==i?i:""))return void l.remove();l.selectAll("*").remove();const r=l.append("text"),n=l.append("line"),o=l.append("path"),{x:s,y:u,line_offset:d,marker_offset:p,theta:c}=function(t,e){var i,a;const l="top"===t.label.aesthetics.label_position?-1:1,r=e.viewModel.svgHeight-e.plotProperties.yAxis.start_padding,n=t.label.aesthetics.label_position;let o=t.label.aesthetics.label_y_offset;const s="top"===n?0+o:r-o,u=e.plotProperties.yScale(t.value);let d="top"===n?u-s:s-u;const p=e.plotProperties.xScale(t.x),c=e.plotProperties.yScale(t.value),h=null!==(i=t.label.angle)&&void 0!==i?i:t.label.aesthetics.label_angle_offset+90*l;d=null!==(a=t.label.distance)&&void 0!==a?a:Math.min(d,t.label.aesthetics.label_line_max_length);let m=t.label.aesthetics.label_line_offset;m="top"===n?m:-(m+t.label.aesthetics.label_size/2);let f=t.label.aesthetics.label_marker_offset+t.label.aesthetics.label_size/2;f="top"===n?-f:f;const y=p+d*Math.cos(h*Math.PI/180),g=c+d*Math.sin(h*Math.PI/180);return Ba(y)&&Ba(g)?{x:y,y:g,theta:h,line_offset:m,marker_offset:f}:{x:0,y:0,theta:0,line_offset:0,marker_offset:0}}(t,e);if(0===s&&0===u)return void l.remove();const h=c-("top"===t.label.aesthetics.label_position?180:0),m=h*Math.PI/180;r.attr("x",s).attr("y",u).text(t.label.text_value).style("text-anchor","middle").style("font-size",`${t.label.aesthetics.label_size}px`).style("font-family",t.label.aesthetics.label_font).style("fill",t.label.aesthetics.label_colour);const f=Math.pow(t.label.aesthetics.label_marker_size,2),y=e.plotProperties.xScale(t.x)+p*Math.cos(m),g=e.plotProperties.yScale(t.value)+p*Math.sin(m);n.attr("x1",s).attr("y1",u+d).attr("x2",y).attr("y2",g).style("stroke",e.viewModel.inputSettings.settings[0].labels.label_line_colour).style("stroke-width",e.viewModel.inputSettings.settings[0].labels.label_line_width).style("stroke-dasharray",e.viewModel.inputSettings.settings[0].labels.label_line_type);const _=h+("top"===t.label.aesthetics.label_position?90:270);o.attr("d",Yt().type(Ut).size(f)()).attr("transform",`translate(${y}, ${g}) rotate(${_})`).style("fill",t.label.aesthetics.label_marker_colour).style("stroke",t.label.aesthetics.label_marker_outline_colour),e.viewModel.headless||l.call(a)})}function ja(t,e){return function(i,a){return function(t,e,i,a){const l=a.percentLabels?"%":"",r=i.spc.sig_figs;if(ya(t))return"";switch(e){case"date":return t;case"integer":return t.toFixed(a.chart_type_props.integer_num_den?0:r);default:return t.toFixed(r)+l}}(i,a,t,e)}}const Ua={above:-1,below:1,beside:-1},Ha={ll99:"below",ll95:"below",ll68:"below",ul68:"above",ul95:"above",ul99:"above",speclimits_lower:"below",speclimits_upper:"above"},Ra={ll99:"above",ll95:"above",ll68:"above",ul68:"below",ul95:"below",ul99:"below",speclimits_lower:"above",speclimits_upper:"below"};function Za(t,e){if(0===e.viewModel.groupedLines.length)return void t.select(".linesgroup").selectAll("text").data([]).join("text").remove();const i=e.viewModel.inputSettings.settings[0].lines,a=new Array;e.viewModel.groupedLines[0][1].forEach((t,i)=>{null===t.line_value&&a.push(i-1),i===e.viewModel.groupedLines[0][1].length-1&&a.push(i)});const l=e.viewModel.groupedLines.map(t=>t[0]),r=new Array;a.forEach((t,e)=>{l.forEach((l,n)=>{const o=a[a.length-1],s=a.length-Math.min(a.length,i[`plot_label_show_n_${va[l]}`]),u=i[`plot_label_show_all_${va[l]}`]||t==o;(e>=s||u)&&r.push({index:t,limit:n})})});const n=ja(e.viewModel.inputSettings.settings[0],e.viewModel.inputSettings.derivedSettings[0]);t.select(".linesgroup").selectAll("text").data(r).join("text").text(t=>{const a=e.viewModel.groupedLines[t.limit];return i[`plot_label_show_${va[a[0]]}`]?i[`plot_label_prefix_${va[a[0]]}`]+n(a[1][t.index].line_value,"value"):""}).attr("x",t=>{const i=e.viewModel.groupedLines[t.limit];return e.plotProperties.xScale(i[1][t.index].x)}).attr("y",t=>{const i=e.viewModel.groupedLines[t.limit];return e.plotProperties.yScale(i[1][t.index].line_value)}).attr("fill",t=>{const a=e.viewModel.groupedLines[t.limit];return i[`plot_label_colour_${va[a[0]]}`]}).attr("font-size",t=>{const a=e.viewModel.groupedLines[t.limit];return`${i[`plot_label_size_${va[a[0]]}`]}px`}).attr("font-family",t=>{const a=e.viewModel.groupedLines[t.limit];return i[`plot_label_font_${va[a[0]]}`]}).attr("text-anchor",t=>{const a=e.viewModel.groupedLines[t.limit];return"beside"===i[`plot_label_position_${va[a[0]]}`]?"start":"end"}).attr("dx",t=>{const a=e.viewModel.groupedLines[t.limit];return("beside"===i[`plot_label_position_${va[a[0]]}`]?1:-1)*i[`plot_label_hpad_${va[a[0]]}`]+"px"}).attr("dy",function(t){const a=e.viewModel.groupedLines[t.limit],l=ut(this).node().getBoundingClientRect();let r=i[`plot_label_position_${va[a[0]]}`],n=i[`plot_label_vpad_${va[a[0]]}`];["outside","inside"].includes(r)&&(r="outside"===r?Ha[a[0]]:Ra[a[0]]);const o={above:-i[`width_${va[a[0]]}`],below:i[`plot_label_size_${va[a[0]]}`],beside:l.height/4};return`${Ua[r]*n+o[r]}px`})}function Ga(t,e){if(!e.viewModel.inputSettings.settings[0].download_options.show_button)return void t.select(".download-btn-group").remove();t.select(".download-btn-group").empty()&&t.append("text").classed("download-btn-group",!0);const i=e.viewModel.plotPoints[0].map(t=>t.table_row),a=new Array;a.push(Object.keys(i[0]).join(",")),i.forEach(t=>{a.push(Object.values(t).join(","))}),t.select(".download-btn-group").attr("x",e.viewModel.svgWidth-50).attr("y",e.viewModel.svgHeight-5).text("Download").style("font-size","10px").style("text-decoration","underline").on("click",()=>{e.host.downloadService.exportVisualsContent(a.join("\n"),"chartdata.csv","csv","csv file")})}function qa(t){return Math.min(...t)}function Ya(t){return Math.max(...t)}class Wa{initialiseScale(t,e){this.xScale=Ti().domain([this.xAxis.lower,this.xAxis.upper]).range([this.xAxis.start_padding,t-this.xAxis.end_padding]),this.yScale=Ti().domain([this.yAxis.lower,this.yAxis.upper]).range([e-this.yAxis.start_padding,this.yAxis.end_padding])}update(t,e){var i,a,l,r,n,o,s,u,d,p;const c=null!==(i=e.plotPoints[0])&&void 0!==i?i:[],h=e.controlLimits[0],m=e.inputData[0],f=e.inputSettings.settings[0],y=e.inputSettings.derivedSettings[0],g=e.colourPalette;this.displayPlot=c?c.length>0:null;let _=f.x_axis.xlimit_l,v=f.x_axis.xlimit_u,w=f.y_axis.ylimit_l,b=f.y_axis.ylimit_u;if(0==(null===(a=null==m?void 0:m.validationStatus)||void 0===a?void 0:a.status)&&h){v=ya(v)?Ya(h.keys.map(t=>t.x)):v;const t=f.y_axis.limit_multiplier,e=h.values.filter(t=>Ba(t)),i=null===(l=null==h?void 0:h.ul99)||void 0===l?void 0:l.filter(t=>Ba(t)),a=null===(r=null==h?void 0:h.speclimits_upper)||void 0===r?void 0:r.filter(t=>Ba(t)),c=null===(n=null==h?void 0:h.ll99)||void 0===n?void 0:n.filter(t=>Ba(t)),m=null===(o=null==h?void 0:h.speclimits_lower)||void 0===o?void 0:o.filter(t=>Ba(t)),g=null===(s=h.alt_targets)||void 0===s?void 0:s.filter(t=>Ba(t)),x=null===(u=h.targets)||void 0===u?void 0:u.filter(t=>Ba(t)),k=Ya(e),N=Ya(e.concat(i).concat(a).concat(g).filter(t=>Ba(t))),M=qa(e.concat(c).concat(m).concat(g).filter(t=>Ba(t))),A=null!==(d=Ya(x))&&void 0!==d?d:0,F=null!==(p=qa(x))&&void 0!==p?p:0,S=A+(N-A)*t,C=F-(F-M)*t,T=y.multiplier;null!=b||(b=!y.percentLabels||k>1*T?S:Math.min(S,1*T)),null!=w||(w=y.percentLabels?Math.max(C,0):C);const $=h.keys.map(t=>t.x);_=ya(_)?qa($):_,v=ya(v)?Ya($):v}const x=f.x_axis.xlimit_tick_size,k=f.y_axis.ylimit_tick_size,N=f.y_axis.ylimit_label?f.y_axis.ylimit_label_size:0,M=f.x_axis.xlimit_label?f.x_axis.xlimit_label_size:0;this.xAxis={lower:ya(_)?0:_,upper:v,start_padding:f.canvas.left_padding+N,end_padding:f.canvas.right_padding,colour:g.isHighContrast?g.foregroundColour:f.x_axis.xlimit_colour,ticks:f.x_axis.xlimit_ticks,tick_size:`${x}px`,tick_font:f.x_axis.xlimit_tick_font,tick_colour:g.isHighContrast?g.foregroundColour:f.x_axis.xlimit_tick_colour,tick_rotation:f.x_axis.xlimit_tick_rotation,tick_count:f.x_axis.xlimit_tick_count,label:f.x_axis.xlimit_label,label_size:`${f.x_axis.xlimit_label_size}px`,label_font:f.x_axis.xlimit_label_font,label_colour:g.isHighContrast?g.foregroundColour:f.x_axis.xlimit_label_colour},this.yAxis={lower:w,upper:b,start_padding:f.canvas.lower_padding+M,end_padding:f.canvas.upper_padding,colour:g.isHighContrast?g.foregroundColour:f.y_axis.ylimit_colour,ticks:f.y_axis.ylimit_ticks,tick_size:`${k}px`,tick_font:f.y_axis.ylimit_tick_font,tick_colour:g.isHighContrast?g.foregroundColour:f.y_axis.ylimit_tick_colour,tick_rotation:f.y_axis.ylimit_tick_rotation,tick_count:f.y_axis.ylimit_tick_count,label:f.y_axis.ylimit_label,label_size:`${f.y_axis.ylimit_label_size}px`,label_font:f.y_axis.ylimit_label_font,label_colour:g.isHighContrast?g.foregroundColour:f.y_axis.ylimit_label_colour},this.initialiseScale(t.viewport.width,t.viewport.height)}}function Ja(t){const e=t.denominators&&t.denominators.length>0,i=t.subset_points.length,a=t.numerators,l=t.denominators,r=t.subset_points;let n=e?a[r[0]]/l[r[0]]:a[r[0]],o=n,s=0,u=new Array(i-1);for(let t=1;t<i;t++){let i=e?a[r[t]]/l[r[t]]:a[r[t]];u[t-1]=Math.abs(i-n),s+=u[t-1],o+=i,n=i}if(o/=i,s/=i-1,!t.outliers_in_limits){const t=3.267*s;let e=0,i=0;for(let a=0;a<u.length;a++)u[a]<t&&(e+=u[a],i+=1);s=e/i}const d=s/1.128,p=t.keys.length;let c={keys:t.keys,values:new Array(p),numerators:e?t.numerators:void 0,denominators:e?t.denominators:void 0,targets:new Array(p),ll99:new Array(p),ll95:new Array(p),ll68:new Array(p),ul68:new Array(p),ul95:new Array(p),ul99:new Array(p)};for(let t=0;t<p;t++)e?(c.values[t]=a[t]/l[t],c.numerators[t]=a[t],c.denominators[t]=l[t]):c.values[t]=a[t],c.targets[t]=o,c.ll99[t]=o-3*d,c.ll95[t]=o-2*d,c.ll68[t]=o-1*d,c.ul68[t]=o+1*d,c.ul95[t]=o+2*d,c.ul99[t]=o+3*d;return c}function Xa(t){const e=t.denominators&&t.denominators.length>0,i=t.subset_points.length,a=t.numerators,l=t.denominators,r=t.subset_points;let n=new Array(i);for(let t=0;t<i;t++)n[t]=e?a[r[t]]/l[r[t]]:a[r[t]];let o,s=n.slice().sort((t,e)=>t-e);o=i%2==0?(s[i/2-1]+s[i/2])/2:s[Math.floor(i/2)];const u=t.keys.length;let d={keys:t.keys,values:new Array(u),numerators:e?t.numerators:void 0,denominators:e?t.denominators:void 0,targets:new Array(u)};for(let t=0;t<u;t++)e?(d.values[t]=a[t]/l[t],d.numerators[t]=a[t],d.denominators[t]=l[t]):d.values[t]=a[t],d.targets[t]=o;return d}function Ka(t,e,i){if(t<-1.1||t>1.1)throw new Error("chebyshevPolynomial: x must be in [-1,1]");if(i<1||i>1e3)throw new Error("chebyshevPolynomial: n must be in [1,1000]");const a=2*t;let l=0,r=0,n=0;for(let t=1;t<=i;t++)n=r,r=l,l=a*r-n+e[i-t];return.5*(l-n)}function Qa(t){if(Number.isNaN(t)||!Number.isFinite(t))return Number.NaN;let e=t%2;return e<=-1?e+=2:e>1&&(e-=2),0===e||1===e?0:.5===e?1:-.5===e?-1:Math.sin(Math.PI*e)}function tl(t){const e=[.16663894804518634,-1384948176067564e-20,9.81082564692473e-9,-1809129475572494e-26,6221098041892606e-29,-3399615005417722e-31,2683181998482699e-33,-2.868042435334643e-20,39628370610464347e-38,-6831888753985767e-39,14292273559424982e-41,-35475981581010704e-43,1025680058010471e-43,-3.401102254316749e-30,1276642195630063e-46];if(t<10)throw new Error("lgammaCorrection: x must be >= 10");if(t<94906265.62425156){const i=10/t;return Ka(i*i*2-1,e,5)/t}return 1/(12*t)}function el(t,e,i,a){let l=2*i,r=e+i,n=r+i,o=r,s=e*(r-e*t),u=i*i*t,d=n*r-u;const p=1157921e71;for(u=n*s-e*u;Math.abs(d*s-o*u)>Math.abs(a*s*u);){let e=r*r*t;r+=i,n+=i,o=n*d-e*o,s=n*u-e*s,e=l*l*t,l+=i,n+=i,d=n*o-e*d,u=n*s-e*u,Math.abs(u)>p?(o/=p,s/=p,d/=p,u/=p):Math.abs(u)<1/p&&(o*=p,s*=p,d*=p,u*=p)}return d/u}const il=.9189385332046728;function al(t){const e=[.08333333333333333,.002777777777777778,.0007936507936507937,.0005952380952380953,.0008417508417508417,.0019175269175269176,.00641025641025641,.029550653594771242,.17964437236883057,1.3924322169059011,13.402864044168393,156.84828462600203,2193.1033333333335,36108.77125372499,691472.268851313,15238221.539407415,382900751.39141417];let i,a=t+t;if(t<=15&&a===Math.trunc(a))return[0,.15342640972002736,.08106146679532726,.05481412105191765,.0413406959554093,.03316287351993629,.02767792568499834,.023746163656297496,.020790672103765093,.018488450532673187,.016644691189821193,.015134973221917378,.013876128823070748,.012810465242920227,.01189670994589177,.011104559758206917,.010411265261972096,.009799416126158804,.009255462182712733,.008768700134139386,.00833056343336287,.00793411456431402,.007573675487951841,.007244554301320383,.00694284010720953,.006665247032707682,.006408994188004207,.006171712263039458,.0059513701127588475,.0057462165130101155,.005554733551962801][a];if(t<=5.25){if(t>=1){const e=Math.log(t);return ll(t)+t*(1-e)+function(t){return t*Math.pow(2,-1)}(e-1.8378770664093456)}return function(t){if(Math.abs(t)>=.5)return ll(t+1);const e=[.3224670334241132,.0673523010531981,.020580808427784546,.007385551028673986,.0028905103307415234,.001192753911703261,.0005096695247430425,.00022315475845357939,9945751278180853e-20,4492623673813314e-20,2050721277567069e-20,9439488275268397e-21,4374866789907488e-21,2039215753801366e-21,9.55141213040742e-7,4.492469198764566e-7,2.1207184805554665e-7,1.0043224823968099e-7,4.7698101693639804e-8,2.2711094608943164e-8,1.0838659214896955e-8,5.183475041970047e-9,2.4836745438024785e-9,1.1921401405860912e-9,5.731367241678862e-10,2.7595228851242334e-10,1.330476437424449e-10,64229645638381e-24,31044247747322276e-27,15021384080754142e-27,7275974480239079e-27,3527742476575915e-27,1711991790559618e-27,8315385841420285e-28,404220052528944e-27,19664756310966165e-29,9573630387838556e-29,46640760264283744e-30,22737369600659724e-30,11091399470834522e-30],i=e.length;let a=22737368458246524e-29*el(-t/2,i+2,1,1e-14);for(let l=i-1;l>=0;l--)a=e[l]-t*a;return(t*a-.5772156649015329)*t-function(t){if(t>1||t<-.79149064)return Math.log1p(t)-t;{const e=t/(2+t),i=e*e;if(Math.abs(t)<.01){const a=[2/3,.4,2/7,2/9];let l=0;for(let t=0;t<a.length;t++)l=(l+a[t])*i;return e*(l-t)}return e*(2*i*el(i,3,2,1e-14)-t)}}(t)}(t)-(t+.5)*Math.log(t)+t-il}i=t>157e5?0:t>6180?1:t>205?2:t>86?3:t>27?4:t>23.5?5:t>12.8?6:t>12.3?7:t>8.9?8:t>7.3?10:t>6.6?12:t>6.1?14:16,a=t*t;let l=e[i];for(let t=i-1;t>=0;t--)l=e[t]-l/a;return l/t}function ll(t){if(Number.isNaN(t))return Number.NaN;if(t<=0&&t===Math.trunc(t))return Number.POSITIVE_INFINITY;const e=Math.abs(t);return e<1e-306?-Math.log(e):e<=10?Math.log(Math.abs(function(t){const e=[.00857119559098933,.004415381324841007,.05685043681599363,-.00421983539641856,.0013268081812124603,-.00018930245297988805,3606925327441245e-20,-6056761904460864e-21,10558295463022833e-22,-1.811967365542384e-7,3.117724964715322e-8,-5.354219639019687e-9,9.193275519859589e-10,-1.5779412802883398e-10,27079806229349544e-27,-464681865382573e-26,797335019200742e-27,-1368078209830916e-28,23473194865638007e-30,-4027432614949067e-30,6910051747372101e-31,-1185584500221993e-31,2034148542496374e-32,-3490054341717406e-33,5987993856485306e-34,-1027378057872228e-34,1.7627028160605298e-20,-3024320653735306e-36,5188914660218398e-37,-8902770842456576e-38,15274740684933426e-39,-2620731256187363e-39,4496464047830539e-40,-7714712731336878e-41,1323635453126044e-41,-22709994129429287e-43,38964189980039913e-44,-6685198115125953e-44,11469986631400244e-45,-1.9679385863451348e-30,3376448816585338e-46,-5793070335782136e-47];if(Number.isNaN(t))return Number.NaN;if(0==t||t<0&&t===Math.trunc(t))return Number.NaN;let i,a=Math.abs(t);if(a<=10){let l=Math.trunc(t);if(t<0&&l--,a=t-l,l--,i=Ka(2*a-1,e,22)+.9375,0==l)return i;if(l<0){if(t<-.5&&Math.abs(t-Math.trunc(t-.5)/t)<1.4901161193847656e-8)return Number.NaN;if(a<22474362225598545e-324)return t<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;l*=-1;for(let e=0;e<l;e++)i/=t+e;return i}for(let t=1;t<=l;t++)i*=a+t;return i}{if(t>171.61447887182297)return Number.POSITIVE_INFINITY;if(t<-170.5674972726612)return 0;if(a<=50&&a==Math.trunc(a)){i=1;for(let t=2;t<a;t++)i*=t}else{const t=2*a;i=Math.exp((a-.5)*Math.log(a)-a+il+(t==Math.trunc(t)?al(a):tl(a)))}if(t>0)return i;const e=Qa(a);return 0===e?Number.POSITIVE_INFINITY:-Math.PI/(a*e*i)}}(t))):e>Number.MAX_VALUE?Number.POSITIVE_INFINITY:t>0?t>1e17?t*(Math.log(t)-1):il+(t-.5)*Math.log(t)-t+(t>4934720?0:tl(t)):.22579135264472744+(t-.5)*Math.log(e)-t-Math.log(Math.abs(Qa(e)))-tl(e)}function rl(t){if(t<=1||ya(t))return null;const e=t-1;return Math.sqrt(2/e)*Math.exp(ll(t/2)-ll(e/2))}function nl(t){const e=t<=1?null:t;return 3/(rl(e)*Math.sqrt(e))}function ol(t,e){return e*function(t){return Math.sqrt(1-Math.pow(rl(t),2))}(t)/rl(t)}function sl(t,e){return 1-ol(t,e)}function ul(t,e){return 1+ol(t,e)}var dl=Object.freeze({__proto__:null,c:function(t){const e=t.subset_points.length,i=t.numerators,a=t.subset_points;let l=0;for(let t=0;t<e;t++)l+=i[a[t]];l/=e;const r=Math.sqrt(l),n=t.keys.length;let o={keys:t.keys,values:t.numerators,targets:new Array(n),ll99:new Array(n),ll95:new Array(n),ll68:new Array(n),ul68:new Array(n),ul95:new Array(n),ul99:new Array(n)};for(let t=0;t<n;t++)o.targets[t]=l,o.ll99[t]=Math.max(0,l-3*r),o.ll95[t]=Math.max(0,l-2*r),o.ll68[t]=Math.max(0,l-1*r),o.ul68[t]=l+1*r,o.ul95[t]=l+2*r,o.ul99[t]=l+3*r;return o},g:function(t){const e=t.numerators,i=t.subset_points,a=i.length;let l=new Array(a),r=0;for(let t=0;t<a;t++)l[t]=e[i[t]],r+=e[i[t]];r/=a;let n,o=l.slice().sort((t,e)=>t-e);n=a%2==0?(o[a/2-1]+o[a/2])/2:o[Math.floor(a/2)];const s=Math.sqrt(r*(r+1)),u=t.keys.length;let d={keys:t.keys,values:t.numerators,targets:new Array(u),ll99:new Array(u),ll95:new Array(u),ll68:new Array(u),ul68:new Array(u),ul95:new Array(u),ul99:new Array(u)};for(let t=0;t<u;t++)d.targets[t]=n,d.ll68[t]=0,d.ll95[t]=0,d.ll99[t]=0,d.ul68[t]=r+1*s,d.ul95[t]=r+2*s,d.ul99[t]=r+3*s;return d},i:Ja,i_m:function(t){const e=t.denominators&&t.denominators.length>0,i=t.subset_points.length,a=t.numerators,l=t.denominators,r=t.subset_points;let n=new Array(i);for(let t=0;t<i;t++)n[t]=e?a[r[t]]/l[r[t]]:a[r[t]];let o,s=n.slice().sort((t,e)=>t-e);o=i%2==0?(s[i/2-1]+s[i/2])/2:s[Math.floor(i/2)];let u=new Array(i-1),d=0;for(let t=1;t<i;t++)u[t-1]=Math.abs(n[t]-n[t-1]),d+=u[t-1];if(d/=i-1,!t.outliers_in_limits){const t=3.267*d;let e=0,i=0;for(let a=0;a<u.length;a++)u[a]<t&&(e+=u[a],i+=1);d=e/i}const p=d/1.128,c=t.keys.length;let h={keys:t.keys,values:new Array(c),numerators:e?t.numerators:void 0,denominators:e?t.denominators:void 0,targets:new Array(c),ll99:new Array(c),ll95:new Array(c),ll68:new Array(c),ul68:new Array(c),ul95:new Array(c),ul99:new Array(c)};for(let t=0;t<c;t++)e?(h.values[t]=a[t]/l[t],h.numerators[t]=a[t],h.denominators[t]=l[t]):h.values[t]=a[t],h.targets[t]=o,h.ll99[t]=o-3*p,h.ll95[t]=o-2*p,h.ll68[t]=o-1*p,h.ul68[t]=o+1*p,h.ul95[t]=o+2*p,h.ul99[t]=o+3*p;return h},i_mm:function(t){const e=t.denominators&&t.denominators.length>0,i=t.subset_points.length,a=t.numerators,l=t.denominators,r=t.subset_points;let n=new Array(i);for(let t=0;t<i;t++)n[t]=e?a[r[t]]/l[r[t]]:a[r[t]];let o,s=n.slice().sort((t,e)=>t-e);o=i%2==0?(s[i/2-1]+s[i/2])/2:s[Math.floor(i/2)];let u=new Array(i-1);for(let t=1;t<i;t++)u[t-1]=Math.abs(n[t]-n[t-1]);let d,p=u.slice().sort((t,e)=>t-e);const c=u.length;if(d=c%2==0?(p[c/2-1]+p[c/2])/2:p[Math.floor(c/2)],!t.outliers_in_limits){const t=3.267*d;let e=[];for(let i=0;i<u.length;i++)u[i]<t&&e.push(u[i]);if(e.length>0){let t=e.sort((t,e)=>t-e);const i=e.length;d=i%2==0?(t[i/2-1]+t[i/2])/2:t[Math.floor(i/2)]}}const h=d/1.128,m=t.keys.length;let f={keys:t.keys,values:new Array(m),numerators:e?t.numerators:void 0,denominators:e?t.denominators:void 0,targets:new Array(m),ll99:new Array(m),ll95:new Array(m),ll68:new Array(m),ul68:new Array(m),ul95:new Array(m),ul99:new Array(m)};for(let t=0;t<m;t++)e?(f.values[t]=a[t]/l[t],f.numerators[t]=a[t],f.denominators[t]=l[t]):f.values[t]=a[t],f.targets[t]=o,f.ll99[t]=o-3*h,f.ll95[t]=o-2*h,f.ll68[t]=o-1*h,f.ul68[t]=o+1*h,f.ul95[t]=o+2*h,f.ul99[t]=o+3*h;return f},mr:function(t){const e=t.denominators&&t.denominators.length>0,i=t.keys.length,a=t.numerators,l=t.denominators,r=t.subset_points;let n=new Array(i-1);for(let t=1;t<i;t++){let i=e?a[t-1]/l[t-1]:a[t-1],r=e?a[t]/l[t]:a[t];n[t-1]=Math.abs(r-i)}let o=0,s=0;for(let t=0;t<r.length;t++){let e=r[t];e>0&&e-1<n.length&&(o+=n[e-1],s++)}const u=o/s,d=i-1;let p={keys:t.keys.slice(1),values:new Array(d),numerators:e?t.numerators.slice(1):void 0,denominators:e?t.denominators.slice(1):void 0,targets:new Array(d),ll99:new Array(d),ll95:new Array(d),ll68:new Array(d),ul68:new Array(d),ul95:new Array(d),ul99:new Array(d)};for(let t=0;t<d;t++)p.values[t]=n[t],e&&(p.numerators[t]=a[t+1],p.denominators[t]=l[t+1]),p.targets[t]=u,p.ll99[t]=0,p.ll95[t]=0,p.ll68[t]=0,p.ul68[t]=1.089*u,p.ul95[t]=2.178*u,p.ul99[t]=3.267*u;return p},p:function(t){const e=t.numerators,i=t.denominators,a=t.subset_points,l=a.length;let r=0,n=0;for(let t=0;t<l;t++)r+=e[a[t]],n+=i[a[t]];const o=r/n,s=o*(1-o),u=t.keys.length;let d={keys:t.keys,values:new Array(u),numerators:t.numerators,denominators:t.denominators,targets:new Array(u),ll99:new Array(u),ll95:new Array(u),ll68:new Array(u),ul68:new Array(u),ul95:new Array(u),ul99:new Array(u)};for(let t=0;t<u;t++){const a=Math.sqrt(s/i[t]),l=2*a,r=3*a;d.values[t]=e[t]/i[t],d.targets[t]=o,d.ll99[t]=Math.max(0,o-r),d.ll95[t]=Math.max(0,o-l),d.ll68[t]=Math.max(0,o-a),d.ul68[t]=Math.min(1,o+a),d.ul95[t]=Math.min(1,o+l),d.ul99[t]=Math.min(1,o+r)}return d},pp:function(t){const e=t.keys.length,i=t.numerators,a=t.denominators,l=t.subset_points,r=l.length;let n=new Array(e);for(let t=0;t<e;t++)n[t]=i[t]/a[t];let o=0,s=0;for(let t=0;t<r;t++){let e=l[t];o+=i[e],s+=a[e]}const u=o/s;let d=new Array(e);for(let t=0;t<e;t++)d[t]=Math.sqrt(u*(1-u)/a[t]);let p=new Array(r);for(let t=0;t<r;t++){let e=l[t];p[t]=(n[e]-u)/d[e]}let c=new Array(r-1),h=0;for(let t=1;t<r;t++)c[t-1]=Math.abs(p[t]-p[t-1]),h+=c[t-1];if(h/=r-1,!t.outliers_in_limits){const t=3.267*h;let e=0,i=0;for(let a=0;a<c.length;a++)c[a]<t&&(e+=c[a],i+=1);h=e/i}const m=h/1.128;let f={keys:t.keys,values:n,numerators:t.numerators,denominators:t.denominators,targets:new Array(e),ll99:new Array(e),ll95:new Array(e),ll68:new Array(e),ul68:new Array(e),ul95:new Array(e),ul99:new Array(e)};for(let t=0;t<e;t++){const e=d[t]*m;f.targets[t]=u,f.ll99[t]=Math.max(0,u-3*e),f.ll95[t]=Math.max(0,u-2*e),f.ll68[t]=Math.max(0,u-1*e),f.ul68[t]=Math.min(1,u+1*e),f.ul95[t]=Math.min(1,u+2*e),f.ul99[t]=Math.min(1,u+3*e)}return f},r:Xa,run:Xa,s:function(t){const e=t.numerators,i=t.denominators,a=t.subset_points.length;let l=0,r=0;for(let n=0;n<a;n++){const a=i[t.subset_points[n]],o=e[t.subset_points[n]],s=a-1;l+=s,r+=s*Math.pow(o,2)}const n=Math.sqrt(r/l),o=t.keys.length;let s={keys:t.keys,values:e,targets:new Array(o),ll99:new Array(o),ll95:new Array(o),ll68:new Array(o),ul68:new Array(o),ul95:new Array(o),ul99:new Array(o)};for(let t=0;t<o;t++)s.targets[t]=n,s.ll99[t]=n*sl(i[t],3),s.ll95[t]=n*sl(i[t],2),s.ll68[t]=n*sl(i[t],1),s.ul68[t]=n*ul(i[t],1),s.ul95[t]=n*ul(i[t],2),s.ul99[t]=n*ul(i[t],3);return s},t:function(t){const e=t.keys.length;let i=new Array(e);for(let a=0;a<e;a++)i[a]=Math.pow(t.numerators[a],1/3.6);const a=Ja({numerators:i,denominators:null,keys:t.keys,subset_points:t.subset_points,outliers_in_limits:t.outliers_in_limits});for(let t=0;t<e;t++)a.targets[t]=Math.pow(a.targets[t],3.6),a.values[t]=Math.pow(a.values[t],3.6),a.ll99[t]=Math.max(0,Math.pow(a.ll99[t],3.6)),a.ll95[t]=Math.max(0,Math.pow(a.ll95[t],3.6)),a.ll68[t]=Math.max(0,Math.pow(a.ll68[t],3.6)),a.ul68[t]=Math.pow(a.ul68[t],3.6),a.ul95[t]=Math.pow(a.ul95[t],3.6),a.ul99[t]=Math.pow(a.ul99[t],3.6);return a},u:function(t){const e=t.keys.length,i=t.numerators,a=t.denominators,l=t.subset_points;let r=0,n=0;for(let t=0;t<l.length;t++){let e=l[t];r+=i[e],n+=a[e]}const o=r/n;let s={keys:t.keys,values:new Array(e),numerators:t.numerators,denominators:t.denominators,targets:new Array(e),ll99:new Array(e),ll95:new Array(e),ll68:new Array(e),ul68:new Array(e),ul95:new Array(e),ul99:new Array(e)};for(let t=0;t<e;t++){s.values[t]=i[t]/a[t];const e=Math.sqrt(o/a[t]);s.targets[t]=o,s.ll99[t]=Math.max(0,o-3*e),s.ll95[t]=Math.max(0,o-2*e),s.ll68[t]=Math.max(0,o-1*e),s.ul68[t]=o+1*e,s.ul95[t]=o+2*e,s.ul99[t]=o+3*e}return s},up:function(t){const e=t.keys.length,i=t.numerators,a=t.denominators,l=t.subset_points,r=l.length;let n=new Array(e);for(let t=0;t<e;t++)n[t]=i[t]/a[t];let o=0,s=0;for(let t=0;t<r;t++){let e=l[t];o+=i[e],s+=a[e]}const u=o/s;let d=new Array(e);for(let t=0;t<e;t++)d[t]=Math.sqrt(u/a[t]);let p=new Array(r);for(let t=0;t<r;t++){let e=l[t];p[t]=(n[e]-u)/d[e]}let c=new Array(r-1),h=0;for(let t=1;t<r;t++)c[t-1]=Math.abs(p[t]-p[t-1]),h+=c[t-1];if(h/=r-1,!t.outliers_in_limits){const t=3.267*h;let e=0,i=0;for(let a=0;a<c.length;a++)c[a]<t&&(e+=c[a],i+=1);h=e/i}const m=h/1.128;let f={keys:t.keys,values:n,numerators:t.numerators,denominators:t.denominators,targets:new Array(e),ll99:new Array(e),ll95:new Array(e),ll68:new Array(e),ul68:new Array(e),ul95:new Array(e),ul99:new Array(e)};for(let t=0;t<e;t++){const e=d[t]*m;f.targets[t]=u,f.ll99[t]=Math.max(0,u-3*e),f.ll95[t]=Math.max(0,u-2*e),f.ll68[t]=Math.max(0,u-1*e),f.ul68[t]=u+1*e,f.ul95[t]=u+2*e,f.ul99[t]=u+3*e}return f},xbar:function(t){const e=t.denominators,i=t.numerators,a=t.xbar_sds,l=t.subset_points.length,r=t.subset_points;let n=0,o=0,s=0,u=0;for(let t=0;t<l;t++){const l=e[r[t]],d=i[r[t]],p=a[r[t]],c=l-1;n+=c,o+=c*Math.pow(p,2),s+=l*d,u+=l}const d=Math.sqrt(o/n),p=s/u,c=t.keys.length;let h={keys:t.keys,values:i,targets:new Array(c),ll99:new Array(c),ll95:new Array(c),ll68:new Array(c),ul68:new Array(c),ul95:new Array(c),ul99:new Array(c),count:e};for(let t=0;t<c;t++){const i=nl(e[t])*d,a=i/3;h.targets[t]=p,h.ll99[t]=p-i,h.ll95[t]=p-2*a,h.ll68[t]=p-a,h.ul68[t]=p+a,h.ul95[t]=p+2*a,h.ul99[t]=p+i}return h}});function pl(t,e){let i=new Array(e);for(let a=0;a<e;a++)i[a]=t;return i}function cl(t,e,i,a){var l;const r=null===(l=null==t?void 0:t[e])||void 0===l?void 0:l[i];return ya(r)?a:(null==r?void 0:r.solid)?r.solid.color:r}function hl(t,e,i,a){var l,r,n;if(ya(null==t?void 0:t.categories))return{values:null,validation:{status:0,messages:pl(new Array,1)}};if(0===(null===(n=null===(r=null===(l=null==t?void 0:t.categories)||void 0===l?void 0:l[0])||void 0===r?void 0:r.identity)||void 0===n?void 0:n.length))return{values:null,validation:{status:0,messages:pl(new Array,1)}};const o=t.categories[0],s=Object.keys(i[e]),u=JSON.parse(JSON.stringify({status:0,messages:pl([],o.values.length)})),d=a.length;let p=new Array(d);for(let t=0;t<d;t++){const i=o.objects?o.objects[a[t]]:null;p[t]=Object.fromEntries(s.map(a=>{var l,r,n,o,s,d,p;const c=ma[e][a].default;let h=cl(i,e,a,c);h=""===h?c:h;const m=null!==(r=null===(l=ma[e][a])||void 0===l?void 0:l.valid)&&void 0!==r?r:null===(n=ma[e][a])||void 0===n?void 0:n.options,f=!ya(null==m?void 0:m.minValue)||!ya(null==m?void 0:m.maxValue);if(m){let i="";m instanceof Array&&!m.includes(h)?i=`${h} is not a valid value for ${a}. Valid values are: ${m.join(", ")}`:f&&!ba(h,null===(o=null==m?void 0:m.minValue)||void 0===o?void 0:o.value,null===(s=null==m?void 0:m.maxValue)||void 0===s?void 0:s.value)&&(i=`${h} is not a valid value for ${a}. Valid values are between ${null===(d=null==m?void 0:m.minValue)||void 0===d?void 0:d.value} and ${null===(p=null==m?void 0:m.maxValue)||void 0===p?void 0:p.value}`),""!==i&&(h=ma[e][a].default,u.messages[t].push(i))}return[a,h]}))}const c=u.messages.filter(t=>t.length>0);return u.messages.some(t=>0===t.length)||(u.status=1,u.error=`${c[0][0]}`),{values:p,validation:u}}const ml={i:"Observation",i_m:"Observation",i_mm:"Observation",c:"Count",t:"Time",xbar:"Group Mean",s:"Group SD",g:"Non-Events",run:"Observation",mr:"Moving Range",p:"Proportion",pp:"Proportion",u:"Rate",up:"Rate"};class fl{update(t){const e=t.chart_type,i=["p","pp"].includes(e),a=t.perc_labels;let l,r=t.multiplier;"Yes"===a&&(r=100),i&&"No"!==a&&(r=1===r?100:r),l="Automatic"===a?i&&100===r:"Yes"===a,this.chart_type_props={name:e,needs_denominator:["p","pp","u","up","xbar","s"].includes(e),denominator_optional:["i","i_m","i_mm","run","mr"].includes(e),numerator_non_negative:["p","pp","u","up","s","c","g","t"].includes(e),numerator_leq_denominator:["p","pp","u","up"].includes(e),has_control_limits:!["run"].includes(e),needs_sd:["xbar"].includes(e),integer_num_den:["c","p","pp"].includes(e),value_name:ml[e],x_axis_use_date:!["g","t"].includes(e),date_name:["g","t"].includes(e)?"Event":"Date"},this.multiplier=r,this.percentLabels=l}}class yl{update(t,e){this.validationStatus=JSON.parse(JSON.stringify({status:0,messages:new Array,error:""})),this.settings=new Array,this.derivedSettings=new Array,e.forEach(()=>{this.settings.push(Object.fromEntries(Object.keys(ma).map(t=>[t,Object.fromEntries(Object.keys(ma[t]).map(e=>[e,ma[t][e]]))]))),this.derivedSettings.push(new fl)});const i=e.flat();Object.keys(this.settings[0]).forEach(a=>{const l=hl(null==t?void 0:t.categorical,a,this.settings[0],i);0!==l.validation.status&&(this.validationStatus.status=l.validation.status,this.validationStatus.error=l.validation.error),0===this.validationStatus.messages.length?this.validationStatus.messages=l.validation.messages:l.validation.messages.every(t=>0===t.length)||l.validation.messages.forEach((t,e)=>{t.length>0&&(this.validationStatus.messages[e]=this.validationStatus.messages[e].concat(t))}),Object.keys(this.settings[0][a]).forEach(t=>{e.forEach((e,i)=>{this.settings[i][a][t]=(null==l?void 0:l.values)?null==l?void 0:l.values[e[0]][t]:ma[a][t].default})})}),this.settings[0].nhs_icons.show_variation_icons&&(["astronomical","shift","trend","two_in_three"].some(t=>this.settings[0].outliers[t])||(this.validationStatus.status=1,this.validationStatus.error="Variation icons require at least one outlier pattern to be selected")),this.settings.forEach((t,e)=>{this.derivedSettings[e].update(t.spc)})}getFormattingModel(){var t,e;const i={cards:[]};for(const a in ca){let l={description:ca[a].description,displayName:ca[a].displayName,uid:a+"_card_uid",groups:[],revertToDefaultDescriptors:[]};for(const i in ca[a].settingsGroups){let r={displayName:"all"===i?ca[a].displayName:i,uid:a+"_"+i+"_uid",slices:[]};for(const n in ca[a].settingsGroups[i]){l.revertToDefaultDescriptors.push({objectName:a,propertyName:n});let o={uid:a+"_"+i+"_"+n+"_slice_uid",displayName:ca[a].settingsGroups[i][n].displayName,control:{type:ca[a].settingsGroups[i][n].type,properties:{descriptor:{objectName:a,propertyName:n,selector:{data:[{dataViewWildcard:{matchingOption:0}}]},instanceKind:"boolean"!=typeof this.settings[0][a][n]?3:null},value:this.valueLookup(a,i,n),items:null===(t=ca[a].settingsGroups[i][n])||void 0===t?void 0:t.items,options:null===(e=ca[a].settingsGroups[i][n])||void 0===e?void 0:e.options}}};r.slices.push(o)}l.groups.push(r)}i.cards.push(l)}return i}valueLookup(t,e,i){var a;if(i.includes("colour"))return{value:this.settings[0][t][i]};if(!ya(null===(a=ca[t].settingsGroups[e][i])||void 0===a?void 0:a.items)){const a=ca[t].settingsGroups[e][i].items,l=this.settings[0][t][i];return a.find(t=>t.value===l)}return this.settings[0][t][i]}constructor(){this.settings=[Object.fromEntries(Object.keys(ma).map(t=>[t,Object.fromEntries(Object.keys(ma[t]).map(e=>[e,ma[t][e]]))]))],this.derivedSettings=[new fl]}}function gl(t,e,i,a){const l=i.outliers.astronomical_limit,r=i.outliers.two_in_three_limit,n=ja(i,a),o=new Array;if(i.spc.ttip_show_date){const e=i.spc.ttip_label_date;o.push({displayName:"Automatic"===e?a.chart_type_props.date_name:e,value:t.date})}if(i.spc.ttip_show_value){const e=i.spc.ttip_label_value;o.push({displayName:"Automatic"===e?a.chart_type_props.value_name:e,value:n(t.value,"value")})}if(i.spc.ttip_show_numerator&&!ya(t.numerator)&&o.push({displayName:i.spc.ttip_label_numerator,value:n(t.numerator,"integer")}),i.spc.ttip_show_denominator&&!ya(t.denominator)&&o.push({displayName:i.spc.ttip_label_denominator,value:n(t.denominator,"integer")}),i.lines.ttip_show_trend&&i.lines.show_trend&&o.push({displayName:i.lines.ttip_label_trend,value:n(t.trend_line,"value")}),i.lines.show_specification&&i.lines.ttip_show_specification&&(ya(t.speclimits_upper)||o.push({displayName:`Upper ${i.lines.ttip_label_specification}`,value:n(t.speclimits_upper,"value")}),ya(t.speclimits_lower)||o.push({displayName:`Lower ${i.lines.ttip_label_specification}`,value:n(t.speclimits_lower,"value")})),a.chart_type_props.has_control_limits&&["99","95","65"].forEach(e=>{i.lines[`ttip_show_${e}`]&&i.lines[`show_${e}`]&&o.push({displayName:`${i.lines[`ttip_label_${e}_prefix_upper`]}${i.lines[`ttip_label_${e}`]}`,value:n(t[`ul${e}`],"value")})}),i.lines.show_target&&i.lines.ttip_show_target&&o.push({displayName:i.lines.ttip_label_target,value:n(t.target,"value")}),i.lines.show_alt_target&&i.lines.ttip_show_alt_target&&!ya(t.alt_target)&&o.push({displayName:i.lines.ttip_label_alt_target,value:n(t.alt_target,"value")}),a.chart_type_props.has_control_limits&&["68","95","99"].forEach(e=>{i.lines[`ttip_show_${e}`]&&i.lines[`show_${e}`]&&o.push({displayName:`${i.lines[`ttip_label_${e}_prefix_lower`]}${i.lines[`ttip_label_${e}`]}`,value:n(t[`ll${e}`],"value")})}),[t.astpoint,t.trend,t.shift,t.two_in_three].some(t=>"none"!==t)){const e=new Array;if("none"!==t.astpoint){let t="Astronomical Point";"3 Sigma"!==l&&(t=`${t} (${l})`),e.push(t)}if("none"!==t.trend&&e.push("Trend"),"none"!==t.shift&&e.push("Shift"),"none"!==t.two_in_three){let t="Two-in-Three";"2 Sigma"!==r&&(t=`${t} (${r})`),e.push(t)}o.push({displayName:"Pattern(s)",value:e.join("\n")})}return!ya(e)&&e.length>0&&e.forEach(t=>o.push(t)),o}function _l(t,e){if("none"===t)return t;const i={increase:{upper:"improvement",lower:"deterioration"}[t],decrease:{lower:"improvement",upper:"deterioration"}[t],neutral:{lower:"neutral_low",upper:"neutral_high"}[t]}[e.improvement_direction];return"both"!==e.process_flag_type?i===e.process_flag_type?i:"none":i}function vl(t,e){return ya(t)?null:e.valueType.numeric?t.toString():t}const wl={DD:null,"Thurs DD":"short","Thursday DD":"long","(blank)":null},bl={weekday:wl,day:{DD:"2-digit","Thurs DD":"2-digit","Thursday DD":"2-digit","(blank)":null},month:{MM:"2-digit",Mon:"short",Month:"long","(blank)":null},year:{YYYY:"numeric",YY:"2-digit","(blank)":null}},xl={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11};function kl(t,e){return t.temporal?"DayOfMonth"===(null==t?void 0:t.category)?["day",e]:"Months"===(null==t?void 0:t.category)?["month",xl[e]]:"Quarters"===(null==t?void 0:t.category)?["quarter",e]:"Years"===(null==t?void 0:t.category)?["year",e]:null:null}const Nl={"en-GB":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"en-US":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},Ml={"en-GB":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"en-US":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Al={"en-GB":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"en-US":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Fl={"en-GB":["January","February","March","April","May","June","July","August","September","October","November","December"],"en-US":["January","February","March","April","May","June","July","August","September","October","November","December"]};function Sl(t,e,i){const a={weekday:"",day:"",month:"",year:""};return"short"===i.weekday?a.weekday=Nl[e][t.getDay()]:"long"===i.weekday&&(a.weekday=Ml[e][t.getDay()]),"2-digit"===i.day&&(a.day=String(t.getDate()).padStart(2,"0")),"2-digit"===i.month?a.month=String(t.getMonth()+1).padStart(2,"0"):"short"===i.month?a.month=Al[e][t.getMonth()]:"long"===i.month&&(a.month=Fl[e][t.getMonth()]),"numeric"===i.year?a.year=String(t.getFullYear()):"2-digit"===i.year&&(a.year=String(t.getFullYear()).slice(-2)),a}function Cl(t,e,i){var a,l,r;const n=i.length;let o=new Array(n);if(1===t.length&&!(null===(a=t[0].source.type)||void 0===a?void 0:a.temporal)){for(let e=0;e<n;e++)o[e]=ya(t[0].values[i[e]])?null:String(t[0].values[i[e]]);return o}const s=e.dates.date_format_delim;if(!t.every(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.type)||void 0===i?void 0:i.temporal})){const e=pl("",t.length).join(s);for(let a=0;a<n;a++){const l=t.map(t=>t.values[i[a]]).join(s);o[a]=l===e?null:l}return o}const u=function(t,e){var i,a,l,r,n;const o=e.length;let s=[];const u=[];if(t.length>1)for(let r=0;r<o;r++){const n=[];for(let i=0;i<t.length;i++)n.push(kl(t[i].source.type,t[i].values[e[r]]));const o=Object.fromEntries(n);(null==o?void 0:o.quarter)&&u.push(o.quarter),s[r]=new Date(null!==(i=null==o?void 0:o.year)&&void 0!==i?i:1970,null!==(a=null==o?void 0:o.month)&&void 0!==a?a:0,null!==(l=null==o?void 0:o.day)&&void 0!==l?l:1)}else for(let i=0;i<o;i++)s[i]=ya(null===(r=null==t?void 0:t[0])||void 0===r?void 0:r.values[e[i]])?null:new Date(null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.values[e[i]]);return{dates:s,quarters:u}}(t,i),d=function(t){const e=new Array;return Object.keys(t).forEach(i=>{if("date_format_locale"!==i&&"date_format_delim"!==i){const a=i.replace("date_format_",""),l=bl[a][t[i]];ya(l)||(e.push([a,l]),"day"===a&&"DD"!==t[i]&&e.push(["weekday",wl[t[i]]]))}}),Object.fromEntries(e)}(e.dates),p=e.dates.date_format_locale;let c="en-GB"===p?"day":"month",h="en-GB"===p?"month":"day";for(let t=0;t<n;t++)if(ya(u.dates[t]))o[t]=null;else{const e=Sl(u.dates[t],p,d),i=[e.weekday+" "+e[c],e[h],null!==(r=null===(l=u.quarters)||void 0===l?void 0:l[t])&&void 0!==r?r:"",e.year];o[t]=i.filter(t=>String(t).trim()).join(s)}return o}function Tl(t,e,i,a){var l,r,n,o;if("key"===e)return function(t,e,i){const a=t.categories.filter(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.roles)||void 0===i?void 0:i.key}),l={};let r=a.map(t=>{var e,i;return null!==(i=null===(e=t.source)||void 0===e?void 0:e.queryName)&&void 0!==i?i:""});const n=new Set;r=r.map((t,e)=>(n.has(t)&&(t=`${e}_${t}`),n.add(t),t)),a.forEach((t,e)=>{let i=r[e];if(i.includes("Date Hierarchy")){const t=i.lastIndexOf(".");-1!==t&&(i=i.substring(0,t))}l[i]||(l[i]=[]),l[i].push(t)});const o=[];for(const t in l){const a=Cl(l[t],e,i);o.push(a)}const s=[],u=i.length;for(let t=0;t<u;t++){const e=o.map(e=>e[t]).filter(t=>null!=t);s.push(e.length>0?e.join(" "):null)}return s}(t,i,a);if("tooltips"===e)return function(t,e,i){const a=t.values.filter(t=>t.source.roles.tooltips),l=i.length;let r=new Array(l);for(let t=0;t<l;t++)r[t]=a.map(a=>{var l;const r={valueType:a.source.type,dateSettings:e.dates},n=vl(null===(l=null==a?void 0:a.values)||void 0===l?void 0:l[i[t]],r);return{displayName:a.source.displayName,value:n}});return r}(t,i,a);const s=t.values.filter(t=>{var i,a;return null===(a=null===(i=null==t?void 0:t.source)||void 0===i?void 0:i.roles)||void 0===a?void 0:a[e]});if(0===s.length)return null;const u=a.length;if("groupings"===e||"labels"===e){let t=new Array(u);for(let e=0;e<u;e++)t[e]=ya(null===(r=null===(l=null==s?void 0:s[0])||void 0===l?void 0:l.values)||void 0===r?void 0:r[a[e]])?null:String(s[0].values[a[e]]);return t}let d=new Array(u);for(let t=0;t<u;t++)d[t]=ya(null===(o=null===(n=null==s?void 0:s[0])||void 0===n?void 0:n.values)||void 0===o?void 0:o[a[t]])?null:Number(s[0].values[a[t]]);return d}function $l(t,e){if(t){const i=e.filter(e=>e>=0&&e<t.length&&!ya(e)),a=i.length;let l=new Array(a);for(let e=0;e<a;e++)l[e]=t[i[e]];return l}return[]}function Dl(t,e,i,a,l,r){const n={message:"",type:0};return ya(t)&&(n.message="Date missing",n.type=2),ya(e)&&(n.message="Numerator missing",n.type=3),isNaN(e)&&(n.message="Numerator is not a number",n.type=10),l.numerator_non_negative&&e<0&&(n.message="Numerator negative",n.type=4),r&&(ya(i)?(n.message="Denominator missing",n.type=5):isNaN(i)?(n.message="Denominator is not a number",n.type=11):i<0?(n.message="Denominator negative",n.type=6):l.numerator_leq_denominator&&i<e&&(n.message="Denominator < numerator",n.type=7)),l.needs_sd&&(ya(a)?(n.message="SD missing",n.type=8):isNaN(a)?(n.message="SD is not a number",n.type=12):a<0&&(n.message="SD negative",n.type=9)),n}function Pl(t,e){const i=new Array(e-t+1);for(let a=t;a<=e;a++)i[a-t]=a;return i}function Ll(t){const e=t.length;if(0===e)return[];let i=0,a=0,l=0,r=0;for(let n=0;n<e;n++){const e=n+1,o=t[n];a+=e,i+=o,l+=e*o,r+=e*e}const n=(e*l-a*i)/(e*r-a*a),o=(i-n*a)/e,s=[];for(let t=0;t<e;t++)s.push(n*(t+1)+o);return s}function El(t,e,i){return t.map((t,a)=>ba(t,e[a],i[a])?"none":t>i[a]?"upper":"lower")}function Il(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];return e}function Ol(t,e){const i=t.map((e,i)=>0==i?i:Math.sign(e-t[i-1])),a=i.map((t,a)=>Il(i.slice(Math.max(0,a-(e-2)),a+1))).map(t=>Math.abs(t)>=e-1?t>=e-1?"upper":"lower":"none");for(let t=0;t<a.length;t++)if("none"!==a[t])for(let i=t-1;i>=t-(e-1);i--)a[i]=a[t];return a}function Vl(t,e,i,a){const l=t.map((t,a)=>t>i[a]?1:t<e[a]?-1:0),r=l.map((t,e)=>Il(l.slice(Math.max(0,e-2),e+1))).map(t=>Math.abs(t)>=2?t>=2?"upper":"lower":"none");for(let t=0;t<r.length;t++)if("none"!==r[t]){for(let e=t-1;e>=t-2;e--)(0!==l[e]||a)&&(r[e]=r[t]);0!==l[t]||a||(r[t]="none")}return r}function Bl(t,e,i){const a=t.map((t,i)=>Math.sign(t-e[i])),l=a.map((t,e)=>Il(a.slice(Math.max(0,e-(i-1)),e+1))).map(t=>Math.abs(t)>=i?t>=i?"upper":"lower":"none");for(let t=0;t<l.length;t++)if("none"!==l[t])for(let e=t-1;e>=t-(i-1);e--)l[e]=l[t];return l}class zl{get showGrouped(){return this.inputData&&this.inputData.length>1}constructor(){this.inputData=new Array,this.inputSettings=new yl,this.controlLimits=new Array,this.outliers=new Array,this.plotPoints=new Array,this.groupedLines=new Array,this.firstRun=!0,this.splitIndexes=new Array,this.groupStartEndIndexes=new Array,this.identities=new Array,this.tableColumns=new Array,this.colourPalette=null,this.headless=!1,this.frontend=!1}update(t,e){var i,a,l,r,n,o,s,u,d,p,c,h,m,f,y,g,_,v,w;ya(this.colourPalette)&&(this.colourPalette={isHighContrast:e.colorPalette.isHighContrast,foregroundColour:e.colorPalette.foreground.value,backgroundColour:e.colorPalette.background.value,foregroundSelectedColour:e.colorPalette.foregroundSelected.value,hyperlinkColour:e.colorPalette.hyperlink.value}),this.svgWidth=t.viewport.width,this.svgHeight=t.viewport.height,this.headless=null!==(i=null==t?void 0:t.headless)&&void 0!==i&&i,this.frontend=null!==(a=null==t?void 0:t.frontend)&&void 0!==a&&a;const b=null===(n=null===(r=null===(l=t.dataViews[0])||void 0===l?void 0:l.categorical)||void 0===r?void 0:r.categories)||void 0===n?void 0:n.filter(t=>t.source.roles.indicator);this.indicatorVarNames=null!==(o=null==b?void 0:b.map(t=>t.source.displayName))&&void 0!==o?o:[];const x=null==b?void 0:b.length,k=null!==(h=null===(c=null===(p=null===(d=null===(u=null===(s=t.dataViews[0])||void 0===s?void 0:s.categorical)||void 0===u?void 0:u.categories)||void 0===d?void 0:d[0])||void 0===p?void 0:p.values)||void 0===c?void 0:c.length)&&void 0!==h?h:1,N={status:!0},M=new Array;M.push([0]),this.groupNames=new Array,this.groupNames.push(null!==(m=null==b?void 0:b.map(t=>t.values[0]))&&void 0!==m?m:[]);let A=0;for(let t=1;t<k;t++){let e=!0;for(let i=0;i<x;i++)e=e&&(null==b?void 0:b[i].values[t])===(null==b?void 0:b[i].values[t-1]);e?M[A].push(t):(M.push([t]),this.groupNames.push(null!==(f=null==b?void 0:b.map(e=>e.values[t]))&&void 0!==f?f:[]),A+=1)}if((2===t.type||this.firstRun)&&this.inputSettings.update(t.dataViews[0],M),""!==this.inputSettings.validationStatus.error)return N.status=!1,N.error=this.inputSettings.validationStatus.error,N.type="settings",N;const F=function(t,e){var i,a,l,r,n,o,s,u,d,p,c,h,m,f,y;if(ya(null==t?void 0:t[0])||0===(null===(n=null===(r=null===(l=null===(a=null===(i=null==t?void 0:t[0])||void 0===i?void 0:i.categorical)||void 0===a?void 0:a.categories)||void 0===l?void 0:l[0])||void 0===r?void 0:r.identity)||void 0===n?void 0:n.length))return"";if(ya(null===(s=null===(o=t[0])||void 0===o?void 0:o.categorical)||void 0===s?void 0:s.categories)||ya(null===(d=null===(u=t[0])||void 0===u?void 0:u.categorical)||void 0===d?void 0:d.categories.some(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.roles)||void 0===i?void 0:i.key})))return"";const g=null===(c=null===(p=t[0].categorical)||void 0===p?void 0:p.values)||void 0===c?void 0:c.some(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.roles)||void 0===i?void 0:i.numerators});if(!g)return"No Numerators passed!";let _,v,w;if((null==e?void 0:e.derivedSettings.length)>0?null==e||e.derivedSettings.forEach(t=>{t.chart_type_props.needs_denominator&&(w=t.chart_type_props.name,_=!0),t.chart_type_props.needs_sd&&(w=t.chart_type_props.name,v=!0)}):(w=e.settings[0].spc.chart_type,_=e.derivedSettings[0].chart_type_props.needs_denominator,v=e.derivedSettings[0].chart_type_props.needs_sd),_){const e=null===(m=null===(h=t[0].categorical)||void 0===h?void 0:h.values)||void 0===m?void 0:m.some(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.roles)||void 0===i?void 0:i.denominators});if(!e)return`Chart type '${w}' requires denominators!`}if(v){const e=null===(y=null===(f=t[0].categorical)||void 0===f?void 0:f.values)||void 0===y?void 0:y.some(t=>{var e,i;return null===(i=null===(e=t.source)||void 0===e?void 0:e.roles)||void 0===i?void 0:i.xbar_sds});if(!e)return`Chart type '${w}' requires SDs!`}return"valid"}(t.dataViews,this.inputSettings);if("valid"!==F)return N.status=!1,N.error=F,N;if(2===t.type||this.firstRun){const i=t.dataViews[0].categorical.categories.some(t=>t.source.roles.indicator),a=null!==(w=null===(v=null===(_=null===(g=null===(y=t.dataViews[0])||void 0===y?void 0:y.metadata)||void 0===g?void 0:g.objects)||void 0===_?void 0:_.split_indexes_storage)||void 0===v?void 0:v.split_indexes)&&void 0!==w?w:"[]",l=JSON.parse(a);this.splitIndexes=i?[]:l,this.inputData=new Array,this.groupStartEndIndexes=new Array,this.controlLimits=new Array,this.outliers=new Array,this.identities=new Array,this.tableColumns=new Array,M.forEach((i,a)=>{const l=this.inputSettings.settings[a],r=this.inputSettings.derivedSettings[a],n=function(t,e,i,a,l){var r,n,o,s,u,d,p;const c=Tl(t,"numerators",e,l),h=Tl(t,"denominators",e,l),m=Tl(t,"xbar_sds",e,l),f=Tl(t,"key",e,l),y=Tl(t,"tooltips",e,l),g=Tl(t,"groupings",e,l),_=Tl(t,"labels",e,l),v=l.map(e=>{var i,a,l;return null===(l=null===(a=null===(i=null==t?void 0:t.values)||void 0===i?void 0:i[0])||void 0===a?void 0:a.highlights)||void 0===l?void 0:l[e]});let w=null===(r=hl(t,"scatter",e,l))||void 0===r?void 0:r.values,b=null===(n=hl(t,"lines",e,l))||void 0===n?void 0:n.values,x=null===(o=hl(t,"labels",e,l))||void 0===o?void 0:o.values,k=null===(s=hl(t,"lines",e,l))||void 0===s?void 0:s.values.map(t=>e.lines.show_alt_target?t.alt_target:null),N=null===(u=hl(t,"lines",e,l))||void 0===u?void 0:u.values.map(t=>t.show_specification?t.specification_lower:null),M=null===(d=hl(t,"lines",e,l))||void 0===d?void 0:d.values.map(t=>t.show_specification?t.specification_upper:null),A=null===(p=hl(t,"spc",e,l))||void 0===p?void 0:p.values;const F=function(t,e,i,a,l,r){let n=!1,o=new Array,s=new Array;const u=l.needs_denominator||l.denominator_optional&&!ya(i)&&i.length>0,d=r.length;for(let r=0;r<d;r++){const n=Dl(t[r],null==e?void 0:e[r],null==i?void 0:i[r],null==a?void 0:a[r],l,u);o.push(n.message),s.push(n.type)}let p=new Set(s);n=1===p.size;let c=Array.from(p)[0],h={status:n&&0!==c?1:0,messages:o};if(0===h.status&&s.every(t=>0!==t))return h.status=1,h.error="No valid data found!",h;if(n&&0!==c)switch(c){case 1:h.error="Grouping missing";break;case 2:h.error="All dates/IDs are missing or null!";break;case 3:h.error="All numerators are missing or null!";break;case 10:h.error="All numerators are not numbers!";break;case 4:h.error="All numerators are negative!";break;case 5:h.error="All denominators missing or null!";break;case 11:h.error="All denominators are not numbers!";break;case 6:h.error="All denominators are negative!";break;case 7:h.error="All denominators are smaller than numerators!";break;case 8:h.error="All SDs missing or null!";break;case 12:h.error="All SDs are not numbers!";break;case 9:h.error="All SDs are negative!"}return h}(f,c,h,m,i.chart_type_props,l);if(0!==F.status)return function(t){return{limitInputArgs:null,spcSettings:null,highlights:null,anyHighlights:!1,categories:null,groupings:null,groupingIndexes:null,scatter_formatting:null,line_formatting:null,label_formatting:null,tooltips:null,labels:null,anyLabels:!1,warningMessage:t.error,alt_targets:null,speclimits_lower:null,speclimits_upper:null,validationStatus:t}}(F);const S=new Array,C=new Array,T=new Array,$=t.categories[0].source.displayName,D=a;let P=0;const L=i.chart_type_props.x_axis_use_date;l.forEach((t,e)=>{""===F.messages[e]?(S.push(e),C.push({x:P,id:t,label:L?f[e]:P.toString()}),P+=1,D[t].length>0&&D[t].forEach(t=>{T.push(`Conditional formatting for ${$} ${f[e]} ignored due to: ${t}.`)})):T.push(`${$} ${f[e]} removed due to: ${F.messages[e]}.`)});const E=$l(g,S),I=new Array;let O=E[0];E.forEach((t,e)=>{t!==O&&(I.push(e-1),O=t)});const V=$l(k,S);if(e.nhs_icons.show_assurance_icons){const t=null==V?void 0:V.length;t>0&&ya(null==V?void 0:V[t-1])&&T.push("NHS Assurance icon requires a valid alt. target at last observation."),i.chart_type_props.has_control_limits||T.push("NHS Assurance icon requires chart with control limits.")}const B=$l(v,S),z=A[0].num_points_subset;let j;j=ya(z)||!ba(z,1,S.length)?Pl(0,S.length-1):"Start"===A[0].subset_points_from?Pl(0,A[0].num_points_subset-1):Pl(S.length-A[0].num_points_subset,S.length-1);const U=$l(_,S);return{limitInputArgs:{keys:C,numerators:$l(c,S),denominators:$l(h,S),xbar_sds:$l(m,S),outliers_in_limits:A[0].outliers_in_limits,subset_points:j},spcSettings:A[0],tooltips:$l(y,S),labels:U,anyLabels:U.filter(t=>!ya(t)&&""!==t).length>0,highlights:B,anyHighlights:B.filter(t=>!ya(t)).length>0,categories:t.categories[0],groupings:E,groupingIndexes:I,scatter_formatting:$l(w,S),line_formatting:$l(b,S),label_formatting:$l(x,S),warningMessage:T.length>0?T.join("\n"):"",alt_targets:V,speclimits_lower:$l(N,S),speclimits_upper:$l(M,S),validationStatus:F}}(t.dataViews[0].categorical,l,r,this.inputSettings.validationStatus.messages,i),o=0!==n.validationStatus.status,s=o?new Array:this.getGroupingIndexes(n,0===a?this.splitIndexes:void 0),u=o?null:this.calculateLimits(n,s,l),d=o?null:this.flagOutliers(u,s,l,r);o||this.scaleAndTruncateLimits(u,l,r);const p=i.map(i=>e.createSelectionIdBuilder().withCategory(t.dataViews[0].categorical.categories[0],i).createSelectionId());this.inputData.push(n),this.groupStartEndIndexes.push(s),this.controlLimits.push(u),this.outliers.push(d),this.identities.push(p)}),this.showGrouped?this.initialisePlotDataGrouped():(this.initialisePlotData(e),this.initialiseGroupedLines())}return this.firstRun=!1,this.inputData.some(t=>0!==t.validationStatus.status)?(N.status=!1,N.error=this.inputData.filter(t=>0!==t.validationStatus.status).map(t=>t.validationStatus.error).join("\n"),N):(this.inputData.some(t=>""!==t.warningMessage)&&(N.warning=this.inputData.filter(t=>""!==t.warningMessage).map(t=>t.warningMessage).join("\n")),N)}getGroupingIndexes(t,e){const i=(null!=e?e:[]).concat([-1]).concat(t.groupingIndexes).concat([t.limitInputArgs.keys.length-1]).filter((t,e,i)=>i.indexOf(t)===e).sort((t,e)=>t-e),a=new Array;for(let t=0;t<i.length-1;t++)a.push([i[t]+1,i[t+1]+1]);return a}calculateLimits(t,e,i){var a;const l=dl[i.spc.chart_type];let r;t.limitInputArgs.outliers_in_limits=i.spc.outliers_in_limits,e.length>1?r=e.map(e=>{let i=JSON.parse(JSON.stringify(t));return Object.keys(i.limitInputArgs).forEach(t=>{Array.isArray(i.limitInputArgs[t])&&(i.limitInputArgs[t]=i.limitInputArgs[t].slice(e[0],e[1]),"subset_points"===t&&(i.limitInputArgs[t]=i.limitInputArgs[t].map(t=>t-e[0])))}),i}).map(t=>{const e=l(t.limitInputArgs);return e.trend_line=Ll(e.values),e}).reduce((t,e)=>{const i=t;return Object.entries(t).forEach((t,a)=>{var l;const r=Object.entries(e)[a][1];i[t[0]]=null===(l=t[1])||void 0===l?void 0:l.concat(r)}),i}):(r=l(t.limitInputArgs),r.trend_line=Ll(r.values)),r.alt_targets=t.alt_targets,r.speclimits_lower=t.speclimits_lower,r.speclimits_upper=t.speclimits_upper;for(const t of Object.keys(r))"keys"!==t&&(r[t]=null===(a=r[t])||void 0===a?void 0:a.map(t=>isNaN(t)?null:t));return r}initialisePlotDataGrouped(){var t,e,i,a,l,r,n,o,s,u,d,p,c,h,m;this.plotPoints=new Array,this.tableColumns=new Array;const f=new Array;this.indicatorVarNames.forEach(t=>{f.push({name:t,label:t})}),f.push({name:"latest_date",label:"Latest Date"});const y=this.inputSettings.settings[0].lines;y.show_main&&f.push({name:"value",label:"Value"}),this.inputSettings.settings[0].spc.ttip_show_numerator&&f.push({name:"numerator",label:"Numerator"}),this.inputSettings.settings[0].spc.ttip_show_denominator&&f.push({name:"denominator",label:"Denominator"}),y.show_target&&f.push({name:"target",label:y.ttip_label_target}),y.show_alt_target&&f.push({name:"alt_target",label:y.ttip_label_alt_target}),["99","95","68"].forEach(t=>{y[`show_${t}`]&&f.push({name:`ucl${t}`,label:`${y[`ttip_label_${t}_prefix_upper`]}${y[`ttip_label_${t}`]}`})}),["68","95","99"].forEach(t=>{y[`show_${t}`]&&f.push({name:`lcl${t}`,label:`${y[`ttip_label_${t}_prefix_lower`]}${y[`ttip_label_${t}`]}`})});const g=this.inputSettings.settings[0].nhs_icons;g.show_variation_icons&&f.push({name:"variation",label:"Variation"}),g.show_assurance_icons&&f.push({name:"assurance",label:"Assurance"});const _=this.inputData.some(t=>{var e;return null===(e=null==t?void 0:t.tooltips)||void 0===e?void 0:e.some(t=>t.length>0)});_&&(null===(e=null===(t=this.inputData)||void 0===t?void 0:t[0].tooltips)||void 0===e||e[0].forEach(t=>{f.push({name:t.displayName,label:t.displayName})}));for(let t=0;t<this.groupNames.length;t++){if(ya(null===(i=this.inputData[t])||void 0===i?void 0:i.categories))continue;const e=ja(this.inputSettings.settings[t],this.inputSettings.derivedSettings[t]),y=this.inputSettings.settings[t].summary_table.table_variation_filter,g=this.inputSettings.settings[t].summary_table.table_assurance_filter,v=this.controlLimits[t];if(!v)continue;const w=this.outliers[t],b=v.keys.length-1,x=Sa(w,this.inputSettings.settings[t]);if("all"!==y){if("improvement"===y&&!["improvementHigh","improvementLow"].includes(x[0]))continue;if("deterioration"===y&&!["concernHigh","concernLow"].includes(x[0]))continue;if("neutral"===y&&!["neutralHigh","neutralLow"].includes(x[0]))continue;if("common"===y&&"commonCause"!==x[0])continue;if("special"===y&&"commonCause"===x[0])continue}const k=Fa(v,this.inputSettings.settings[t],this.inputSettings.derivedSettings[t]);if("all"!==g){if("any"===g&&"inconsistent"===k)continue;if("pass"===g&&"consistentPass"!==k)continue;if("fail"===g&&"consistentFail"!==k)continue;if("inconsistent"===g&&"inconsistent"!==k)continue}const N=new Array;this.indicatorVarNames.forEach((e,i)=>{N.push([e,this.groupNames[t][i]])}),N.push(["latest_date",null===(a=v.keys)||void 0===a?void 0:a[b].label]),N.push(["value",e(null===(l=v.values)||void 0===l?void 0:l[b],"value")]),N.push(["numerator",e(null===(r=v.numerators)||void 0===r?void 0:r[b],"integer")]),N.push(["denominator",e(null===(n=v.denominators)||void 0===n?void 0:n[b],"integer")]),N.push(["target",e(null===(o=v.targets)||void 0===o?void 0:o[b],"value")]),N.push(["alt_target",e(null===(s=v.alt_targets)||void 0===s?void 0:s[b],"value")]),N.push(["ucl99",e(null===(u=v.ul99)||void 0===u?void 0:u[b],"value")]),N.push(["ucl95",e(null===(d=v.ul95)||void 0===d?void 0:d[b],"value")]),N.push(["ucl68",e(null===(p=v.ul68)||void 0===p?void 0:p[b],"value")]),N.push(["lcl68",e(null===(c=v.ll68)||void 0===c?void 0:c[b],"value")]),N.push(["lcl95",e(null===(h=v.ll95)||void 0===h?void 0:h[b],"value")]),N.push(["lcl99",e(null===(m=v.ll99)||void 0===m?void 0:m[b],"value")]),N.push(["variation",x[0]]),N.push(["assurance",k]),_&&this.inputData[t].tooltips[b].forEach(t=>{N.push([t.displayName,t.value])}),this.plotPoints[t]||(this.plotPoints[t]=[]),this.plotPoints[t].push({table_row:Object.fromEntries(N),identity:this.identities[t],aesthetics:this.inputSettings.settings[t].summary_table,highlighted:this.inputData[t].anyHighlights}),this.tableColumns[t]=f}}initialisePlotData(t){var e,i,a,l,r,n,o,s,u,d,p,c,h,m;const f=this.inputData[0],y=this.controlLimits[0],g=this.outliers[0],_=this.inputSettings.settings[0],v=this.inputSettings.derivedSettings[0];if(this.plotPoints[0]=new Array,this.tickLabels=new Array,this.tableColumns[0]=new Array,this.tableColumns[0].push({name:"date",label:"Date"}),this.tableColumns[0].push({name:"value",label:"Value"}),y){ya(y.numerators)||this.tableColumns[0].push({name:"numerator",label:"Numerator"}),ya(y.denominators)||this.tableColumns[0].push({name:"denominator",label:"Denominator"}),_.lines.show_target&&this.tableColumns[0].push({name:"target",label:"Target"}),_.lines.show_alt_target&&this.tableColumns[0].push({name:"alt_target",label:"Alt. Target"}),_.lines.show_specification&&this.tableColumns[0].push({name:"speclimits_lower",label:"Spec. Lower"},{name:"speclimits_upper",label:"Spec. Upper"}),_.lines.show_trend&&this.tableColumns[0].push({name:"trend_line",label:"Trend Line"}),v.chart_type_props.has_control_limits&&(_.lines.show_99&&this.tableColumns[0].push({name:"ll99",label:"LL 99%"},{name:"ul99",label:"UL 99%"}),_.lines.show_95&&this.tableColumns[0].push({name:"ll95",label:"LL 95%"},{name:"ul95",label:"UL 95%"}),_.lines.show_68&&this.tableColumns[0].push({name:"ll68",label:"LL 68%"},{name:"ul68",label:"UL 68%"})),_.outliers.astronomical&&this.tableColumns[0].push({name:"astpoint",label:"Ast. Point"}),_.outliers.trend&&this.tableColumns[0].push({name:"trend",label:"Trend"}),_.outliers.shift&&this.tableColumns[0].push({name:"shift",label:"Shift"});for(let w=0;w<y.keys.length;w++){const b=y.keys[w].x,x=f.scatter_formatting[w];this.colourPalette.isHighContrast&&(x.colour=this.colourPalette.foregroundColour),"none"!==g.shift[w]&&(x.colour=wa(g.shift[w],"outliers","shift_colour",_),x.colour_outline=wa(g.shift[w],"outliers","shift_colour",_)),"none"!==g.trend[w]&&(x.colour=wa(g.trend[w],"outliers","trend_colour",_),x.colour_outline=wa(g.trend[w],"outliers","trend_colour",_)),"none"!==g.two_in_three[w]&&(x.colour=wa(g.two_in_three[w],"outliers","twointhree_colour",_),x.colour_outline=wa(g.two_in_three[w],"outliers","twointhree_colour",_)),"none"!==g.astpoint[w]&&(x.colour=wa(g.astpoint[w],"outliers","ast_colour",_),x.colour_outline=wa(g.astpoint[w],"outliers","ast_colour",_));const k={date:y.keys[w].label,numerator:null===(e=y.numerators)||void 0===e?void 0:e[w],denominator:null===(i=y.denominators)||void 0===i?void 0:i[w],value:y.values[w],target:y.targets[w],alt_target:y.alt_targets[w],ll99:null===(a=null==y?void 0:y.ll99)||void 0===a?void 0:a[w],ll95:null===(l=null==y?void 0:y.ll95)||void 0===l?void 0:l[w],ll68:null===(r=null==y?void 0:y.ll68)||void 0===r?void 0:r[w],ul68:null===(n=null==y?void 0:y.ul68)||void 0===n?void 0:n[w],ul95:null===(o=null==y?void 0:y.ul95)||void 0===o?void 0:o[w],ul99:null===(s=null==y?void 0:y.ul99)||void 0===s?void 0:s[w],speclimits_lower:null===(u=null==y?void 0:y.speclimits_lower)||void 0===u?void 0:u[w],speclimits_upper:null===(d=null==y?void 0:y.speclimits_upper)||void 0===d?void 0:d[w],trend_line:null===(p=null==y?void 0:y.trend_line)||void 0===p?void 0:p[w],astpoint:g.astpoint[w],trend:g.trend[w],shift:g.shift[w],two_in_three:g.two_in_three[w]};this.plotPoints[0].push({x:b,value:y.values[w],aesthetics:x,table_row:k,identity:t.createSelectionIdBuilder().withCategory(f.categories,f.limitInputArgs.keys[w].id).createSelectionId(),highlighted:!ya(null===(c=f.highlights)||void 0===c?void 0:c[b]),tooltip:gl(k,null===(h=null==f?void 0:f.tooltips)||void 0===h?void 0:h[b],_,v),label:{text_value:null===(m=f.labels)||void 0===m?void 0:m[b],aesthetics:f.label_formatting[b],angle:null,distance:null,line_offset:null,marker_offset:null}}),this.tickLabels.push({x:b,label:y.keys[w].label})}}}initialiseGroupedLines(){const t=this.inputSettings.settings[0],e=this.inputSettings.derivedSettings[0],i=this.controlLimits[0],a=this.inputData[0],l=new Array;t.lines.show_main&&l.push("values"),t.lines.show_target&&l.push("targets"),t.lines.show_alt_target&&l.push("alt_targets"),t.lines.show_specification&&l.push("speclimits_lower","speclimits_upper"),t.lines.show_trend&&l.push("trend_line"),e.chart_type_props.has_control_limits&&(t.lines.show_99&&l.push("ll99","ul99"),t.lines.show_95&&l.push("ll95","ul95"),t.lines.show_68&&l.push("ll68","ul68"));const r=new Array;if(!i)return;const n=i.keys.length;for(let e=0;e<n;e++){const n=this.splitIndexes.includes(e-1)||a.groupingIndexes.includes(e-1);let o=!1;e>0&&t.lines.show_alt_target&&(o=i.alt_targets[e]!==i.alt_targets[e-1]),l.forEach(l=>{var s,u;const d=t.lines[`join_rebaselines_${va[l]}`];if(n||o){const t="alt_targets"===l&&o,u="alt_targets"!==l&&n;r.push({x:i.keys[e].x,line_value:d||!t&&!u?null===(s=i[l])||void 0===s?void 0:s[e]:null,group:l,aesthetics:a.line_formatting[e]})}r.push({x:i.keys[e].x,line_value:null===(u=i[l])||void 0===u?void 0:u[e],group:l,aesthetics:a.line_formatting[e]})})}this.groupedLines=function(t){var e;const i=new Map;for(let a=0;a<t.length;a++){const l=t[a],r=l.group;i.has(r)||i.set(r,[]),null===(e=i.get(r))||void 0===e||e.push(l)}return Array.from(i)}(r)}scaleAndTruncateLimits(t,e,i){const a=i.multiplier;let l=["values","targets"];i.chart_type_props.has_control_limits&&(l=l.concat(["ll99","ll95","ll68","ul68","ul95","ul99"]));let r=l;e.lines.show_alt_target&&(r=r.concat(["alt_targets"]),e.lines.multiplier_alt_target&&(l=l.concat(["alt_targets"]))),e.lines.show_specification&&(r=r.concat(["speclimits_lower","speclimits_upper"]),e.lines.multiplier_specification&&(l=l.concat(["speclimits_lower","speclimits_upper"]))),l.forEach(e=>{for(let i=0;i<t[e].length;i++)ya(t[e][i])||(t[e][i]=t[e][i]*a)}),r.forEach(i=>{for(let a=0;a<t[i].length;a++)if(!ya(t[i][a])){const l=Ba(e.spc.ll_truncate)?Math.max(e.spc.ll_truncate,t[i][a]):t[i][a],r=Ba(e.spc.ul_truncate)?Math.min(e.spc.ul_truncate,l):l;t[i][a]=r}})}flagOutliers(t,e,i,a){var l,r,n,o;const s=i.outliers.process_flag_type,u=i.outliers.improvement_direction,d=i.outliers.trend_n,p=i.outliers.shift_n,c="Specification"===i.outliers.astronomical_limit,h="Specification"===i.outliers.two_in_three_limit,m={astpoint:pl("none",t.values.length),two_in_three:pl("none",t.values.length),trend:pl("none",t.values.length),shift:pl("none",t.values.length)};for(let s=0;s<e.length;s++){const u=e[s][0],f=e[s][1],y=t.values.slice(u,f),g=t.targets.slice(u,f);if(a.chart_type_props.has_control_limits||c||h){const e={"1 Sigma":"68","2 Sigma":"95","3 Sigma":"99",Specification:""};if(i.outliers.astronomical){const a=e[i.outliers.astronomical_limit],n=c?"speclimits_upper":"ul";El(y,null===(l=null==t?void 0:t[`${c?"speclimits_lower":"ll"}${a}`])||void 0===l?void 0:l.slice(u,f),null===(r=null==t?void 0:t[`${n}${a}`])||void 0===r?void 0:r.slice(u,f)).forEach((t,e)=>m.astpoint[u+e]=t)}if(i.outliers.two_in_three){const a=i.outliers.two_in_three_highlight_series,l=e[i.outliers.two_in_three_limit],r=h?"speclimits_upper":"ul";Vl(y,null===(n=null==t?void 0:t[`${h?"speclimits_lower":"ll"}${l}`])||void 0===n?void 0:n.slice(u,f),null===(o=null==t?void 0:t[`${r}${l}`])||void 0===o?void 0:o.slice(u,f),a).forEach((t,e)=>m.two_in_three[u+e]=t)}}i.outliers.trend&&Ol(y,d).forEach((t,e)=>m.trend[u+e]=t),i.outliers.shift&&Bl(y,g,p).forEach((t,e)=>m.shift[u+e]=t)}return Object.keys(m).forEach(t=>{for(let e=0;e<m[t].length;e++)m[t][e]=_l(m[t][e],{process_flag_type:s,improvement_direction:u})}),m}}return t.Visual=class{constructor(t){this.tableDiv=ut(t.element).append("div").style("overflow","auto"),this.svg=ut(t.element).append("svg"),this.host=t.host,this.viewModel=new zl,this.plotProperties=new Wa,this.selectionManager=this.host.createSelectionManager(),this.selectionManager.registerOnSelectCallback(()=>this.updateHighlighting()),this.svg.call($a);const e=this.tableDiv.append("table").classed("table-group",!0).style("border-collapse","collapse").style("width","100%").style("height","100%");e.append("thead").append("tr").classed("table-header",!0),e.append("tbody").classed("table-body",!0)}update(t){var e,i,a,l,r,n;try{this.host.eventService.renderingStarted(t),this.svg.select(".errormessage").remove();const o=this.viewModel.update(t,this.host);if(!o.status)return this.resizeCanvas(t.viewport.width,t.viewport.height),null===(n=null===(r=null===(l=null===(a=null===(i=null===(e=this.viewModel)||void 0===e?void 0:e.inputSettings)||void 0===i?void 0:i.settings)||void 0===a?void 0:a[0])||void 0===l?void 0:l.canvas)||void 0===r?void 0:r.show_errors)||void 0===n||n?this.svg.call(Da,t,this.viewModel.colourPalette,null==o?void 0:o.error,null==o?void 0:o.type):this.svg.call($a,!0),void this.host.eventService.renderingFailed(t);this.plotProperties.update(t,this.viewModel),o.warning&&this.host.displayWarningIcon("Invalid inputs or settings ignored.\n",o.warning),this.viewModel.showGrouped||this.viewModel.inputSettings.settings[0].summary_table.show_table?(this.resizeCanvas(0,0),this.tableDiv.call(Va,this).call(Ta,this)):(this.resizeCanvas(t.viewport.width,t.viewport.height),this.drawVisual(),this.adjustPaddingForOverflow()),this.updateHighlighting(),this.host.eventService.renderingFinished(t)}catch(e){this.resizeCanvas(t.viewport.width,t.viewport.height),this.svg.call(Da,t,this.viewModel.colourPalette,e.message,"internal"),console.error(e),this.host.eventService.renderingFailed(t)}}drawVisual(){this.svg.call(fa,this).call(ga,this).call(_a,this).call(xa,this).call(Za,this).call(ka,this).call(Ca,this).call(Ta,this).call(Ga,this).call(za,this)}adjustPaddingForOverflow(){if(this.viewModel.headless)return;const t=this.viewModel.svgWidth,e=this.viewModel.svgHeight,i=this.svg.node().getBBox(),a=Math.abs(Math.min(0,i.x)),l=Math.max(0,i.width+i.x-t),r=Math.abs(Math.min(0,i.y)),n=Math.max(0,i.height+i.y-e);a>0&&(this.plotProperties.xAxis.start_padding+=a+this.plotProperties.xAxis.start_padding),l>0&&(this.plotProperties.xAxis.end_padding+=l+this.plotProperties.xAxis.end_padding),r>0&&(this.plotProperties.yAxis.end_padding+=r+this.plotProperties.yAxis.end_padding),n>0&&(this.plotProperties.yAxis.start_padding+=n+this.plotProperties.yAxis.start_padding),(a>0||l>0||r>0||n>0)&&(this.plotProperties.initialiseScale(t,e),this.drawVisual())}resizeCanvas(t,e){this.svg.attr("width",t).attr("height",e),0===t&&0===e?this.tableDiv.style("width","100%").style("height","100%"):this.tableDiv.style("width","0%").style("height","0%")}updateHighlighting(){const t=this.viewModel.inputData.length>0&&this.viewModel.inputData.some(t=>t.anyHighlights),e=this.selectionManager.getSelectionIds(),i=this.svg.selectAll(".dotsgroup").selectChildren(),a=this.svg.selectAll(".linesgroup").selectChildren(),l=this.tableDiv.selectAll(".table-body").selectChildren();a.style("stroke-opacity",t=>wa(t[0],"lines","opacity",this.viewModel.inputSettings.settings[0])),i.style("fill-opacity",t=>t.aesthetics.opacity),i.style("stroke-opacity",t=>t.aesthetics.opacity),l.style("opacity",t=>t.aesthetics.table_opacity),(t||e.length>0)&&(a.style("stroke-opacity",t=>wa(t[0],"lines","opacity_unselected",this.viewModel.inputSettings.settings[0])),i.nodes().forEach(t=>{const e=ut(t).datum(),i=Pa(e.identity,this.selectionManager),a=e.highlighted,l=i||a?e.aesthetics.opacity_selected:e.aesthetics.opacity_unselected;ut(t).style("fill-opacity",l),ut(t).style("stroke-opacity",l)}),l.nodes().forEach(t=>{const e=ut(t).datum(),i=Pa(e.identity,this.selectionManager),a=e.highlighted,l=i||a?e.aesthetics.table_opacity_selected:e.aesthetics.table_opacity_unselected;ut(t).style("opacity",l)}))}getFormattingModel(){return this.viewModel.inputSettings.getFormattingModel()}},t.d3=qi,t.defaultSettings=ma,t}({});
